<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTODROP | CS2 CASES & UPGRADES</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --bg-dark: #0b0d11;
            --bg-panel: #14171c;
            --accent: #facc15;
            --accent-hot: #fb7185;
            --rarity-blue: #4b69ff;
            --rarity-purple: #8847ff;
            --rarity-pink: #d32ee6;
            --rarity-red: #eb4b4b;
            --rarity-gold: #ebca44;
        }

        body { font-family: 'Rajdhani', sans-serif; background-color: var(--bg-dark); color: #e2e8f0; overflow-x: hidden; overflow-y: auto; background-image: radial-gradient(circle at 15% -20%, rgba(250,204,21,0.15), transparent 40%), radial-gradient(circle at 80% -10%, rgba(244,114,182,0.13), transparent 35%); }
        .nav-link.active { color: var(--accent); border-bottom: 3px solid var(--accent); text-shadow: 0 0 14px rgba(250,204,21,0.7); }
        .live-drop-scroll { display: flex; align-items: center; gap: 0.5rem; min-height: 100%; width: 100%; }
        @keyframes dropIn {
            0% { transform: translateY(-30px) scale(0.9); opacity: 0; margin-left: -100px; }
            50% { margin-left: 0; }
            100% { transform: translateY(0) scale(1); opacity: 1; margin-left: 0; }
        }
        .animate-drop-in {
            animation: dropIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        .live-drop-item {
            transition: all 0.3s ease;
        }

        @keyframes dropPulse {
            0%, 100% { opacity: 0.92; }
            50% { opacity: 1; }
        }

        .cb-player-card { transition: all .35s ease; border: 2px solid rgba(250,204,21,0.2); background: linear-gradient(180deg, rgba(17,20,28,0.95), rgba(10,12,18,0.95)); }
        .cb-player-card.winner { border-color: rgba(74,222,128,0.9); box-shadow: 0 0 24px rgba(34,197,94,0.45), inset 0 0 20px rgba(34,197,94,0.16); animation: cbWinnerPulse 1.1s ease-in-out infinite; }
        .cb-player-card.loser { border-color: rgba(248,113,113,0.72); filter: saturate(0.6) brightness(0.75); opacity: 0.78; }
        .cb-player-card .cb-round-dot { width: 12px; height: 12px; border-radius: 9999px; background: #374151; border: 1px solid rgba(255,255,255,0.18); }
        .cb-player-card .cb-round-dot.active { background: #facc15; box-shadow: 0 0 14px rgba(250,204,21,0.8); }
        .cb-player-card .cb-round-dot.hit { background: #22c55e; box-shadow: 0 0 14px rgba(34,197,94,0.75); }
        .cb-case-pill { background: linear-gradient(135deg, rgba(239,68,68,0.22), rgba(251,191,36,0.18)); border: 1px solid rgba(250,204,21,0.35); }
        @keyframes cbWinnerPulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.01); } }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #2d3748; border-radius: 10px; }
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        

        .dopamine-glow { box-shadow: 0 10px 30px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.06), 0 0 24px rgba(138,43,226,0.22); }
        .dopamine-glow:hover { box-shadow: 0 14px 38px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.14), 0 0 34px rgba(255,215,0,0.28), 0 0 48px rgba(138,43,226,0.26); }
        .shine-sweep { position: relative; overflow: hidden; }
        .shine-sweep::after { content:''; position:absolute; top:-120%; left:-35%; width:38%; height:340%; background:linear-gradient(120deg, transparent 0%, rgba(255,255,255,0.12) 45%, transparent 100%); transform: rotate(18deg) translateX(-240%); transition: transform .7s cubic-bezier(.4,0,.2,1); }
        .shine-sweep:hover::after { transform: rotate(18deg) translateX(390%); }
        @media (max-width: 768px) {
            #page-cases .h-\[250px\] { height: auto; min-height: 190px; padding: 16px; border-radius: 20px; }
            #page-cases h1 { font-size: 1.8rem !important; line-height: 1.1; }
            #page-cases p { font-size: .86rem !important; }
            #cases-grid { grid-template-columns: repeat(2, minmax(0,1fr)) !important; gap: 10px !important; }
            .spinner-item { min-width: 112px; }
            #cb-stage { grid-template-columns: 1fr !important; }
        }
        .pulse-soft { animation: pulseSoft 1.8s ease-in-out infinite; }
        @keyframes pulseSoft { 0%,100% { opacity:.72; } 50% { opacity:1; } }
        .upgrade-glow { box-shadow: 0 0 40px rgba(168, 85, 247, 0.15); }

        /* Vylep≈°en√© item animace */
        .item-float { animation: none; opacity: 1; transform: scale(1) !important; }
        @keyframes floatItem { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(0px); } }
        
        .item-pulse { animation: itemPulse 2s ease-in-out infinite; }
        @keyframes itemPulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.9; } }
        
        .item-shine { animation: shine 3s ease-in-out infinite; }
        @keyframes shine { 0%, 100% { box-shadow: 0 0 10px rgba(255, 255, 255, 0); } 50% { box-shadow: 0 0 30px rgba(255, 255, 255, 0.3); } }
        
        .glow-blue { box-shadow: 0 0 20px rgba(75, 105, 255, 0.4); }
        .glow-purple { box-shadow: 0 0 20px rgba(136, 71, 255, 0.4); }
        .glow-pink { box-shadow: 0 0 20px rgba(211, 46, 230, 0.4); }
        .glow-red { box-shadow: 0 0 20px rgba(235, 75, 75, 0.4); }
        .glow-gold { box-shadow: 0 0 20px rgba(235, 202, 68, 0.6); }

        /* Spinner pro bedny */
        .spinner-container {
            position: relative; width: 100%; height: 180px;
            background: linear-gradient(180deg, #101218 0%, #0a0b0e 100%);
            border-radius: 4px; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.05);
            box-shadow: inset 0 0 50px rgba(0,0,0,0.8);
        }
        .spinner-track { display: flex; position: absolute; left: 0; height: 100%; align-items: center; will-change: transform; }
        .spinner-item {
            min-width: 140px; height: 140px; margin: 0 4px;
            background: #14171c; border-bottom: 4px solid;
            border-radius: 12px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; padding: 10px; position: relative;
            transition: all 0.2s ease;
        }
        .spinner-item img { max-height: 80px; object-fit: contain; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.5)); }
        .spinner-selector {
            position: absolute; left: 50%; top: 0; bottom: 0; width: 4px;
            background: var(--accent); z-index: 10; transform: translateX(-50%);
            box-shadow: 0 0 20px var(--accent);
        }
        .blur-edges { position: absolute; top: 0; bottom: 0; width: 100px; z-index: 5; pointer-events: none; }
        .blur-left { left: 0; background: linear-gradient(90deg, #0b0d11 0%, transparent 100%); }
        .blur-right { right: 0; background: linear-gradient(270deg, #0b0d11 0%, transparent 100%); }
        .fallback-img { filter: grayscale(1) opacity(0.3); }

        /* Vizu√°ln√≠ efekty V√Ωhry */
        .win-pop { animation: popIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .win-glow-rotate { animation: spin 10s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        .particle { position: absolute; border-radius: 50%; pointer-events: none; animation: flyOut 1.5s ease-out forwards; }
        @keyframes flyOut { 
            0% { transform: translate(0, 0) scale(1); opacity: 1; } 
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; } 
        }

        /* Upgrade efekty */
        .upgrade-shake { animation: shake 0.5s ease-in-out infinite; border-color: #a855f7 !important; }
        .upgrade-pointer { position: absolute; left: 50%; top: 50%; width: 2px; height: 82px; background: linear-gradient(to top, rgba(236,72,153,0.2), #f8fafc 35%, #facc15); transform-origin: 50% 100%; transform: translate(-50%, -100%) rotate(0deg); border-radius: 9999px; box-shadow: 0 0 10px rgba(250,204,21,0.55); transition: transform 1.9s cubic-bezier(0.15, 0.8, 0.2, 1); z-index: 20; }
        .upgrade-pointer::after { content: ""; position: absolute; top: -6px; left: 50%; transform: translateX(-50%); width: 8px; height: 8px; border-radius: 9999px; background: #facc15; box-shadow: 0 0 10px rgba(250,204,21,0.8); }
        .cb-opt { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.12); color: #cbd5e1; padding: .5rem; border-radius: .5rem; font-size: .7rem; font-weight: 800; text-transform: uppercase; }
        .cb-opt.active { background: rgba(250,204,21,0.18); border-color: rgba(250,204,21,0.5); color: #fde047; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px) rotate(-1deg); } 75% { transform: translateX(5px) rotate(1deg); } }

        /* Spinner polo≈æky - vylep≈°en√© animace */
        .spinner-item {
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .spinner-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.8);
        }

        .cb-builder-opt {
            border: 1px solid rgba(255,255,255,0.14);
            background: rgba(255,255,255,0.04);
            border-radius: 0.65rem;
            color: #d1d5db;
            font-size: 11px;
            font-weight: 800;
            padding: 0.45rem 0.55rem;
            text-transform: uppercase;
            transition: all 0.15s ease;
        }
        .cb-builder-opt:hover {
            border-color: rgba(250,204,21,0.55);
            color: #fde68a;
        }
        .cb-builder-opt.active {
            border-color: rgba(250,204,21,0.9);
            background: rgba(250,204,21,0.16);
            color: #fef08a;
            box-shadow: 0 0 0 1px rgba(250,204,21,0.2) inset;
        }

        .cb-hub-tab { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.14); color: #cbd5e1; padding: .4rem .8rem; border-radius: .6rem; font-weight: 800; font-size: 12px; text-transform: uppercase; }
        .cb-hub-tab.active { background: rgba(250,204,21,0.2); border-color: rgba(250,204,21,0.6); color: #fde047; }
        .cb-filter-chip { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #cbd5e1; padding: .3rem .6rem; border-radius: 9999px; font-size: 11px; font-weight: 800; }
        .cb-filter-chip.active { border-color: rgba(250,204,21,0.6); color: #fde68a; box-shadow: 0 0 16px rgba(250,204,21,0.2); }
        .cb-lobby-row { display:grid; grid-template-columns: 80px 1fr 100px 150px 120px; gap: 10px; align-items:center; padding: 10px; border: 1px solid rgba(250,204,21,0.2); border-radius: 12px; background: linear-gradient(135deg, rgba(0,0,0,0.25), rgba(18,22,32,0.9)); }
        .cb-rounds-badge { clip-path: polygon(16% 0,84% 0,100% 50%,84% 100%,16% 100%,0 50%); border: 1px solid rgba(250,204,21,0.8); color:#fde047; font-weight:900; text-align:center; padding:.6rem .2rem; background: rgba(250,204,21,0.12); box-shadow: 0 0 16px rgba(250,204,21,0.25); }
        .cb-case-pick-card { position: relative; background: linear-gradient(180deg, #171b25, #111723); border: 1px solid rgba(255,255,255,0.12); border-radius: 14px; padding: 8px; transition: all .2s ease; overflow: hidden; }
        .cb-case-pick-card:hover { border-color: rgba(250,204,21,0.55); transform: translateY(-2px); box-shadow: 0 8px 26px rgba(0,0,0,0.35); }
        .cb-case-pick-controls { position: absolute; inset: auto 8px 8px 8px; display:flex; align-items:center; justify-content:space-between; gap:8px; opacity:0; transform: translateY(8px); transition: all .18s ease; }
        .cb-case-pick-card:hover .cb-case-pick-controls, .cb-case-pick-card.selected .cb-case-pick-controls { opacity:1; transform: translateY(0); }
        .cb-case-picked-count { position:absolute; top:8px; left:8px; min-width:30px; height:30px; border-radius:9999px; display:grid; place-items:center; font-size:12px; font-weight:900; background: rgba(250,204,21,0.9); color:#111; box-shadow:0 0 16px rgba(250,204,21,0.45); }

    </style>
</head>
<body class="h-screen flex flex-col" onclick="initAudio()">

    <div id="win-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black/95 backdrop-blur-md transition-all duration-300 opacity-0">
        <div id="win-bg-glow" class="absolute w-[800px] h-[800px] blur-[150px] opacity-40 win-glow-rotate rounded-full"></div>
        
        <div class="text-center relative z-10 w-full max-w-3xl px-8 flex flex-col items-center">
            <h3 class="text-2xl font-black uppercase text-gray-400 tracking-[0.5em] mb-4 animate-pulse">Padlo ti</h3>
            <img id="win-image" class="h-80 object-contain drop-shadow-[0_20px_50px_rgba(0,0,0,0.8)] scale-0 mb-8" src="" alt="Skin">
            <h2 id="win-name" class="text-6xl font-black uppercase italic tracking-tighter text-white drop-shadow-xl mb-2"></h2>
            <div id="win-price" class="text-3xl font-bold text-yellow-400 mb-12 drop-shadow-lg">0.00 EUR</div>
            
            <div class="flex gap-6 justify-center w-full max-w-lg">
                <button id="btn-win-sell" class="flex-1 bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 text-black py-4 rounded-2xl font-black uppercase text-xl transition-all shadow-[0_0_30px_rgba(34,197,94,0.3)] hover:scale-105 active:scale-95">
                    Prodat za <span id="win-sell-price"></span>
                </button>
                <button id="btn-win-keep" class="flex-1 bg-gray-800 hover:bg-gray-700 border border-gray-600 text-white py-4 rounded-2xl font-black uppercase text-xl transition-all hover:scale-105 active:scale-95">
                    Nechat v invent√°≈ôi
                </button>
            </div>
        </div>
        <div id="particles-container" class="absolute inset-0 pointer-events-none overflow-hidden z-20"></div>
    </div>

    <div class="h-16 bg-[#0b0d11] border-b border-white/5 flex items-stretch z-40 relative shadow-md overflow-hidden">
        <div class="flex-shrink-0 bg-[#12161f] border-r border-white/5 px-6 flex flex-col justify-center relative z-10 shadow-[5px_0_15px_rgba(0,0,0,0.5)]">
            <div class="flex items-center gap-2 mb-1">
                <div class="w-2 h-2 rounded-full bg-yellow-400 animate-pulse shadow-[0_0_8px_#facc15]"></div>
                <span class="text-yellow-400 font-black text-[10px] uppercase tracking-[0.2em]">Live Drops</span>
            </div>
            <div class="flex items-center gap-1.5">
                <span class="relative flex h-1.5 w-1.5">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-1.5 w-1.5 bg-green-500"></span>
                </span>
                <span id="live-online-counter" class="text-gray-400 font-bold text-[9px] uppercase tracking-wider">1,687 Online</span>
            </div>
        </div>

        <div class="flex-1 overflow-hidden relative flex items-center">
            <div id="live-drops" class="flex items-center gap-2 px-4 w-full h-full"></div>
        </div>
    </div>

    <header class="h-20 bg-[#12161f] border-b border-white/5 flex items-center justify-between px-6 sticky top-0 z-50">
        <div class="flex items-center gap-3 cursor-pointer" onclick="switchPage('cases')">
            <img src="Gemini_Generated_Image_v28osov28osov28o-removebg-preview (1).png" alt="OTODROP logo" class="w-12 h-12 object-contain">
            <div class="text-2xl font-black italic tracking-tight text-white">OTO<span class="text-yellow-400">DROP</span></div>
        </div>
        <nav class="hidden lg:flex items-center gap-6">
            <button onclick="switchPage('upgrade')" class="nav-link text-sm font-bold text-gray-400 hover:text-white flex items-center gap-2 transition-colors cursor-pointer"><i data-lucide="arrow-up-circle" class="w-4 h-4"></i>Upgrade</button>
            <button onclick="switchPage('giveaways')" class="nav-link text-sm font-bold text-gray-400 hover:text-white flex items-center gap-2 transition-colors cursor-pointer"><i data-lucide="gift" class="w-4 h-4"></i>Giveaways</button>
            <button onclick="switchPage('cases')" class="nav-link active text-sm font-bold text-gray-400 hover:text-white flex items-center gap-2 transition-colors cursor-pointer"><i data-lucide="star" class="w-4 h-4"></i>Free Cases</button>
            <button onclick="switchPage('case-battle')" class="nav-link text-sm font-bold text-gray-400 hover:text-white flex items-center gap-2 transition-colors cursor-pointer"><i data-lucide="swords" class="w-4 h-4 text-yellow-400"></i>Case Battle</button>
        </nav>
        <div class="flex items-center gap-3">
            <button class="bg-green-500/10 border border-green-500/30 text-green-400 px-4 py-2 rounded-lg font-black flex items-center gap-2">
                <span id="balance">0.00 EUR</span>
                <span class="bg-green-500/20 px-1.5 rounded">+</span>
            </button>
            <div id="profile-pill" onclick="openOwnPublicProfile()" class="hidden md:flex items-center gap-2 bg-[#0d1017] border border-white/10 rounded-xl px-2 py-1.5 cursor-pointer hover:bg-[#161a24] transition-colors">
                <div class="w-10 h-10 rounded-full p-[2px] bg-[conic-gradient(from_0deg,_#a3e635,_#22c55e,_#a3e635)]">
                    <img id="profile-pill-avatar" src="" alt="avatar" class="w-full h-full rounded-full object-cover bg-black">
                </div>
                <div class="leading-tight">
                    <div id="profile-pill-name" class="text-xs text-white font-black"></div>
                    <div id="profile-pill-nick" class="text-[10px] text-gray-400 font-bold"></div>
                </div>
            </div>
            <button onclick="openAuthModal()" id="auth-open-btn" class="bg-[#161a24] border border-white/10 text-gray-200 hover:text-white px-3 py-2 rounded-lg text-xs font-black uppercase tracking-wide">Sign In</button>
            <button onclick="toggleMobileMenu()" class="md:hidden bg-[#0d1017] hover:bg-[#161a24] text-gray-300 px-3 py-2 rounded-lg border border-white/10"><i data-lucide="menu" class="w-5 h-5"></i></button>
        </div>
    </header>

    <button id="live-chat-toggle" onclick="toggleLiveChat()" class="hidden lg:flex fixed right-6 bottom-6 z-[90] w-12 h-12 rounded-lg bg-[#12161f] border border-yellow-400/40 text-yellow-300 items-center justify-center shadow-[0_10px_30px_rgba(0,0,0,0.45)] hover:bg-[#1a1e29] hover:text-yellow-200 transition-all">
        <i data-lucide="message-square" class="w-5 h-5"></i>
    </button>

    <div id="live-chat" class="hidden fixed right-6 bottom-20 z-[95] w-80 h-56 bg-[#0b0d11]/95 border border-yellow-400/30 rounded-xl p-3 text-sm overflow-hidden shadow-2xl lg:flex-col">
        <div class="flex items-center justify-between mb-2">
            <div class="text-[10px] uppercase tracking-widest text-yellow-300 font-black">Live Chat</div>
            <button type="button" id="live-chat-close" onclick="toggleLiveChat(false)" class="w-6 h-6 rounded bg-white/5 hover:bg-white/10 text-gray-300 flex items-center justify-center">‚úï</button>
        </div>
        <div id="live-chat-messages" class="flex flex-col gap-2 overflow-y-auto flex-1 pr-2 mb-2"></div>
        <div class="flex gap-2">
            <input id="live-chat-input" type="text" maxlength="140" placeholder="Napi≈° zpr√°vu..." class="flex-1 bg-black/40 border border-yellow-400/20 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-yellow-400/60">
            <button type="button" id="live-chat-send" class="bg-yellow-400 hover:bg-yellow-500 text-black font-black text-xs px-3 rounded-lg">SEND</button>
        </div>
    </div>

    <div id="mobile-menu" class="hidden md:hidden fixed inset-0 z-[120] bg-black/70 backdrop-blur-sm">
        <div class="absolute right-0 top-0 h-full w-80 max-w-[88vw] bg-[#131824] border-l border-yellow-400/30 p-4 space-y-3">
            <div class="flex items-center justify-between"><div class="text-yellow-300 font-black uppercase text-sm">Menu</div><button onclick="toggleMobileMenu(false)" class="text-gray-300">‚úï</button></div>
            <div class="bg-black/40 border border-yellow-300/20 rounded-xl p-3">
                <div id="mobile-balance" class="text-yellow-300 font-black text-lg">0.00 EUR</div>
                <div class="text-[10px] uppercase tracking-wider text-gray-400">Z≈Østatek</div>
            </div>
            <button onclick="switchPage('cases'); toggleMobileMenu(false);" class="w-full text-left bg-white/5 border border-white/10 rounded-xl px-3 py-2 font-black">üéÅ Bedny</button>
            <button onclick="switchPage('inventory'); toggleMobileMenu(false);" class="w-full text-left bg-white/5 border border-white/10 rounded-xl px-3 py-2 font-black">üéí Invent√°≈ô</button>
            <button onclick="switchPage('upgrade'); toggleMobileMenu(false);" class="w-full text-left bg-white/5 border border-white/10 rounded-xl px-3 py-2 font-black">‚¨ÜÔ∏è Upgrade</button>
            <button onclick="switchPage('case-battle'); toggleMobileMenu(false);" class="w-full text-left bg-white/5 border border-white/10 rounded-xl px-3 py-2 font-black">‚öîÔ∏è Case Battle</button>
            <button onclick="switchPage('profile'); toggleMobileMenu(false);" class="w-full text-left bg-white/5 border border-white/10 rounded-xl px-3 py-2 font-black">üë§ Profil</button>
            <button onclick="addFreeMoney(); toggleMobileMenu(false);" class="w-full text-left bg-green-600/30 border border-green-400/40 rounded-xl px-3 py-2 font-black">üí∞ Pen√≠ze zdarma</button>
        </div>
    </div>

    <div id="trade-inbox-panel" class="hidden fixed top-28 right-6 z-[95] w-96 bg-[#131824]/95 border border-yellow-400/30 rounded-2xl p-3 shadow-2xl">
        <div class="flex items-center justify-between mb-2"><div class="font-black text-yellow-300 uppercase text-xs">Notifikace</div><button onclick="toggleTradeInbox(false)" class="text-gray-400">‚úï</button></div>
        <div id="trade-inbox-list" class="space-y-2 max-h-72 overflow-y-auto"></div>
    </div>


    <div class="flex flex-1 overflow-hidden">
        <main class="flex-1 overflow-y-auto bg-[#0b0d11] relative p-3 md:p-8">
            <section id="page-cases" class="page fade-in max-w-[1700px] mx-auto">
                <div class="bg-[#0d1017] border border-white/5 rounded-xl px-6 py-4 flex flex-wrap items-center justify-between gap-4 mb-6">
                    <div id="cases-category-tabs" class="flex flex-wrap items-center gap-2">
                        <button id="tab-all" onclick="setCasesCategoryFilter('all')" class="px-3 py-2 text-xs font-black rounded-md bg-white/10 text-white">All</button>
                        <button id="tab-featured" onclick="setCasesCategoryFilter('featured')" class="px-3 py-2 text-xs font-black rounded-md text-gray-500 hover:text-gray-300">Featured</button>
                        <button id="tab-regular" onclick="setCasesCategoryFilter('regular')" class="px-3 py-2 text-xs font-black rounded-md text-gray-500 hover:text-gray-300">Regular</button>
                                                <button id="tab-cheap" onclick="setCasesCategoryFilter('cheap')" class="px-3 py-2 text-xs font-black rounded-md text-gray-500 hover:text-gray-300">Cheap</button>
                        <button id="tab-premium" onclick="setCasesCategoryFilter('premium')" class="px-3 py-2 text-xs font-black rounded-md text-gray-500 hover:text-gray-300">Premium</button>
                        <button id="tab-high-risk" onclick="setCasesCategoryFilter('high-risk')" class="px-3 py-2 text-xs font-black rounded-md text-gray-500 hover:text-gray-300">High Risk</button>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="relative">
                            <i data-lucide="search" class="w-4 h-4 text-gray-500 absolute left-3 top-1/2 -translate-y-1/2"></i>
                            <input id="cases-search" type="text" oninput="renderCases()" placeholder="Search cases" class="bg-[#161a24] border border-white/10 rounded-md pl-9 pr-3 py-2 text-xs text-gray-200 outline-none focus:border-white/20">
                        </div>
                        <button id="cases-affordable-toggle" onclick="setCasesAffordableOnly(!casesAffordableOnly)" class="px-3 py-2 text-xs font-black rounded-md bg-[#161a24] border border-white/10 text-gray-300">Affordable</button>
                        <button id="cases-sort-toggle" onclick="toggleCasesSortOrder()" class="px-3 py-2 text-xs font-black rounded-md bg-[#161a24] border border-white/10 text-gray-300">Price ‚Üë</button>
                    </div>
                </div>
                <div id="cases-grid"></div>
            </section>
            <section id="page-case-view" class="page hidden fade-in max-w-7xl mx-auto space-y-8">
                <div class="flex items-center">
                    <button onclick="switchPage('cases')" class="text-gray-400 hover:text-white flex items-center gap-2 font-black uppercase text-xs tracking-widest transition-colors">
                        <i data-lucide="arrow-left" class="w-4 h-4"></i>
                        Back to cases
                    </button>
                </div>

                <div class="bg-[#12161f] border border-white/5 rounded-2xl p-6 md:p-8 space-y-8">
                    <div class="text-center flex flex-col items-center gap-4">
                        <h2 id="view-case-name" class="text-3xl font-black uppercase tracking-widest text-white drop-shadow-md">CASE NAME</h2>
                        <div id="view-case-price" class="bg-white/10 border border-white/20 rounded-md px-3 py-1 text-xs font-bold text-gray-300">$0.00</div>
                        <img id="view-case-image" src="" alt="Case" onerror="handleImgError(this)" class="h-48 object-contain drop-shadow-[0_0_40px_rgba(255,255,255,0.15)] hover:scale-105 transition-transform" />
                    </div>

                    <div id="spinner-stack" class="space-y-3"></div>

                    <div id="case-view-controls" class="bg-[#12161f] border border-white/5 rounded-xl p-4 flex flex-wrap items-center justify-between gap-4 mt-6">
                        <div id="case-open-count-buttons" class="flex items-center gap-2">
                            <button type="button" data-open-count="1" onclick="ensureSpinnerRows(1)" class="w-10 h-10 flex items-center justify-center rounded-md font-black text-sm transition-all bg-[#c0f20c] text-black shadow-[0_0_15px_rgba(192,242,12,0.3)]">1</button>
                            <button type="button" data-open-count="2" onclick="ensureSpinnerRows(2)" class="w-10 h-10 flex items-center justify-center rounded-md font-black text-sm transition-all bg-[#1a1e29] text-gray-400 hover:bg-white/10">2</button>
                            <button type="button" data-open-count="3" onclick="ensureSpinnerRows(3)" class="w-10 h-10 flex items-center justify-center rounded-md font-black text-sm transition-all bg-[#1a1e29] text-gray-400 hover:bg-white/10">3</button>
                            <button type="button" data-open-count="4" onclick="ensureSpinnerRows(4)" class="w-10 h-10 flex items-center justify-center rounded-md font-black text-sm transition-all bg-[#1a1e29] text-gray-400 hover:bg-white/10">4</button>
                            <button type="button" data-open-count="5" onclick="ensureSpinnerRows(5)" class="w-10 h-10 flex items-center justify-center rounded-md font-black text-sm transition-all bg-[#1a1e29] text-gray-400 hover:bg-white/10">5</button>
                        </div>
                        <button id="btn-open-case" type="button" class="bg-green-500 hover:bg-green-400 text-black font-black uppercase text-lg px-12 py-3 rounded-lg shadow-[0_0_25px_rgba(34,197,94,0.3)] transition-all transform hover:scale-105 active:scale-95">OPEN FOR $0.00</button>
                        <div class="flex items-center gap-2">
                            <button id="case-fast-open-toggle" type="button" class="bg-[#1a1e29] w-10 h-10 rounded-md flex items-center justify-center text-gray-400 hover:text-white transition-colors">
                                <i data-lucide="zap" class="w-4 h-4"></i>
                            </button>
                            <button id="case-sound-toggle" type="button" class="bg-[#1a1e29] w-10 h-10 rounded-md flex items-center justify-center text-white transition-colors">
                                <i data-lucide="volume-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="bg-[#12161f] border border-white/5 rounded-2xl p-6">
                    <h3 class="text-sm font-black text-gray-400 uppercase mb-4 tracking-widest">SKINS IN THIS CASE</h3>
                    <div id="view-case-contents" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-3"></div>
                </div>
            </section>

            <section id="page-upgrade" class="page hidden max-w-6xl mx-auto space-y-10 fade-in">
                <div class="text-center">
                    <h2 class="text-5xl font-black uppercase italic tracking-tighter text-white">OTODROP <span class="text-purple-500">UPGRADER</span></h2>
                    <p class="text-gray-500 font-bold text-xs uppercase tracking-widest mt-1">Slo≈æ a≈æ 3 skiny dohromady a vyber si cokoliv z datab√°ze</p>
                </div>
                
                <div class="bg-[#14171c] p-10 rounded-3xl border border-white/5 shadow-2xl relative upgrade-glow" id="upgrade-panel">
                    <div class="grid grid-cols-1 md:grid-cols-[1fr_auto_1fr] gap-12 items-center">
                        <div class="space-y-4">
                            <h3 class="text-gray-400 font-black uppercase text-sm tracking-widest text-center mb-2">Tvoje skiny (A≈æ 3)</h3>
                            <div class="flex flex-col gap-3" id="upg-inputs-container"></div>
                            <div class="text-center mt-2">
                                <span class="text-[10px] text-gray-500 font-bold uppercase tracking-widest">Celkov√° hodnota vkladu:</span>
                                <div id="upg-total-input-val" class="text-purple-400 font-black text-xl drop-shadow-lg">0.00 EUR</div>
                            </div>
                        </div>
                        
                        <div class="text-center space-y-6">
                            <div class="relative">
                                <svg class="w-48 h-48 mx-auto transform -rotate-90">
                                    <circle cx="96" cy="96" r="86" stroke="#1f2937" stroke-width="12" fill="transparent" />
                                    <circle id="upgrade-circle" cx="96" cy="96" r="86" stroke="#a855f7" stroke-width="12" fill="transparent" stroke-dasharray="540" stroke-dashoffset="540" class="transition-all duration-1000 ease-out drop-shadow-lg" />
                                </svg>
                                <div id="upgrade-pointer" class="upgrade-pointer"></div>
                                <div class="absolute inset-0 flex items-center justify-center flex-col">
                                    <span id="upgrade-chance" class="text-5xl font-black text-white italic drop-shadow-lg">0%</span>
                                    <span class="text-[10px] text-gray-500 font-bold uppercase tracking-widest">≈†ance</span>
                                </div>
                            </div>
                            <button onclick="attemptUpgrade()" id="btn-upgrade-exec" class="w-full bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-500 hover:to-purple-400 text-white font-black py-5 rounded-2xl uppercase italic shadow-lg shadow-purple-500/30 active:scale-95 transition-all tracking-tighter text-xl">
                                Vylep≈°it
                            </button>
                        </div>
                        
                        <div class="space-y-4 h-full flex flex-col justify-center">
                            <h3 class="text-gray-400 font-black uppercase text-sm tracking-widest text-center mb-2">C√≠lov√Ω skin</h3>
                            <div id="upg-target-slot" onclick="openSelector('target')" class="bg-gradient-to-b from-purple-950/30 to-black/30 border-2 border-dashed border-purple-500/50 hover:border-yellow-400 rounded-3xl h-64 flex flex-col items-center justify-center p-4 relative overflow-hidden cursor-pointer transition-all group">
                                <i data-lucide="search" class="w-10 h-10 text-purple-500/50 group-hover:text-yellow-400 mb-2 transition-colors"></i>
                                <span class="text-gray-500 font-bold uppercase text-xs text-center group-hover:text-white transition-colors">Vyber c√≠l z<br>datab√°ze</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="page-giveaways" class="page hidden max-w-6xl mx-auto space-y-6 fade-in">
                <h2 class="text-3xl font-black uppercase">Giveaways (3 Tiers)</h2>
                <div class="grid md:grid-cols-3 gap-4" id="giveaway-grid"></div>
            </section>

                        <section id="page-case-battle" class="page hidden max-w-6xl mx-auto space-y-6 fade-in">
                <div class="flex flex-wrap items-center justify-between gap-3">
                    <h2 class="text-3xl font-black uppercase">Case Battle Online</h2>
                </div>
                <div id="cb-create-panel" class="space-y-4">
                    <div id="cb-lobby-panel" class="bg-[#12161f] rounded-xl p-4 mb-4 flex items-center justify-between border border-white/10 gap-4">
                        <div class="flex items-center gap-3 flex-wrap">
                            <button class="cb-hub-tab active flex items-center gap-2" data-cb-list="active" onclick="setCaseBattleListTab('active')"><i data-lucide="timer" class="w-4 h-4"></i>Active</button>
                            <button class="cb-hub-tab flex items-center gap-2" data-cb-list="mine" onclick="setCaseBattleListTab('mine')"><i data-lucide="swords" class="w-4 h-4"></i>My Battles</button>
                            <div class="h-6 border-l border-white/10 mx-1"></div>
                            <button class="cb-filter-chip active flex items-center gap-1 text-lime-300" data-cb-filter="classic" onclick="setCaseBattleFilter('classic')"><i data-lucide="flame" class="w-3.5 h-3.5"></i>Classic</button>
                            <button class="cb-filter-chip flex items-center gap-1 text-purple-300" data-cb-filter="underdog" onclick="setCaseBattleFilter('underdog')"><i data-lucide="sparkles" class="w-3.5 h-3.5"></i>Underdog</button>
                            <button class="cb-filter-chip flex items-center gap-1 text-blue-300" data-cb-filter="share" onclick="setCaseBattleFilter('share')"><i data-lucide="share-2" class="w-3.5 h-3.5"></i>Share</button>
                        </div>
                        <div class="flex items-center gap-2 shrink-0">
                            <button class="bg-[#1a1e29] border border-white/10 text-gray-200 rounded-lg px-4 py-3 text-xs font-black uppercase">Affordable</button>
                            <button onclick="openCaseSelectorModal()" class="bg-[#c0f20c] hover:bg-[#a3cc0a] text-black font-black uppercase flex items-center gap-2 px-6 py-3 rounded-lg shadow-[0_0_20px_rgba(192,242,12,0.2)] transition-all"><i data-lucide="plus" class="w-4 h-4"></i>Create Battle</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-[80px_1fr_100px_150px_140px] gap-4 px-6 py-2 border-b border-white/5">
                        <div class="text-[10px] text-gray-500 font-black uppercase tracking-widest">ROUNDS</div>
                        <div class="text-[10px] text-gray-500 font-black uppercase tracking-widest">BATTLE SCENARIO</div>
                        <div class="text-[10px] text-gray-500 font-black uppercase tracking-widest">COST</div>
                        <div class="text-[10px] text-gray-500 font-black uppercase tracking-widest">PLAYERS</div>
                        <div class="text-[10px] text-gray-500 font-black uppercase tracking-widest">STATUS</div>
                    </div>
                    <div id="cb-open-rooms" class="flex flex-col gap-2"></div>
                </div>

                <div id="cb-builder-modal" class="hidden fixed inset-0 z-[150] bg-black/90 backdrop-blur-md p-4">
                    <div class="max-w-6xl mx-auto bg-[#12161f] border border-yellow-400/30 rounded-2xl p-4 h-full flex flex-col">
                        <div class="flex items-center justify-between mb-3">
                            <div class="text-lg font-black uppercase text-yellow-300">Create Case Battle</div>
                            <button onclick="closeCaseBattleBuilder()" class="bg-white/10 hover:bg-white/20 rounded-lg px-3 py-1 text-xs font-black">Close</button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-3">
                            <div class="bg-black/30 border border-white/10 rounded-xl p-3"><div class="text-[10px] uppercase text-gray-400 font-black mb-2">Team Battle Mode</div><div class="grid grid-cols-2 gap-2"><button class="cb-builder-opt active" data-cb-group="teamFormat" data-cb-val="1v1">Solo</button><button class="cb-builder-opt" data-cb-group="teamFormat" data-cb-val="2v2">Team 2v2</button></div></div>
                            <div class="bg-black/30 border border-white/10 rounded-xl p-3"><div class="text-[10px] uppercase text-gray-400 font-black mb-2">Number of Players</div><div class="grid grid-cols-3 gap-2"><button class="cb-builder-opt active" data-cb-group="mode" data-cb-val="1v1">2</button><button class="cb-builder-opt" data-cb-group="mode" data-cb-val="1v1v1">3</button><button class="cb-builder-opt" data-cb-group="mode" data-cb-val="1v1v1v1">4</button></div></div>
                            <div class="bg-black/30 border border-white/10 rounded-xl p-3"><div class="text-[10px] uppercase text-gray-400 font-black mb-2">Case Battle Mode</div><div class="grid grid-cols-3 gap-2"><button class="cb-builder-opt active" data-cb-group="gameMode" data-cb-val="classic">Classic</button><button class="cb-builder-opt" data-cb-group="gameMode" data-cb-val="underdog">Underdog</button><button class="cb-builder-opt" data-cb-group="gameMode" data-cb-val="share">Share</button></div></div>
                            <div class="bg-black/30 border border-white/10 rounded-xl p-3"><div class="text-[10px] uppercase text-gray-400 font-black mb-2">Privacy</div><div class="grid grid-cols-2 gap-2"><button class="cb-builder-opt active" data-cb-group="privacy" data-cb-val="public">Public</button><button class="cb-builder-opt" data-cb-group="privacy" data-cb-val="private">Private</button></div></div>
                        </div>
                        <div class="bg-black/30 border border-dashed border-yellow-400/40 rounded-xl p-3 mb-3">
                            <div class="flex flex-wrap items-center justify-between gap-2">
                                <div class="text-xs text-gray-300">Battle Scenario Queue</div>
                            </div>
                            <button onclick="openCaseSelectorModal()" class="mt-2 w-full h-16 rounded-xl border border-dashed border-yellow-300/45 bg-[#161a24] hover:bg-[#1a1e29] transition-all flex items-center justify-center gap-2 text-yellow-200 font-black uppercase">
                                <i data-lucide="plus" class="w-4 h-4"></i> Add case
                            </button>
                            <div id="cb-builder-queue" class="mt-2 flex gap-2 overflow-x-auto pb-1"></div>
                            <div class="mt-2 flex items-center justify-between text-xs"><div>Rounds: <span id="cb-builder-rounds" class="text-yellow-300 font-black">0</span></div><div>Total: <span id="cb-builder-total" class="text-yellow-300 font-black">0.00 EUR</span></div></div>
                        </div>
                        <div class="mt-auto flex justify-end gap-2">
                            <button onclick="closeCaseBattleBuilder()" class="bg-white/10 rounded-lg px-3 py-2 text-xs font-black">Cancel</button>
                            <button onclick="createCaseBattleRoom()" class="bg-green-500 text-black rounded-lg px-4 py-2 text-xs font-black uppercase">Create battle</button>
                        </div>
                    </div>
                </div>

                

                <div id="cb-room-panel" class="hidden flex flex-col bg-[#0b0d11] rounded-2xl overflow-hidden border border-white/10">
                    <div class="px-4 py-3 bg-[#12161f] border-b border-white/10 flex items-center gap-3">
                        <div class="shrink-0 px-3 py-2 rounded-xl border border-yellow-400 text-yellow-300 bg-black/30 shadow-[0_0_14px_rgba(250,204,21,0.25)]">
                            <div class="text-[10px] uppercase font-black">Battle Rounds</div>
                            <div id="cb-round-counter" class="text-lg font-black leading-none">1 of 1</div>
                        </div>
                        <div id="cb-case-queue" class="flex-1 overflow-x-auto whitespace-nowrap flex gap-2 pb-1"></div>
                        <div class="text-right shrink-0">
                            <div class="text-[10px] uppercase text-gray-500 font-black">Battle Value</div>
                            <div id="cb-total-value" class="text-yellow-400 font-black text-2xl drop-shadow-[0_0_15px_rgba(250,204,21,0.5)]">0.00 EUR</div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 bg-[#0d1017] border-b border-white/5 relative">
                        <div id="cb-team-left-head" class="p-3 border-r border-[#1a1e29] flex items-center justify-between">
                            <div class="text-blue-300 font-black uppercase text-xs flex items-center gap-2"><i data-lucide="shield" class="w-4 h-4"></i>COUNTER-TERRORIST <span id="cb-team1-lead" class="hidden text-green-400">‚Üë</span></div>
                            <div id="cb-team1-score" class="font-black text-gray-300">0.00 EUR</div>
                        </div>
                        <div id="cb-team-right-head" class="p-3 flex items-center justify-between">
                            <div class="text-orange-300 font-black uppercase text-xs flex items-center gap-2"><i data-lucide="swords" class="w-4 h-4"></i>TERRORIST <span id="cb-team2-lead" class="hidden text-green-400">‚Üë</span></div>
                            <div id="cb-team2-score" class="font-black text-gray-300">0.00 EUR</div>
                        </div>
                        <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-10 h-10 rounded-xl bg-black/80 ring-2 ring-green-500 shadow-[0_0_15px_rgba(34,197,94,0.4)] grid place-items-center text-xs font-black text-green-300">VS</div>
                    </div>

                    <div id="cb-stage" class="grid grid-cols-2 gap-[2px] bg-[#1a1e29] p-[2px]"></div>
                    <div id="cb-log" class="bg-black/40 border-t border-white/5 p-3 h-40 overflow-y-auto text-sm"></div>
                </div>
            </section>

            <section id="page-inventory" class="page hidden max-w-7xl mx-auto space-y-8 fade-in">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-end gap-4 border-b border-white/5 pb-6">
                    <div>
                        <h2 class="text-4xl font-black uppercase italic tracking-tighter text-white">M≈ÆJ <span class="text-yellow-400">INVENT√Å≈ò</span></h2>
                        <p id="inv-stats" class="text-gray-500 font-bold text-xs uppercase tracking-widest mt-1">0 p≈ôedmƒõt≈Ø v hodnotƒõ 0.00 EUR</p>
                    </div>
                    <div class="flex gap-2">
                        <select id="inv-filter" class="bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white font-bold text-sm uppercase cursor-pointer" onchange="filterInventory()">
                            <option value="all">V≈°echny</option>
                            <option value="blue">Modr√©</option>
                            <option value="purple">Fialov√©</option>
                            <option value="pink">R≈Ø≈æov√©</option>
                            <option value="red">ƒåerven√©</option>
                            <option value="gold">Zlat√©</option>
                            <option value="knives">No≈æe</option>
                        </select>
                        <select id="inv-sort" class="bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white font-bold text-sm uppercase cursor-pointer" onchange="sortInventory()">
                            <option value="newest">Nejnovƒõj≈°√≠</option>
                            <option value="price-high">Cena (vysok√°)</option>
                            <option value="price-low">Cena (n√≠zk√°)</option>
                            <option value="name">Jm√©no (A-Z)</option>
                        </select>
                        <button onclick="sellAllSkins()" class="bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white px-6 py-2 rounded-lg font-bold text-xs transition-all border border-red-500/20 uppercase tracking-widest">
                            Prodat v≈°e
                        </button>
                    </div>
                </div>
                <div id="inventory-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4"></div>
            </section>

            <section id="page-profile" class="page hidden max-w-6xl mx-auto space-y-6 fade-in">
                <h2 class="text-3xl font-black uppercase">Profil & P≈ô√°tel√©</h2>
                <div class="bg-[#14171c] border border-yellow-400/25 rounded-2xl p-4">
                    <h3 class="font-black text-xl mb-3">M≈Øj ve≈ôejn√Ω profil</h3>
                    <div id="my-public-profile-card" class="space-y-3"></div>
                    <div id="my-public-profile-inventory" class="mt-3 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2"></div>
                </div>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="bg-[#14171c] border border-yellow-400/20 rounded-2xl p-4 space-y-3">
                        <input id="profile-phone" type="text" maxlength="32" placeholder="Telefon" class="w-full bg-black/40 border border-yellow-400/20 rounded-xl px-3 py-2 text-white">
                        <button onclick="saveLocalProfile()" class="bg-green-600 hover:bg-green-500 px-4 py-2 rounded-xl font-black">Ulo≈æit profil</button>
                        <div class="pt-3 border-t border-white/10 space-y-2">
                            <div class="text-xs text-gray-400">Top-up (limitovan√Ω)</div>
                            <div class="flex gap-2"><input id="topup-amount" type="number" min="1" max="25" value="10" class="flex-1 bg-black/40 border border-yellow-400/20 rounded-xl px-3 py-2 text-white"><button onclick="requestTopUp()" class="bg-yellow-400 text-black font-black rounded-xl px-4">Top-up</button></div>
                        </div>
                    </div>
                    <div class="bg-[#14171c] border border-yellow-400/20 rounded-2xl p-4 space-y-3">
                        <div class="flex gap-2"><input id="friend-search" type="text" placeholder="Najdi u≈æivatele" class="flex-1 bg-black/40 border border-yellow-400/20 rounded-xl px-3 py-2 text-white"><button onclick="searchUsers()" class="bg-blue-500 text-white font-black rounded-xl px-4">Hledat</button></div>
                        <div id="friend-search-results" class="space-y-2 max-h-48 overflow-y-auto"></div>
                        <h3 class="font-black">Moji p≈ô√°tel√©</h3>
                        <div id="friends-list" class="space-y-2 max-h-48 overflow-y-auto"></div>
                    </div>
                </div>
            </section>

            <section id="page-admin" class="page hidden max-w-6xl mx-auto space-y-6 fade-in">
                <h2 class="text-3xl font-black uppercase">Admin panel</h2>
                <div class="bg-[#14171c] border border-yellow-400/20 rounded-2xl p-4 space-y-3">
                    <button onclick="loadAdminUsers()" class="bg-yellow-400 text-black font-black rounded-xl px-4 py-2">Naƒç√≠st u≈æivatele</button>
                    <div id="admin-users" class="space-y-2 max-h-[60vh] overflow-y-auto"></div>
                </div>
            </section>

            <section id="page-user-profile" class="page hidden max-w-6xl mx-auto space-y-6 fade-in">
                <button onclick="switchPage('profile')" class="text-gray-400 text-xs uppercase font-black">‚Üê Zpƒõt na profil</button>
                <div id="user-profile-card" class="bg-[#14171c] border border-yellow-400/30 rounded-2xl p-5"></div>
                <div class="bg-[#14171c] border border-yellow-400/20 rounded-2xl p-4">
                    <h3 class="font-black text-xl mb-3">Invent√°≈ô u≈æivatele</h3>
                    <div id="user-profile-inventory" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2"></div>
                    <button id="open-trade-builder-btn" class="mt-4 bg-yellow-400 text-black font-black px-4 py-2 rounded-xl">Poslat obchodn√≠ nab√≠dku</button>
                </div>
            </section>

            <div id="trade-builder-modal" class="hidden fixed inset-0 z-[120] bg-black/80 backdrop-blur-sm items-center justify-center">
                <div class="w-[95vw] max-w-6xl bg-[#14171c] border border-yellow-400/30 rounded-2xl p-4">
                    <div class="flex items-center justify-between mb-3"><h3 class="font-black text-xl">Trade builder</h3><button onclick="closeTradeBuilder()" class="text-gray-300">‚úï</button></div>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div><div class="text-xs text-gray-400 mb-2">Moje itemy</div><div id="trade-my-items" class="grid grid-cols-3 gap-2 max-h-80 overflow-y-auto"></div></div>
                        <div><div class="text-xs text-gray-400 mb-2">Jeho itemy</div><div id="trade-target-items" class="grid grid-cols-3 gap-2 max-h-80 overflow-y-auto"></div></div>
                    </div>
                    <button id="trade-send-btn" class="mt-4 bg-yellow-400 text-black font-black px-4 py-2 rounded-xl">Poslat obchodn√≠ nab√≠dku</button>
                </div>
            </div>

            <section id="page-selector" class="page hidden max-w-7xl mx-auto space-y-8 fade-in">
                <div class="flex items-center justify-between border-b border-white/10 pb-6">
                    <div>
                        <button onclick="switchPage('upgrade')" class="text-gray-500 hover:text-white flex items-center gap-2 font-bold uppercase text-xs tracking-widest transition-colors mb-2">
                            <i data-lucide="arrow-left" class="w-4 h-4"></i> Zpƒõt do Upgraderu
                        </button>
                        <h2 id="selector-title" class="text-4xl font-black uppercase italic tracking-tighter text-white">VYBER SKIN</h2>
                    </div>
                </div>
                <div class="flex justify-end"><select id="selector-sort" class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white font-bold text-xs uppercase" onchange="selectorOffset = 0; renderSelectorPage()"><option value="price-low">Cena: nejni≈æ≈°√≠</option><option value="price-high">Cena: nejvy≈°≈°√≠</option><option value="name">Jm√©no A-Z</option></select></div><div id="selector-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4"></div>
            </section>

        </main>
    </div>

    <div id="auth-modal" class="fixed inset-0 z-[110] hidden items-center justify-center bg-black/80 backdrop-blur-sm">
        <div class="w-full max-w-lg bg-[#131824] border border-yellow-400/30 rounded-3xl p-6 shadow-[0_0_60px_rgba(250,204,21,0.18)]">
            <div class="flex items-center justify-between mb-5">
                <h3 class="text-2xl font-black uppercase italic tracking-tighter text-white">√öƒçet (DB backend)</h3>
                <button onclick="closeAuthModal()" class="text-gray-500 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <p class="text-[12px] text-gray-400 mb-4">Registrace i login jsou p≈ôes backend. Nov√Ω √∫ƒçet startuje s 10 USD a bez mo≈ænosti dobit√≠.</p>
            <div class="space-y-3">
                <input id="auth-email" type="email" maxlength="120" placeholder="E-mail" class="w-full bg-black/40 border border-yellow-400/20 rounded-xl px-3 py-2 text-white">
                <input id="auth-password" type="password" maxlength="120" placeholder="Heslo (min. 6 znak≈Ø)" class="w-full bg-black/40 border border-yellow-400/20 rounded-xl px-3 py-2 text-white">
                <input id="profile-nickname" type="text" maxlength="24" placeholder="Nickname" class="w-full bg-black/40 border border-yellow-400/20 rounded-xl px-3 py-2 text-white">
                <input id="profile-display-name" type="text" maxlength="32" placeholder="Display jm√©no" class="w-full bg-black/40 border border-yellow-400/20 rounded-xl px-3 py-2 text-white">
                <input id="profile-avatar" type="url" placeholder="URL profilov√© fotky" class="w-full bg-black/40 border border-yellow-400/20 rounded-xl px-3 py-2 text-white">
                <input id="profile-phone-auth" type="text" maxlength="32" placeholder="Telefon" class="w-full bg-black/40 border border-yellow-400/20 rounded-xl px-3 py-2 text-white">
                <div class="grid grid-cols-2 gap-3 pt-1">
                    <button onclick="registerAccount()" class="bg-yellow-400 hover:bg-yellow-500 text-black font-black uppercase rounded-xl py-3">Registrovat</button>
                    <button onclick="loginAccount()" class="bg-blue-500 hover:bg-blue-400 text-white font-black uppercase rounded-xl py-3">P≈ôihl√°sit</button>
                    <button onclick="saveLocalProfile()" class="bg-green-600 hover:bg-green-500 text-white font-black uppercase rounded-xl py-3">Ulo≈æit profil</button>
                    <button onclick="logoutLocalProfile()" class="bg-red-500/20 hover:bg-red-500 text-red-300 hover:text-white font-black uppercase rounded-xl py-3 border border-red-400/40">Odhl√°sit</button>
                </div>
                <div class="grid grid-cols-2 gap-3 pt-1">
                    <button id="steam-login-btn" onclick="socialLogin('steam')" class="bg-[#171a21] hover:bg-[#2a475e] text-white font-black uppercase rounded-xl py-3 border border-white/10">Steam Login</button>
                    <button id="google-login-btn" onclick="socialLogin('google')" class="bg-white hover:bg-gray-200 text-black font-black uppercase rounded-xl py-3">Google Login</button>
                </div>
                <p id="admin-hint" class="text-[11px] text-yellow-300 hidden">Jsi admin. P≈ôehled hr√°ƒç≈Ø: <code>GET /api/admin/users</code></p>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-10 right-10 bg-yellow-400 text-black px-8 py-4 rounded-2xl font-black shadow-2xl opacity-0 transform translate-y-10 transition-all duration-300 z-[100] uppercase italic tracking-tighter text-lg border-2 border-yellow-300">
        Akce √∫spƒõ≈°n√°!
    </div>

    <script>
        const FALLBACK_IMG = "https://community.cloudflare.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpot7HxfDhjx2jJemkV09-5lpS0lfL3D7fQmGRu58ByiOXO89Wj2Vbtr0BkZmmhcI7HclM4M1vXq1LtxLrugcG8tZ7IznFr6SIn43_D30vgT85F9rU";
        const UPGRADER_ICON = "data:image/svg+xml;utf8," + encodeURIComponent('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 64 64\"><rect width=\"64\" height=\"64\" rx=\"12\" fill=\"%2314181c\"/><path d=\"M12 46L46 12M46 12H26M46 12V32\" stroke=\"%23facc15\" stroke-width=\"6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>');
        
        function toCachedImage(url) {
            const raw = (url || '').toString().trim();
            return raw;
        }

        const preloadedSkinUrls = new Set();
        function warmImageUrl(url) {
            if (!url || preloadedSkinUrls.has(url)) return;
            preloadedSkinUrls.add(url);
            const im = new Image();
            im.decoding = 'async';
            im.src = url;
        }

        function warmCriticalSkinImages(limit = 120) {
            const all = Object.values(skinsDB || {});
            const byPrice = [...all].sort((a, b) => Number(a.price || 0) - Number(b.price || 0));
            byPrice.slice(0, limit).forEach((skin) => {
                warmImageUrl(skin.img);
                (skin.imgAlts || []).forEach(warmImageUrl);
            });
        }

        function handleImgError(img) {
            const retryCount = Number(img.dataset.retryCount || 0);
            if (retryCount < 1) {
                img.dataset.retryCount = String(retryCount + 1);
                const original = (img.dataset.originalSrc || img.getAttribute('src') || '').trim();
                if (original) {
                    img.dataset.originalSrc = original;
                    setTimeout(() => {
                        img.onerror = handleImgError;
                        img.src = `${original}${original.includes('?') ? '&' : '?'}retry=${Date.now()}`;
                    }, 1000);
                    return;
                }
            }
            try {
                const alts = (img.dataset.alts || '').split('|').filter(Boolean);
                if(alts.length > 0) {
                    img.onerror = null;
                    img.src = alts.shift();
                    img.dataset.alts = alts.join('|');
                    img.dataset.retryCount = '0';
                    img.onerror = handleImgError;
                    return;
                }
            } catch(e) { /* ignore */ }
            img.onerror = null;
            img.src = FALLBACK_IMG;
            img.classList.add('fallback-img');
        }
    </script>

    <script>
        // --- AUDIO ENGINE (Web Audio API) ---
        let audioCtx;
        let audioInitialized = false;

        function initAudio() {
            if(!audioInitialized) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                audioInitialized = true;
            } else if(audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        const SoundEngine = {
            playTick: () => {
                if(!audioCtx) return;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(800, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(400, audioCtx.currentTime + 0.03);
                gain.gain.setValueAtTime(0.12, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.03);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.03);
            },
            playWin: (rarity) => {
                if(!audioCtx) return;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.type = 'square';
                
                let baseFreq = rarity === 'gold' ? 523.25 : (rarity === 'red' ? 440 : 329.63); // C5, A4, E4
                osc.frequency.setValueAtTime(baseFreq, audioCtx.currentTime);
                osc.frequency.setValueAtTime(baseFreq * 1.25, audioCtx.currentTime + 0.1);
                osc.frequency.setValueAtTime(baseFreq * 1.5, audioCtx.currentTime + 0.2);
                
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 1.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 1.5);
            },
            playUpgradeProcess: () => {
                if(!audioCtx) return null;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 2); // stoup√° 2 sekundy
                gain.gain.setValueAtTime(0.12, audioCtx.currentTime);
                osc.start();
                return { osc, gain };
            },
            playUpgradeFail: () => {
                if(!audioCtx) return;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.5);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            }
        };

        // --- STAV A DATAB√ÅZE ---
        let balanceBase = 10.00;
        const KNIFE_TYPES = [
            "Bayonet", "Bowie Knife", "Butterfly Knife", "Classic Knife", "Falchion Knife", "Flip Knife", "Gut Knife",
            "Huntsman Knife", "Karambit", "M9 Bayonet", "Navaja Knife", "Nomad Knife", "Paracord Knife", "Shadow Daggers",
            "Skeleton Knife", "Stiletto Knife", "Survival Knife", "Talon Knife", "Ursus Knife", "Kukri Knife"
        ];
        const KNIFE_ALLOWED_FINISHES = {
            "Bayonet": ["Autotronic","Black Laminate","Blue Steel","Boreal Forest","Bright Water","Case Hardened","Crimson Web","Damascus Steel","Doppler","Fade","Forest DDPAT","Freehand","Gamma Doppler","Lore","Marble Fade","Night","Rust Coat","Safari Mesh","Scorched","Slaughter","Stained","Tiger Tooth","Ultraviolet","Urban Masked"],
            "Bowie Knife": ["Autotronic","Black Laminate","Blue Steel","Boreal Forest","Bright Water","Case Hardened","Crimson Web","Damascus Steel","Doppler","Fade","Forest DDPAT","Freehand","Gamma Doppler","Lore","Marble Fade","Night","Rust Coat","Safari Mesh","Scorched","Slaughter","Stained","Tiger Tooth","Ultraviolet","Urban Masked"],
            "Butterfly Knife": ["Autotronic","Black Laminate","Blue Steel","Boreal Forest","Bright Water","Case Hardened","Crimson Web","Damascus Steel","Doppler","Fade","Forest DDPAT","Freehand","Gamma Doppler","Lore","Marble Fade","Night","Rust Coat","Safari Mesh","Scorched","Slaughter","Stained","Tiger Tooth","Ultraviolet","Urban Masked"],
            "Classic Knife": ["Blue Steel","Boreal Forest","Case Hardened","Crimson Web","Fade","Forest DDPAT","Night Stripe","Safari Mesh","Scorched","Slaughter","Stained","Urban Masked"],
            "Falchion Knife": ["Autotronic","Black Laminate","Blue Steel","Boreal Forest","Bright Water","Case Hardened","Crimson Web","Damascus Steel","Doppler","Fade","Forest DDPAT","Freehand","Gamma Doppler","Lore","Marble Fade","Night","Rust Coat","Safari Mesh","Scorched","Slaughter","Stained","Tiger Tooth","Ultraviolet","Urban Masked"],
            "Flip Knife": ["Autotronic","Black Laminate","Blue Steel","Boreal Forest","Bright Water","Case Hardened","Crimson Web","Damascus Steel","Doppler","Fade","Forest DDPAT","Freehand","Gamma Doppler","Lore","Marble Fade","Night","Rust Coat","Safari Mesh","Scorched","Slaughter","Stained","Tiger Tooth","Ultraviolet","Urban Masked"],
            "Gut Knife": ["Autotronic","Black Laminate","Blue Steel","Boreal Forest","Bright Water","Case Hardened","Crimson Web","Damascus Steel","Doppler","Fade","Forest DDPAT","Freehand","Gamma Doppler","Lore","Marble Fade","Night","Rust Coat","Safari Mesh","Scorched","Slaughter","Stained","Tiger Tooth","Ultraviolet","Urban Masked"],
            "Huntsman Knife": ["Autotronic","Black Laminate","Blue Steel","Boreal Forest","Bright Water","Case Hardened","Crimson Web","Damascus Steel","Doppler","Fade","Forest DDPAT","Freehand","Gamma Doppler","Lore","Marble Fade","Night","Rust Coat","Safari Mesh","Scorched","Slaughter","Stained","Tiger Tooth","Ultraviolet","Urban Masked"],
            "Karambit": ["Autotronic","Black Laminate","Blue Steel","Boreal Forest","Bright Water","Case Hardened","Crimson Web","Damascus Steel","Doppler","Fade","Forest DDPAT","Freehand","Gamma Doppler","Lore","Marble Fade","Night","Rust Coat","Safari Mesh","Scorched","Slaughter","Stained","Tiger Tooth","Ultraviolet","Urban Masked"],
            "Kukri Knife": ["Blue Steel","Boreal Forest","Case Hardened","Crimson Web","Fade","Forest DDPAT","Night Stripe","Safari Mesh","Scorched","Slaughter","Stained","Urban Masked"],
            "M9 Bayonet": ["Autotronic","Black Laminate","Blue Steel","Boreal Forest","Bright Water","Case Hardened","Crimson Web","Damascus Steel","Doppler","Fade","Forest DDPAT","Freehand","Gamma Doppler","Lore","Marble Fade","Night","Rust Coat","Safari Mesh","Scorched","Slaughter","Stained","Tiger Tooth","Ultraviolet","Urban Masked"],
            "Navaja Knife": ["Blue Steel","Boreal Forest","Case Hardened","Crimson Web","Damascus Steel","Doppler","Fade","Forest DDPAT","Marble Fade","Night Stripe","Rust Coat","Safari Mesh","Scorched","Slaughter","Stained","Tiger Tooth","Ultraviolet","Urban Masked"],
            "Nomad Knife": ["Blue Steel","Boreal Forest","Case Hardened","Crimson Web","Fade","Forest DDPAT","Night Stripe","Safari Mesh","Scorched","Slaughter","Stained","Urban Masked"],
            "Paracord Knife": ["Blue Steel","Boreal Forest","Case Hardened","Crimson Web","Fade","Forest DDPAT","Night Stripe","Safari Mesh","Scorched","Slaughter","Stained","Urban Masked"],
            "Shadow Daggers": ["Autotronic","Black Laminate","Blue Steel","Boreal Forest","Bright Water","Case Hardened","Crimson Web","Damascus Steel","Doppler","Fade","Forest DDPAT","Freehand","Gamma Doppler","Lore","Marble Fade","Night","Rust Coat","Safari Mesh","Scorched","Slaughter","Stained","Tiger Tooth","Ultraviolet","Urban Masked"],
            "Skeleton Knife": ["Blue Steel","Boreal Forest","Case Hardened","Crimson Web","Fade","Forest DDPAT","Night Stripe","Safari Mesh","Scorched","Slaughter","Stained","Urban Masked"],
            "Stiletto Knife": ["Blue Steel","Boreal Forest","Case Hardened","Crimson Web","Damascus Steel","Doppler","Fade","Forest DDPAT","Marble Fade","Night Stripe","Rust Coat","Safari Mesh","Scorched","Slaughter","Stained","Tiger Tooth","Ultraviolet","Urban Masked"],
            "Survival Knife": ["Blue Steel","Boreal Forest","Case Hardened","Crimson Web","Fade","Forest DDPAT","Night Stripe","Safari Mesh","Scorched","Slaughter","Stained","Urban Masked"],
            "Talon Knife": ["Blue Steel","Boreal Forest","Case Hardened","Crimson Web","Damascus Steel","Doppler","Fade","Forest DDPAT","Marble Fade","Night Stripe","Rust Coat","Safari Mesh","Scorched","Slaughter","Stained","Tiger Tooth","Ultraviolet","Urban Masked"],
            "Ursus Knife": ["Blue Steel","Boreal Forest","Case Hardened","Crimson Web","Damascus Steel","Doppler","Fade","Forest DDPAT","Marble Fade","Night Stripe","Rust Coat","Safari Mesh","Scorched","Slaughter","Stained","Tiger Tooth","Ultraviolet","Urban Masked"]
        };

        // 300+ RE√ÅLN√ùCH SKIN≈Æ - KOMPLETN√ç DATAB√ÅZE CS2
        // Duplicitn√≠ polo≈æky odstranƒõny, n√°zvy a ceny ovƒõ≈ôeny dle https://csgostash.com/ a https://steamcommunity.com/market/
        const rawSkinData = `
AK-47|Aphrodite|1450.00|#eb4b4b
AK-47|Aquamarine Revenge|110.00|#eb4b4b
AK-47|Asiimov|165.00|#eb4b4b
AK-47|Baroque Purple|15.50|#5e98d9
AK-47|Black Laminate|35.00|#4b69ff
AK-47|Bloodsport|130.00|#eb4b4b
AK-47|Breakthrough|45.00|#8847ff
AK-47|Case Hardened|250.00|#d32ee6
AK-47|Crossfade|22.00|#4b69ff
AK-47|Elite Build|5.50|#4b69ff
AK-47|Emerald Pinstripe|12.00|#8847ff
AK-47|Fire Serpent|850.00|#eb4b4b
AK-47|First Class|95.00|#8847ff
AK-47|Frontside Misty|65.00|#d32ee6
AK-47|Fuel Injector|420.00|#eb4b4b
AK-47|Gold Arabesque|3200.00|#eb4b4b
AK-47|Head Shot|120.00|#eb4b4b
AK-47|Inheritance|180.00|#eb4b4b
AK-47|Ice Coaled|25.00|#d32ee6
AK-47|Jaguar|140.00|#eb4b4b
AK-47|Jet Set|190.00|#d32ee6
AK-47|Jungle Spray|18.50|#5e98d9
AK-47|Legion of Anubis|25.00|#eb4b4b
AK-47|Leet Museo|45.00|#eb4b4b
AK-47|Midnight Laminate|42.00|#8847ff
AK-47|Neon Revolution|75.00|#eb4b4b
AK-47|Neon Rider|150.00|#eb4b4b
AK-47|Nightwish|110.00|#eb4b4b
AK-47|Nouveau Rouge|38.00|#d32ee6
AK-47|Olive Polycam|2.50|#5e98d9
AK-47|Orbit Mk01|28.00|#8847ff
AK-47|Panthera onca|350.00|#d32ee6
AK-47|Phantom Disruptor|15.00|#d32ee6
AK-47|Point Disarray|45.00|#d32ee6
AK-47|Predator|25.00|#5e98d9
AK-47|Rat Rod|12.00|#8847ff
AK-47|Red Laminate|180.00|#d32ee6
AK-47|Redline|85.00|#d32ee6
AK-47|Safari Mesh|1.50|#5e98d9
AK-47|Safety Net|45.00|#8847ff
AK-47|Searing Rage|140.00|#d32ee6
AK-47|Slate|10.50|#8847ff
AK-47|Steel Delta|5.00|#4b69ff
AK-47|The Empress|160.00|#eb4b4b
AK-47|The Oligarch|320.00|#eb4b4b
AK-47|The Outsiders|42.00|#d32ee6
AK-47|Uncharted|1.20|#4b69ff
AK-47|Vulcan|850.00|#eb4b4b
AK-47|Wasteland Rebel|55.00|#eb4b4b
AK-47|Wild Lotus|12000.00|#eb4b4b
AK-47|Wintergreen|22.00|#4b69ff
AK-47|X-Ray|1800.00|#eb4b4b
AUG|Akihabara Accept|4500.00|#eb4b4b
AUG|Amber Fade|8.50|#4b69ff
AUG|Amber Slipstream|1.50|#4b69ff
AUG|Anodized Navy|35.00|#4b69ff
AUG|Aristocrat|2.50|#8847ff
AUG|Bengal Tiger|35.00|#d32ee6
AUG|Carved Jade|15.00|#4b69ff
AUG|Chameleon|12.00|#eb4b4b
AUG|Colony|0.80|#b0c3d9
AUG|Condemned|4.50|#5e98d9
AUG|Contractor|0.80|#b0c3d9
AUG|Copperhead|55.00|#4b69ff
AUG|Creep|12.50|#4b69ff
AUG|Daedalus|3.50|#b0c3d9
AUG|Death by Puppy|18.00|#d32ee6
AUG|Eye of Zapems|28.00|#8847ff
AUG|Flame J√∂rmungandr|320.00|#8847ff
AUG|Fleet Flock|8.00|#d32ee6
AUG|Hot Rod|180.00|#4b69ff
AUG|Lil' Pig|25.00|#d32ee6
AUG|Luxe Trim|4.50|#4b69ff
AUG|Midnight Lily|280.00|#8847ff
AUG|Momentum|14.00|#d32ee6
AUG|Navy Murano|2.50|#b0c3d9
AUG|Plague|1.20|#4b69ff
AUG|Radiation Hazard|12.00|#5e98d9
AUG|Random Access|15.00|#8847ff
AUG|Ricochet|0.90|#4b69ff
AUG|Sand Storm|4.50|#8847ff
AUG|Snake Pit|1.10|#b0c3d9
AUG|Spalted Wood|2.20|#5e98d9
AUG|Steel Sentinel|3.80|#5e98d9
AUG|Storm|0.80|#b0c3d9
AUG|Stymphalian|10.00|#d32ee6
AUG|Surveillance|4.50|#b0c3d9
AUG|Sweeper|0.80|#b0c3d9
AUG|Syd Mead|12.00|#d32ee6
AUG|Tom Cat|1.10|#4b69ff
AUG|Torque|7.50|#8847ff
AUG|Trigger Discipline|4.50|#4b69ff
AUG|Triqua|1.10|#4b69ff
AUG|Wings|45.00|#4b69ff
AWP|Acheron|4.50|#4b69ff
AWP|Arsenic Spill|12.50|#4b69ff
AWP|Asiimov|190.00|#eb4b4b
AWP|Atheris|12.00|#8847ff
AWP|Black Nile|8.50|#4b69ff
AWP|BOOM|250.00|#d32ee6
AWP|Capillary|1.80|#4b69ff
AWP|Chrome Cannon|180.00|#eb4b4b
AWP|Chromatic Aberration|45.00|#eb4b4b
AWP|CMYK|140.00|#eb4b4b
AWP|Containment Breach|280.00|#eb4b4b
AWP|Corticera|45.00|#d32ee6
AWP|Crakow!|95.00|#d32ee6
AWP|Desert Hydra|3500.00|#eb4b4b
AWP|Dragon Lore|12000.00|#eb4b4b
AWP|Duality|25.00|#d32ee6
AWP|Electric Hive|95.00|#d32ee6
AWP|Elite Build|22.00|#d32ee6
AWP|Exoskeleton|8.50|#8847ff
AWP|Exothermic|35.00|#8847ff
AWP|Fade|1450.00|#eb4b4b
AWP|Fever Dream|15.00|#d32ee6
AWP|Graphite|280.00|#d32ee6
AWP|Green Energy|55.00|#d32ee6
AWP|Gungnir|15000.00|#eb4b4b
AWP|Hyper Beast|120.00|#eb4b4b
AWP|Ice Coaled|32.00|#d32ee6
AWP|Lightning Strike|850.00|#eb4b4b
AWP|LongDog|180.00|#eb4b4b
AWP|Man-o'-war|65.00|#eb4b4b
AWP|Medusa|6500.00|#eb4b4b
AWP|Mortis|8.50|#d32ee6
AWP|Neo-Noir|55.00|#eb4b4b
AWP|Oni Taiji|750.00|#eb4b4b
AWP|PAW|7.50|#8847ff
AWP|Phobos|5.50|#8847ff
AWP|Pink DDPAT|140.00|#8847ff
AWP|Pit Viper|12.00|#8847ff
AWP|POP AWP|14.00|#8847ff
AWP|Printstream|320.00|#eb4b4b
AWP|Redline|120.00|#d32ee6
AWP|Safari Mesh|1.20|#5e98d9
AWP|Silk Tiger|350.00|#d32ee6
AWP|Snake Camo|125.00|#4b69ff
AWP|Sun in Leo|45.00|#5e98d9
AWP|The End|85.00|#d32ee6
AWP|The Prince|5500.00|#eb4b4b
AWP|Wildfire|150.00|#eb4b4b
AWP|Worm God|2.50|#8847ff
CZ75-Auto|Army Sheen|0.80|#b0c3d9
CZ75-Auto|Chalice|380.00|#8847ff
CZ75-Auto|Circaetus|1.10|#4b69ff
CZ75-Auto|Copper Fiber|3.50|#5e98d9
CZ75-Auto|Crimson Web|12.00|#4b69ff
CZ75-Auto|Distressed|0.90|#4b69ff
CZ75-Auto|Eco|2.50|#8847ff
CZ75-Auto|Emerald|35.00|#4b69ff
CZ75-Auto|Emerald Quartz|45.00|#4b69ff
CZ75-Auto|Framework|1.10|#b0c3d9
CZ75-Auto|Green Plaid|1.50|#b0c3d9
CZ75-Auto|Hexane|2.50|#4b69ff
CZ75-Auto|Honey Paisley|0.90|#b0c3d9
CZ75-Auto|Imprint|0.90|#4b69ff
CZ75-Auto|Indigo|1.50|#b0c3d9
CZ75-Auto|Jungle Dashed|0.80|#b0c3d9
CZ75-Auto|Midnight Palm|3.50|#5e98d9
CZ75-Auto|Nitro|120.00|#4b69ff
CZ75-Auto|Pink Pearl|1.50|#b0c3d9
CZ75-Auto|Poison Dart|4.50|#4b69ff
CZ75-Auto|Pole Position|2.50|#8847ff
CZ75-Auto|Polymer|0.90|#4b69ff
CZ75-Auto|Red Astor|2.50|#8847ff
CZ75-Auto|Silver|12.50|#5e98d9
CZ75-Auto|Slalom|15.00|#8847ff
CZ75-Auto|Syndicate|12.00|#8847ff
CZ75-Auto|Tacticat|3.50|#8847ff
CZ75-Auto|The Fuschia Is Now|65.00|#d32ee6
CZ75-Auto|Tigris|2.50|#8847ff
CZ75-Auto|Tread Plate|15.00|#8847ff
CZ75-Auto|Tuxedo|12.00|#4b69ff
CZ75-Auto|Twist|2.50|#4b69ff
CZ75-Auto|Vendetta|1.10|#4b69ff
CZ75-Auto|Victoria|55.00|#eb4b4b
CZ75-Auto|Xiangliu|15.00|#d32ee6
CZ75-Auto|Yellow Jacket|22.00|#d32ee6
Desert Eagle|Blaze|1200.00|#8847ff
Desert Eagle|Blue Ply|1.50|#4b69ff
Desert Eagle|Bronze Deco|1.10|#4b69ff
Desert Eagle|Calligraffiti|4.50|#4b69ff
Desert Eagle|Code Red|85.00|#eb4b4b
Desert Eagle|Cobalt Disruption|110.00|#d32ee6
Desert Eagle|Conspiracy|15.00|#d32ee6
Desert Eagle|Corinthian|0.90|#4b69ff
Desert Eagle|Crimson Web|125.00|#8847ff
Desert Eagle|Directive|5.50|#8847ff
Desert Eagle|Emerald J√∂rmungandr|450.00|#8847ff
Desert Eagle|Fennec Fox|750.00|#d32ee6
Desert Eagle|Golden Koi|140.00|#eb4b4b
Desert Eagle|Hand Cannon|750.00|#8847ff
Desert Eagle|Heat Treated|350.00|#d32ee6
Desert Eagle|Heirloom|45.00|#8847ff
Desert Eagle|Hypnotic|160.00|#d32ee6
Desert Eagle|Ice Cap|1.50|#4b69ff
Desert Eagle|Kumicho Dragon|45.00|#d32ee6
Desert Eagle|Light Rail|12.00|#8847ff
Desert Eagle|Mecha Industries|15.00|#d32ee6
Desert Eagle|Meteorite|12.00|#4b69ff
Desert Eagle|Midnight Storm|25.00|#5e98d9
Desert Eagle|Mint Fan|12.50|#4b69ff
Desert Eagle|Mudder|3.50|#5e98d9
Desert Eagle|Mulberry|18.50|#8847ff
Desert Eagle|Naga|5.50|#8847ff
Desert Eagle|Night|15.00|#5e98d9
Desert Eagle|Night Heist|12.00|#4b69ff
Desert Eagle|Ocean Drive|140.00|#eb4b4b
Desert Eagle|Oxide Blaze|1.10|#4b69ff
Desert Eagle|Pilot|180.00|#8847ff
Desert Eagle|Printstream|140.00|#eb4b4b
Desert Eagle|Serpent Strike|45.00|#8847ff
Desert Eagle|Sputnik|12.00|#4b69ff
Desert Eagle|Starcade|85.00|#d32ee6
Desert Eagle|Sunset Storm Â£±|550.00|#8847ff
Desert Eagle|Sunset Storm Âºê|580.00|#8847ff
Desert Eagle|The Bronze|12.00|#5e98d9
Desert Eagle|The Daily Deagle|14.50|#4b69ff
Desert Eagle|Tilted|2.50|#5e98d9
Desert Eagle|Trigger Discipline|5.50|#8847ff
Desert Eagle|Urban DDPAT|3.50|#5e98d9
Desert Eagle|Urban Rubble|12.50|#4b69ff
Dual Berettas|Angel Eyes|12.00|#8847ff
Dual Berettas|Anodized Navy|15.00|#4b69ff
Dual Berettas|Balance|1.10|#4b69ff
Dual Berettas|Black Limba|12.00|#4b69ff
Dual Berettas|BorDeux|1.50|#b0c3d9
Dual Berettas|Briar|1.50|#b0c3d9
Dual Berettas|Cartel|5.50|#4b69ff
Dual Berettas|Cobalt Quartz|15.00|#8847ff
Dual Berettas|Cobra Strike|85.00|#d32ee6
Dual Berettas|Colony|0.80|#b0c3d9
Dual Berettas|Contractor|0.80|#b0c3d9
Dual Berettas|Demolition|35.00|#8847ff
Dual Berettas|Dezastre|2.50|#8847ff
Dual Berettas|Drift Wood|1.50|#5e98d9
Dual Berettas|Dualing Dragons|2.50|#4b69ff
Dual Berettas|Duelist|140.00|#8847ff
Dual Berettas|Elite 1.6|2.50|#4b69ff
Dual Berettas|Emerald|12.00|#4b69ff
Dual Berettas|Flora Carnivora|5.50|#8847ff
Dual Berettas|Heist|0.80|#b0c3d9
Dual Berettas|Hemoglobin|35.00|#8847ff
Dual Berettas|Hideout|2.50|#4b69ff
Dual Berettas|Hydro Strike|28.00|#8847ff
Dual Berettas|Marina|15.00|#8847ff
Dual Berettas|Melondrama|22.00|#d32ee6
Dual Berettas|Moon in Libra|2.50|#b0c3d9
Dual Berettas|Oil Change|1.10|#b0c3d9
Dual Berettas|Panther|12.00|#4b69ff
Dual Berettas|Polished Malachite|3.50|#5e98d9
Dual Berettas|Pyre|15.00|#5e98d9
Dual Berettas|Retribution|12.00|#4b69ff
Dual Berettas|Rose Nacre|2.50|#5e98d9
Dual Berettas|Royal Consorts|5.50|#8847ff
Dual Berettas|Shred|1.10|#4b69ff
Dual Berettas|Silver Pour|1.50|#b0c3d9
Dual Berettas|Stained|1.50|#5e98d9
Dual Berettas|Sweet Little Angels|22.00|#8847ff
Dual Berettas|Switch Board|3.50|#5e98d9
Dual Berettas|Tread|1.10|#4b69ff
Dual Berettas|Twin Turbo|140.00|#d32ee6
Dual Berettas|Urban Shock|2.50|#8847ff
Dual Berettas|Ventilators|0.90|#4b69ff
FAMAS|2A2F|8.50|#4b69ff
FAMAS|Afterimage|45.00|#d32ee6
FAMAS|Bad Trip|42.00|#eb4b4b
FAMAS|Byproduct|0.90|#b0c3d9
FAMAS|CaliCamo|4.50|#5e98d9
FAMAS|Colony|0.80|#b0c3d9
FAMAS|Commemoration|120.00|#eb4b4b
FAMAS|Contrast Spray|2.50|#b0c3d9
FAMAS|Crypsis|1.10|#4b69ff
FAMAS|Cyanospatter|4.50|#5e98d9
FAMAS|Dark Water|15.00|#4b69ff
FAMAS|Decommissioned|1.20|#4b69ff
FAMAS|Djinn|12.00|#d32ee6
FAMAS|Doomkitty|4.50|#4b69ff
FAMAS|Eye of Athena|15.00|#d32ee6
FAMAS|Faulty Wiring|1.10|#b0c3d9
FAMAS|Grey Ghost|2.50|#5e98d9
FAMAS|Half Sleeve|1.80|#5e98d9
FAMAS|Halftone Wash|1.80|#5e98d9
FAMAS|Hexane|2.50|#4b69ff
FAMAS|Macabre|1.20|#4b69ff
FAMAS|Mecha Industries|12.00|#d32ee6
FAMAS|Meow 36|1.10|#4b69ff
FAMAS|Neural Net|2.50|#8847ff
FAMAS|Night Borre|1.50|#b0c3d9
FAMAS|Palm|1.20|#b0c3d9
FAMAS|Prime Conspiracy|18.00|#8847ff
FAMAS|Pulse|15.00|#8847ff
FAMAS|Rapid Eye Movement|18.00|#d32ee6
FAMAS|Sergeant|5.50|#8847ff
FAMAS|Spitfire|320.00|#8847ff
FAMAS|Styx|15.00|#8847ff
FAMAS|Sundown|125.00|#4b69ff
FAMAS|Survivor Z|1.10|#4b69ff
FAMAS|Teardown|4.50|#4b69ff
FAMAS|Valence|5.50|#8847ff
FAMAS|Vendetta|4.50|#5e98d9
FAMAS|Waters of Nephthys|120.00|#d32ee6
FAMAS|Yeti Camo|4.50|#4b69ff
FAMAS|ZX Spectron|5.50|#8847ff
Five-SeveN|Angry Mob|18.00|#eb4b4b
Five-SeveN|Anodized Gunmetal|12.00|#b0c3d9
Five-SeveN|Autumn Thicket|0.90|#b0c3d9
Five-SeveN|Berries And Cherries|65.00|#8847ff
Five-SeveN|Boost Protocol|3.50|#8847ff
Five-SeveN|Buddy|4.50|#8847ff
Five-SeveN|Candy Apple|125.00|#5e98d9
Five-SeveN|Capillary|0.90|#4b69ff
Five-SeveN|Case Hardened|55.00|#8847ff
Five-SeveN|Contractor|0.80|#b0c3d9
Five-SeveN|Coolant|0.80|#b0c3d9
Five-SeveN|Copper Galaxy|12.00|#8847ff
Five-SeveN|Crimson Blossom|140.00|#4b69ff
Five-SeveN|Fairy Tale|25.00|#d32ee6
Five-SeveN|Fall Hazard|350.00|#d32ee6
Five-SeveN|Flame Test|1.10|#4b69ff
Five-SeveN|Forest Night|0.80|#b0c3d9
Five-SeveN|Fowl Play|12.00|#d32ee6
Five-SeveN|Fraise Crane|5.50|#4b69ff
Five-SeveN|Heat Treated|85.00|#8847ff
Five-SeveN|Hot Shot|4.50|#5e98d9
Five-SeveN|Hybrid|12.00|#8847ff
Five-SeveN|Hyper Beast|110.00|#eb4b4b
Five-SeveN|Jungle|1.20|#b0c3d9
Five-SeveN|Kami|5.50|#4b69ff
Five-SeveN|Midnight Paintover|4.50|#5e98d9
Five-SeveN|Monkey Business|12.00|#d32ee6
Five-SeveN|Neon Kimono|380.00|#8847ff
Five-SeveN|Nightshade|2.50|#4b69ff
Five-SeveN|Nitro|12.00|#4b69ff
Five-SeveN|Orange Peel|15.00|#5e98d9
Five-SeveN|Retrobution|8.50|#8847ff
Five-SeveN|Scrawl|1.10|#4b69ff
Five-SeveN|Scumbria|0.90|#4b69ff
Five-SeveN|Silver Quartz|5.50|#4b69ff
Five-SeveN|Sky Blue|3.80|#5e98d9
Five-SeveN|Triumvirate|5.50|#8847ff
Five-SeveN|Urban Hazard|1.20|#4b69ff
Five-SeveN|Violent Daimyo|1.10|#4b69ff
Five-SeveN|Withered Vine|1.50|#5e98d9
G3SG1|Ancient Ritual|12.00|#5e98d9
G3SG1|Arctic Camo|15.00|#5e98d9
G3SG1|Azure Zebra|2.50|#4b69ff
G3SG1|Black Sand|0.90|#4b69ff
G3SG1|Chronos|350.00|#8847ff
G3SG1|Contractor|0.80|#b0c3d9
G3SG1|Demeter|4.50|#4b69ff
G3SG1|Desert Storm|0.80|#b0c3d9
G3SG1|Dream Glade|3.50|#8847ff
G3SG1|Digital Mesh|1.10|#4b69ff
G3SG1|Flux|12.00|#d32ee6
G3SG1|Green Apple|4.50|#5e98d9
G3SG1|Green Cell|1.20|#b0c3d9
G3SG1|High Seas|2.50|#8847ff
G3SG1|Hunter|1.10|#4b69ff
G3SG1|Keeping Tabs|1.10|#4b69ff
G3SG1|Jungle Dashed|0.80|#b0c3d9
G3SG1|Murky|1.20|#4b69ff
G3SG1|New Roots|1.50|#4b69ff
G3SG1|Orange Crash|1.10|#4b69ff
G3SG1|Orange Kimono|2.50|#b0c3d9
G3SG1|Polar Camo|0.80|#b0c3d9
G3SG1|Red Jasper|1.50|#b0c3d9
G3SG1|Safari Mesh|0.80|#b0c3d9
G3SG1|Scavenger|2.50|#8847ff
G3SG1|Stinger|2.50|#8847ff
G3SG1|The Executioner|45.00|#d32ee6
G3SG1|VariCamo|1.50|#5e98d9
G3SG1|Ventilator|0.90|#4b69ff
G3SG1|Violet Murano|12.00|#4b69ff
Galil AR|Acid Dart|1.80|#5e98d9
Galil AR|Akoben|0.90|#4b69ff
Galil AR|Amber Fade|12.00|#4b69ff
Galil AR|Aqua Terrace|140.00|#4b69ff
Galil AR|Black Sand|0.90|#4b69ff
Galil AR|Blue Titanium|12.00|#4b69ff
Galil AR|CAUTION!|45.00|#8847ff
Galil AR|Cerberus|45.00|#8847ff
Galil AR|Chatterbox|65.00|#eb4b4b
Galil AR|Chromatic Aberration|12.00|#d32ee6
Galil AR|Cold Fusion|1.50|#5e98d9
Galil AR|Connexion|3.50|#8847ff
Galil AR|Control|18.50|#8847ff
Galil AR|Crimson Tsunami|2.50|#8847ff
Galil AR|Destroyer|1.10|#4b69ff
Galil AR|Dusk Ruins|12.00|#4b69ff
Galil AR|Eco|15.00|#d32ee6
Galil AR|Firefight|2.50|#8847ff
Galil AR|Green Apple|4.50|#5e98d9
Galil AR|Grey Smoke|1.10|#b0c3d9
Galil AR|Hunting Blind|0.80|#b0c3d9
Galil AR|Kami|2.50|#4b69ff
Galil AR|Metallic Squeezer|4.50|#4b69ff
Galil AR|NV|1.80|#5e98d9
Galil AR|O-Ranger|3.50|#5e98d9
Galil AR|Orange DDPAT|45.00|#8847ff
Galil AR|Phoenix Blacklight|45.00|#8847ff
Galil AR|Rainbow Spoon|35.00|#d32ee6
Galil AR|Robin's Egg|4.50|#5e98d9
Galil AR|Rocket Pop|5.50|#4b69ff
Galil AR|Sage Spray|0.80|#b0c3d9
Galil AR|Shattered|12.00|#4b69ff
Galil AR|Signal|2.50|#8847ff
Galil AR|Sky Mandala|8.50|#4b69ff
Galil AR|Stone Cold|5.50|#8847ff
Galil AR|Sugar Rush|45.00|#d32ee6
Galil AR|Tornado|0.80|#b0c3d9
Galil AR|Tuxedo|1.50|#4b69ff
Galil AR|Urban Rubble|1.50|#5e98d9
Galil AR|Vandal|2.50|#4b69ff
Galil AR|VariCamo|1.50|#5e98d9
Galil AR|Winter Forest|15.00|#5e98d9
Glock-18|AXIA|35.00|#d32ee6
Glock-18|Block-18|12.50|#8847ff
Glock-18|Blue Fissure|15.00|#4b69ff
Glock-18|Brass|55.00|#8847ff
Glock-18|Bullet Queen|65.00|#eb4b4b
Glock-18|Bunsen Burner|1.50|#4b69ff
Glock-18|Candy Apple|1.50|#4b69ff
Glock-18|Catacombs|1.10|#4b69ff
Glock-18|Clear Polymer|1.10|#4b69ff
Glock-18|Coral Bloom|4.50|#4b69ff
Glock-18|Death Rattle|1.50|#5e98d9
Glock-18|Dragon Tattoo|95.00|#8847ff
Glock-18|Fade|1800.00|#8847ff
Glock-18|Franklin|45.00|#8847ff
Glock-18|Gamma Doppler|65.00|#eb4b4b
Glock-18|Glockingbird|15.00|#8847ff
Glock-18|Gold Toof|85.00|#eb4b4b
Glock-18|Green Line|4.50|#4b69ff
Glock-18|Grinder|12.00|#8847ff
Glock-18|Groundwater|15.00|#5e98d9
Glock-18|High Beam|2.50|#5e98d9
Glock-18|Ironwork|1.10|#4b69ff
Glock-18|Mirror Mosaic|35.00|#d32ee6
Glock-18|Moonrise|2.50|#8847ff
Glock-18|Neo-Noir|45.00|#eb4b4b
Glock-18|Night|12.00|#5e98d9
Glock-18|Nuclear Garden|35.00|#8847ff
Glock-18|Ocean Topo|3.50|#5e98d9
Glock-18|Off World|0.90|#4b69ff
Glock-18|Oxide Blaze|0.90|#4b69ff
Glock-18|Pink DDPAT|140.00|#8847ff
Glock-18|Ramese's Reach|15.00|#8847ff
Glock-18|Reactor|12.00|#4b69ff
Glock-18|Red Tire|3.50|#5e98d9
Glock-18|Royal Legion|5.50|#8847ff
Glock-18|Sacrifice|1.20|#4b69ff
Glock-18|Sand Dune|12.00|#5e98d9
Glock-18|Shinobu|28.00|#d32ee6
Glock-18|Snack Attack|15.00|#d32ee6
Glock-18|Steel Disruption|8.50|#8847ff
Glock-18|Synth Leaf|180.00|#8847ff
Glock-18|Teal Graf|4.50|#4b69ff
Glock-18|Trace Lock|12.00|#8847ff
Glock-18|Twilight Galaxy|180.00|#d32ee6
Glock-18|Umbral Rabbit|5.50|#8847ff
Glock-18|Vogue|12.00|#d32ee6
Glock-18|Warhawk|1.10|#4b69ff
Glock-18|Wasteland Rebel|45.00|#eb4b4b
Glock-18|Water Elemental|12.00|#d32ee6
Glock-18|Weasel|2.50|#8847ff
Glock-18|Winterized|0.90|#4b69ff
Glock-18|Wraiths|1.10|#4b69ff
M249|Aztec|12.00|#8847ff
M249|Blizzard Marbleized|12.00|#5e98d9
M249|Deep Relief|1.10|#4b69ff
M249|Downtown|2.50|#8847ff
M249|Emerald Poison Dart|4.50|#8847ff
M249|Gator Mesh|1.50|#5e98d9
M249|Humidor|4.50|#4b69ff
M249|Hypnosis|5.50|#4b69ff
M249|Impact Drill|0.80|#b0c3d9
M249|Jungle|1.20|#b0c3d9
M249|Jungle DDPAT|0.80|#b0c3d9
M249|Magma|2.50|#4b69ff
M249|Midnight Palm|3.50|#5e98d9
M249|O.S.I.P.R.|1.10|#4b69ff
M249|Predator|1.10|#b0c3d9
M249|Sage Camo|0.80|#b0c3d9
M249|Shipping Forecast|12.00|#5e98d9
M249|Sleet|0.90|#b0c3d9
M249|Spectrogram|1.80|#5e98d9
M249|Spectre|0.90|#4b69ff
M249|Submerged|0.80|#b0c3d9
M249|System Lock|1.10|#4b69ff
M249|Warbird|1.10|#4b69ff
M4A1-S|Atomic Alloy|65.00|#d32ee6
M4A1-S|Basilisk|15.00|#8847ff
M4A1-S|Black Lotus|18.00|#d32ee6
M4A1-S|Blood Tiger|12.00|#4b69ff
M4A1-S|Blue Phosphor|750.00|#d32ee6
M4A1-S|Boreal Forest|1.50|#5e98d9
M4A1-S|Briefing|1.20|#4b69ff
M4A1-S|Bright Water|140.00|#8847ff
M4A1-S|Chantico's Fire|125.00|#eb4b4b
M4A1-S|Control Panel|95.00|#d32ee6
M4A1-S|Cyrex|65.00|#eb4b4b
M4A1-S|Dark Water|110.00|#8847ff
M4A1-S|Decimator|25.00|#d32ee6
M4A1-S|Emphorosaur-S|5.50|#8847ff
M4A1-S|Fade|1200.00|#eb4b4b
M4A1-S|Fizzy POP|12.00|#4b69ff
M4A1-S|Flashback|2.50|#8847ff
M4A1-S|Glitched Paint|32.00|#8847ff
M4A1-S|Golden Coil|150.00|#eb4b4b
M4A1-S|Guardian|65.00|#d32ee6
M4A1-S|Hot Rod|950.00|#d32ee6
M4A1-S|Hyper Beast|130.00|#eb4b4b
M4A1-S|Icarus Fell|650.00|#8847ff
M4A1-S|Imminent Danger|2500.00|#eb4b4b
M4A1-S|Knight|3800.00|#d32ee6
M4A1-S|Leaded Glass|15.00|#d32ee6
M4A1-S|Liquidation|12.00|#8847ff
M4A1-S|Master Piece|1200.00|#d32ee6
M4A1-S|Mecha Industries|65.00|#eb4b4b
M4A1-S|Moss Quartz|12.00|#5e98d9
M4A1-S|Mud-Spec|3.50|#5e98d9
M4A1-S|Night Terror|5.50|#8847ff
M4A1-S|Nightmare|45.00|#d32ee6
M4A1-S|Nitro|12.00|#8847ff
M4A1-S|Player Two|110.00|#eb4b4b
M4A1-S|Printstream|380.00|#eb4b4b
M4A1-S|Rose Hex|8.50|#4b69ff
M4A1-S|Solitude|240.00|#d32ee6
M4A1-S|Stratosphere|45.00|#d32ee6
M4A1-S|Vaporwave|145.00|#eb4b4b
M4A1-S|VariCamo|1.50|#4b69ff
M4A1-S|Wash me plz|18.00|#5e98d9
M4A1-S|Welcome to the Jungle|4500.00|#eb4b4b
M4A4|Aeolian Dark|12.00|#5e98d9
M4A4|Asiimov|250.00|#eb4b4b
M4A4|Bullet Rain|110.00|#eb4b4b
M4A4|Buzz Kill|25.00|#eb4b4b
M4A4|Choppa|4.50|#4b69ff
M4A4|Converter|3.50|#4b69ff
M4A4|Cyber Security|15.00|#d32ee6
M4A4|Dark Blossom|12.00|#5e98d9
M4A4|Desert Storm|15.00|#5e98d9
M4A4|Desert-Strike|12.00|#eb4b4b
M4A4|Desolate Space|22.00|#d32ee6
M4A4|ÈæçÁéã (Dragon King)|45.00|#d32ee6
M4A4|Etch Lord|12.50|#8847ff
M4A4|Evil Daimyo|8.50|#8847ff
M4A4|Eye of Horus|1800.00|#eb4b4b
M4A4|Faded Zebra|12.00|#4b69ff
M4A4|Full Throttle|180.00|#eb4b4b
M4A4|Global Offensive|12.00|#4b69ff
M4A4|Griffin|12.00|#8847ff
M4A4|Hellfire|110.00|#d32ee6
M4A4|Hellish|42.00|#d32ee6
M4A4|Howl|15000.00|#e4ae39
M4A4|In Living Color|45.00|#eb4b4b
M4A4|Jungle Tiger|65.00|#5e98d9
M4A4|Magnesium|1.10|#4b69ff
M4A4|Mainframe|1.50|#5e98d9
M4A4|Modern Hunter|1200.00|#8847ff
M4A4|Naval Shred Camo|4.50|#5e98d9
M4A4|Neo-Noir|45.00|#eb4b4b
M4A4|Poly Mag|1.10|#4b69ff
M4A4|Polysoup|12.00|#8847ff
M4A4|Poseidon|1800.00|#d32ee6
M4A4|Radiation Hazard|1200.00|#4b69ff
M4A4|Red DDPAT|14.00|#8847ff
M4A4|Royal Paladin|110.00|#eb4b4b
M4A4|Sheet Lightning|15.00|#8847ff
M4A4|Spider Lily|12.00|#8847ff
M4A4|Steel Work|3.80|#5e98d9
M4A4|Temukau|140.00|#eb4b4b
M4A4|The Battlestar|15.00|#eb4b4b
M4A4|The Coalition|750.00|#eb4b4b
M4A4|The Emperor|140.00|#eb4b4b
M4A4|Tooth Fairy|12.00|#d32ee6
M4A4|Tornado|45.00|#5e98d9
M4A4|Turbine|22.00|#8847ff
M4A4|Urban DDPAT|1.50|#5e98d9
M4A4|X-Ray|45.00|#eb4b4b
M4A4|Zirka|45.00|#8847ff
MAC-10|Allure|2.50|#8847ff
MAC-10|Aloha|1.10|#4b69ff
MAC-10|Amber Fade|15.00|#4b69ff
MAC-10|Bronzer|1.10|#b0c3d9
MAC-10|Button Masher|2.50|#8847ff
MAC-10|Calf Skin|3.50|#5e98d9
MAC-10|Candy Apple|1.50|#5e98d9
MAC-10|Cat Fight|14.00|#8847ff
MAC-10|Classic Crate|1.20|#4b69ff
MAC-10|Commuter|15.00|#5e98d9
MAC-10|Copper Borre|12.00|#4b69ff
MAC-10|Curse|12.00|#8847ff
MAC-10|Derailment|18.00|#8847ff
MAC-10|Disco Tech|15.00|#d32ee6
MAC-10|Echoing Sands|3.50|#5e98d9
MAC-10|Ensnared|1.10|#4b69ff
MAC-10|Fade|35.00|#4b69ff
MAC-10|Gold Brick|95.00|#8847ff
MAC-10|Graven|45.00|#8847ff
MAC-10|Heat|12.00|#8847ff
MAC-10|Hot Snakes|1200.00|#d32ee6
MAC-10|Indigo|1.50|#b0c3d9
MAC-10|Lapis Gator|0.90|#4b69ff
MAC-10|Last Dive|2.50|#8847ff
MAC-10|Light Box|4.50|#4b69ff
MAC-10|Malachite|2.50|#8847ff
MAC-10|Monkeyflage|0.90|#4b69ff
MAC-10|Neon Rider|22.00|#eb4b4b
MAC-10|Nuclear Garden|12.00|#4b69ff
MAC-10|Oceanic|1.10|#4b69ff
MAC-10|Palm|3.50|#5e98d9
MAC-10|Pipe Down|2.50|#8847ff
MAC-10|Pipsqueak|4.50|#4b69ff
MAC-10|Poplar Thicket|5.50|#4b69ff
MAC-10|Propaganda|25.00|#d32ee6
MAC-10|Rangeen|1.10|#4b69ff
MAC-10|Red Filigree|140.00|#8847ff
MAC-10|SaibƒÅ Oni|15.00|#8847ff
MAC-10|Sakkaku|5.50|#8847ff
MAC-10|Sienna Damask|1.10|#b0c3d9
MAC-10|Silver|15.00|#5e98d9
MAC-10|Snow Splash|12.00|#5e98d9
MAC-10|Stalker|110.00|#eb4b4b
MAC-10|Storm Camo|1.50|#b0c3d9
MAC-10|Strats|1.10|#b0c3d9
MAC-10|Surfwood|1.50|#b0c3d9
MAC-10|Tatter|12.00|#8847ff
MAC-10|Tornado|1.50|#b0c3d9
MAC-10|Toybox|15.00|#d32ee6
MAC-10|Ultraviolet|12.00|#4b69ff
MAC-10|Urban DDPAT|1.10|#b0c3d9
MAC-10|Whitefish|0.90|#4b69ff
MAG-7|BI83 Spectrum|2.50|#8847ff
MAG-7|Bulldozer|95.00|#8847ff
MAG-7|Carbon Fiber|3.50|#5e98d9
MAG-7|Chainmail|12.00|#5e98d9
MAG-7|Cobalt Core|1.10|#4b69ff
MAG-7|Copper Coated|5.50|#4b69ff
MAG-7|Copper Oxide|1.80|#b0c3d9
MAG-7|Core Breach|12.00|#8847ff
MAG-7|Firestarter|4.50|#4b69ff
MAG-7|Foresight|1.10|#4b69ff
MAG-7|Hard Water|1.10|#4b69ff
MAG-7|Hazard|45.00|#4b69ff
MAG-7|Heat|2.50|#8847ff
MAG-7|Heaven Guard|1.10|#4b69ff
MAG-7|Insomnia|4.50|#4b69ff
MAG-7|Irradiated Alert|1.50|#b0c3d9
MAG-7|Justice|12.00|#d32ee6
MAG-7|MAGnitude|1.10|#4b69ff
MAG-7|Memento|4.50|#4b69ff
MAG-7|Metallic DDPAT|1.50|#5e98d9
MAG-7|Monster Call|2.50|#8847ff
MAG-7|Navy Sheen|0.90|#b0c3d9
MAG-7|Popdog|1.10|#4b69ff
MAG-7|Praetorian|5.50|#8847ff
MAG-7|Prism Terrace|12.00|#8847ff
MAG-7|Resupply|4.50|#4b69ff
MAG-7|Rust Coat|0.80|#b0c3d9
MAG-7|Sand Dune|0.80|#b0c3d9
MAG-7|Seabird|0.90|#b0c3d9
MAG-7|Silver|15.00|#5e98d9
MAG-7|Sonar|1.10|#4b69ff
MAG-7|Storm|0.80|#b0c3d9
MAG-7|SWAG-7|2.50|#8847ff
MAG-7|Wildwood|1.80|#5e98d9
MP5-SD|Acid Wash|1.10|#4b69ff
MP5-SD|Agent|2.50|#8847ff
MP5-SD|Autumn Twilly|12.00|#8847ff
MP5-SD|Bamboo Garden|1.50|#b0c3d9
MP5-SD|Co-Processor|1.50|#4b69ff
MP5-SD|Condition Zero|1.10|#4b69ff
MP5-SD|Desert Strike|1.10|#4b69ff
MP5-SD|Dirt Drop|0.80|#b0c3d9
MP5-SD|Focus|8.50|#4b69ff
MP5-SD|Gauss|2.50|#8847ff
MP5-SD|Gold Leaf|450.00|#4b69ff
MP5-SD|Kitbash|2.50|#8847ff
MP5-SD|Lab Rats|12.00|#8847ff
MP5-SD|Lime Hex|1.10|#b0c3d9
MP5-SD|Liquidation|4.50|#4b69ff
MP5-SD|Necro Jr.|1.10|#4b69ff
MP5-SD|Neon Squeezer|12.00|#5e98d9
MP5-SD|Nitro|45.00|#5e98d9
MP5-SD|Oxide Oasis|120.00|#d32ee6
MP5-SD|Phosphor|18.00|#d32ee6
MP5-SD|Picnic|15.00|#5e98d9
MP5-SD|Savannah Halftone|1.80|#5e98d9
MP5-SD|Snow Splash|15.00|#5e98d9
MP5-SD|Statics|4.50|#4b69ff
MP7|Abyssal Apparition|15.00|#d32ee6
MP7|Akoben|1.10|#4b69ff
MP7|Anodized Navy|15.00|#4b69ff
MP7|Armor Core|0.90|#4b69ff
MP7|Army Recon|1.10|#b0c3d9
MP7|Asterion|35.00|#b0c3d9
MP7|Astrolabe|12.00|#5e98d9
MP7|Bloodsport|12.00|#eb4b4b
MP7|Cirrus|0.90|#4b69ff
MP7|Coral Paisley|12.00|#5e98d9
MP7|Fade|12.00|#8847ff
MP7|Forest DDPAT|0.80|#b0c3d9
MP7|Groundwater|1.50|#b0c3d9
MP7|Guerrilla|1.10|#4b69ff
MP7|Gunsmoke|15.00|#5e98d9
MP7|Impire|2.50|#8847ff
MP7|Just Smile|15.00|#8847ff
MP7|Mischief|0.90|#4b69ff
MP7|Motherboard|1.50|#5e98d9
MP7|Nemesis|15.00|#d32ee6
MP7|Ocean Foam|120.00|#8847ff
MP7|Olive Plaid|1.50|#b0c3d9
MP7|Orange Peel|3.50|#5e98d9
MP7|Powercore|2.50|#8847ff
MP7|Prey|1.50|#b0c3d9
MP7|Scorched|0.80|#b0c3d9
MP7|Skulls|12.00|#4b69ff
MP7|Smoking Kills|22.00|#d32ee6
MP7|Special Delivery|2.50|#8847ff
MP7|Sunbaked|1.10|#b0c3d9
MP7|Tall Grass|15.00|#5e98d9
MP7|Teal Blossom|140.00|#4b69ff
MP7|Urban Hazard|1.10|#4b69ff
MP7|Vault Heist|12.00|#5e98d9
MP7|Whiteout|380.00|#4b69ff
MP9|Airlock|15.00|#d32ee6
MP9|Arctic Tri-Tone|5.50|#8847ff
MP9|Bee-Tron|1.50|#b0c3d9
MP9|Bioleak|0.90|#4b69ff
MP9|Black Sand|0.90|#4b69ff
MP9|Broken Record|12.50|#4b69ff
MP9|Buff Blue|1.50|#b0c3d9
MP9|Bulldozer|350.00|#8847ff
MP9|Capillary|0.90|#4b69ff
MP9|Cobalt Paisley|12.50|#4b69ff
MP9|Dark Age|35.00|#4b69ff
MP9|Dart|1.10|#4b69ff
MP9|Deadly Poison|0.90|#4b69ff
MP9|Dizzy|1.50|#b0c3d9
MP9|Dry Season|4.50|#b0c3d9
MP9|Featherweight|1.10|#4b69ff
MP9|Food Chain|15.00|#d32ee6
MP9|Goo|2.50|#8847ff
MP9|Green Plaid|1.50|#b0c3d9
MP9|Hot Rod|55.00|#4b69ff
MP9|Hydra|12.00|#d32ee6
MP9|Hypnotic|35.00|#8847ff
MP9|Latte Rush|32.00|#d32ee6
MP9|Modest Threat|0.90|#4b69ff
MP9|Mount Fuji|5.50|#8847ff
MP9|Music Box|12.00|#4b69ff
MP9|Multi-Terrain|1.50|#b0c3d9
MP9|Nexus|4.50|#4b69ff
MP9|Old Roots|1.50|#5e98d9
MP9|Orange Peel|3.50|#5e98d9
MP9|Pandora's Box|380.00|#4b69ff
MP9|Pine|1.10|#b0c3d9
MP9|Rose Iron|12.00|#8847ff
MP9|Ruby Poison Dart|2.50|#8847ff
MP9|Sakkaku|5.50|#8847ff
MP9|Sand Dashed|0.80|#b0c3d9
MP9|Sand Scale|0.90|#4b69ff
MP9|Setting Sun|4.50|#4b69ff
MP9|Shredded|4.50|#4b69ff
MP9|Slide|0.80|#b0c3d9
MP9|Starlight Protector|65.00|#eb4b4b
MP9|Stained Glass|140.00|#8847ff
MP9|Storm|0.80|#b0c3d9
MP9|Wild Lily|1800.00|#d32ee6
Negev|Anodized Navy|140.00|#4b69ff
Negev|Army Sheen|0.80|#b0c3d9
Negev|Boroque Sand|2.50|#b0c3d9
Negev|Bratatat|4.50|#4b69ff
Negev|Bulkhead|1.50|#5e98d9
Negev|CaliCamo|1.50|#5e98d9
Negev|Dazzle|0.90|#4b69ff
Negev|Desert-Strike|1.10|#4b69ff
Negev|dev_texture|12.00|#8847ff
Negev|Drop Me|1.10|#4b69ff
Negev|Infrastructure|12.00|#4b69ff
Negev|Lionfish|2.50|#8847ff
Negev|Loudmouth|12.00|#8847ff
Negev|Man-o'-war|12.00|#4b69ff
Negev|Mj√∂lnir|1800.00|#d32ee6
Negev|Midnight Palm|3.50|#5e98d9
Negev|Nuclear Waste|4.50|#5e98d9
Negev|Palm|15.00|#5e98d9
Negev|Phoenix Stencil|4.50|#4b69ff
Negev|Power Loader|5.50|#8847ff
Negev|Prototype|1.10|#4b69ff
Negev|Raw Ceramic|1.20|#b0c3d9
Negev|Sour Grapes|4.50|#5e98d9
Negev|Terrain|1.10|#4b69ff
Negev|Ultralight|0.90|#4b69ff
Negev|Wall Bang|12.00|#5e98d9
Nova|Antique|12.00|#d32ee6
Nova|Army Sheen|0.80|#b0c3d9
Nova|Baroque Orange|35.00|#8847ff
Nova|Blaze Orange|120.00|#4b69ff
Nova|Bloomstick|45.00|#d32ee6
Nova|Caged Steel|1.50|#5e98d9
Nova|Candy Apple|12.00|#5e98d9
Nova|Clear Polymer|2.50|#8847ff
Nova|Copperflage|4.50|#4b69ff
Nova|Dark Sigil|1.20|#4b69ff
Nova|Exo|1.10|#4b69ff
Nova|Forest Leaves|1.20|#b0c3d9
Nova|Ghost Camo|2.50|#4b69ff
Nova|Gila|2.50|#8847ff
Nova|Graphite|15.00|#8847ff
Nova|Green Apple|15.00|#5e98d9
Nova|Hieroglyph|0.80|#b0c3d9
Nova|Hyper Beast|45.00|#d32ee6
Nova|Interlock|12.00|#4b69ff
Nova|Koi|5.50|#8847ff
Nova|Mandrel|0.80|#b0c3d9
Nova|Marsh Grass|1.10|#b0c3d9
Nova|Modern Hunter|140.00|#4b69ff
Nova|Moon in Libra|1.50|#b0c3d9
Nova|Ocular|12.00|#8847ff
Nova|Oxide Blaze|1.10|#4b69ff
Nova|Plume|1.10|#4b69ff
Nova|Polar Mesh|0.80|#b0c3d9
Nova|Predator|0.80|#b0c3d9
Nova|Quick Sand|1.50|#4b69ff
Nova|Rain Station|12.00|#5e98d9
Nova|Ranger|1.10|#4b69ff
Nova|Rising Skull|15.00|#8847ff
Nova|Rising Sun|18.50|#8847ff
Nova|Rust Coat|1.10|#5e98d9
Nova|Sand Dune|0.80|#b0c3d9
Nova|Sobek's Bite|12.00|#8847ff
Nova|Tempest|12.00|#4b69ff
Nova|Toy Soldier|5.50|#8847ff
Nova|Turquoise Pour|12.00|#5e98d9
Nova|Walnut|2.50|#b0c3d9
Nova|Wild Six|2.50|#8847ff
Nova|Windblown|1.10|#4b69ff
Nova|Wood Fired|1.10|#4b69ff
Nova|Wurst H√∂lle|12.50|#4b69ff
Nova|Yorkshire|12.00|#4b69ff
P2000|Acid Etched|5.50|#8847ff
P2000|Amber Fade|65.00|#8847ff
P2000|Chainmail|35.00|#4b69ff
P2000|Coach Class|12.00|#5e98d9
P2000|Corticera|12.00|#d32ee6
P2000|Dispatch|12.00|#4b69ff
P2000|Fire Elemental|45.00|#eb4b4b
P2000|Gnarled|0.90|#4b69ff
P2000|Granite Marbleized|1.50|#5e98d9
P2000|Grassland|15.00|#5e98d9
P2000|Grassland Leaves|1.50|#5e98d9
P2000|Handgun|5.50|#8847ff
P2000|Imperial|1.10|#4b69ff
P2000|Imperial Dragon|15.00|#d32ee6
P2000|Ivory|1.10|#4b69ff
P2000|Lifted Spirits|1.10|#4b69ff
P2000|Marsh|1.80|#5e98d9
P2000|Obsidian|5.50|#8847ff
P2000|Ocean Foam|180.00|#d32ee6
P2000|Oceanic|0.90|#4b69ff
P2000|Panther Camo|15.00|#5e98d9
P2000|Pathfinder|12.00|#5e98d9
P2000|Pulse|2.50|#4b69ff
P2000|Red FragCam|2.50|#4b69ff
P2000|Red Wing|8.50|#4b69ff
P2000|Royal Baroque|12.50|#4b69ff
P2000|Scorpion|45.00|#8847ff
P2000|Silver|15.00|#4b69ff
P2000|Space Race|35.00|#8847ff
P2000|Sure Grip|4.50|#4b69ff
P2000|Turf|1.10|#4b69ff
P2000|Urban Hazard|0.90|#4b69ff
P2000|Wicked Sick|22.00|#d32ee6
P2000|Woodsman|12.00|#8847ff
P250|Apep's Curse|120.00|#d32ee6
P250|Asiimov|45.00|#d32ee6
P250|Bengal Tiger|12.00|#4b69ff
P250|Black & Tan|3.50|#4b69ff
P250|Bone Mask|0.80|#b0c3d9
P250|Boreal Forest|0.80|#b0c3d9
P250|Bullfrog|12.00|#4b69ff
P250|Cartel|15.00|#d32ee6
P250|Cassette|0.90|#4b69ff
P250|Constructivist|12.50|#5e98d9
P250|Contaminant|1.10|#4b69ff
P250|Contamination|4.50|#5e98d9
P250|Copper Oxide|1.80|#b0c3d9
P250|Crimson Kimono|140.00|#5e98d9
P250|Cyber Shell|2.50|#8847ff
P250|Dark Filigree|15.00|#5e98d9
P250|Digital Architect|15.00|#8847ff
P250|Drought|0.90|#b0c3d9
P250|Epicenter|18.00|#d32ee6
P250|Exchanger|1.10|#4b69ff
P250|Facets|12.00|#5e98d9
P250|Facility Draft|0.80|#b0c3d9
P250|Forest Night|0.80|#b0c3d9
P250|Franklin|45.00|#d32ee6
P250|Gunsmoke|3.50|#5e98d9
P250|Hive|12.00|#4b69ff
P250|Inferno|5.50|#8847ff
P250|Metallic DDPAT|1.50|#5e98d9
P250|Mehndi|55.00|#d32ee6
P250|Mint Kimono|1.50|#b0c3d9
P250|Modern Hunter|120.00|#4b69ff
P250|Muertos|12.00|#d32ee6
P250|Nevermore|5.50|#8847ff
P250|Nuclear Threat|140.00|#8847ff
P250|Plum Netting|1.10|#b0c3d9
P250|Re.built|4.50|#4b69ff
P250|Red Rock|12.00|#8847ff
P250|Red Tide|12.50|#4b69ff
P250|Ripple|0.90|#4b69ff
P250|Sand Dune|0.80|#b0c3d9
P250|See Ya Later|18.00|#eb4b4b
P250|Sedimentary|1.50|#5e98d9
P250|Sleet|0.90|#b0c3d9
P250|Small Game|4.50|#4b69ff
P250|Splash|45.00|#8847ff
P250|Steel Disruption|8.50|#4b69ff
P250|Supernova|5.50|#8847ff
P250|Undertow|65.00|#d32ee6
P250|Valence|0.90|#4b69ff
P250|Verdigris|0.90|#4b69ff
P250|Vino Primo|15.00|#8847ff
P250|Visions|15.00|#d32ee6
P250|Whiteout|65.00|#4b69ff
P250|Wingshot|5.50|#8847ff
P250|X-Ray|1.50|#8847ff
P90|Aeolian Light|12.50|#4b69ff
P90|Asiimov|45.00|#eb4b4b
P90|Astral J√∂rmungandr|320.00|#8847ff
P90|Attack Vector|15.00|#8847ff
P90|Baroque Red|12.00|#4b69ff
P90|Blind Spot|12.00|#8847ff
P90|Blue Tac|1.10|#b0c3d9
P90|Chopper|2.50|#8847ff
P90|Cocoa Rampage|1.10|#4b69ff
P90|Death by Kitty|180.00|#eb4b4b
P90|Death Grip|12.00|#8847ff
P90|Desert DDPAT|1.50|#b0c3d9
P90|Desert Halftone|0.90|#b0c3d9
P90|Desert Warfare|1.50|#4b69ff
P90|Elite Build|1.10|#4b69ff
P90|Emerald Dragon|450.00|#d32ee6
P90|Facility Negative|1.50|#4b69ff
P90|Fallout Warning|15.00|#5e98d9
P90|Freight|1.10|#4b69ff
P90|Glacier Mesh|15.00|#4b69ff
P90|Grim|0.90|#4b69ff
P90|Leather|140.00|#5e98d9
P90|Module|1.10|#4b69ff
P90|Mustard Gas|12.00|#5e98d9
P90|Neoqueen|8.50|#8847ff
P90|Nostalgia|15.00|#d32ee6
P90|Off World|0.90|#4b69ff
P90|Randy Rush|18.00|#8847ff
P90|Reef Grief|4.50|#4b69ff
P90|Sand Spray|0.80|#b0c3d9
P90|ScaraB Rush|12.00|#8847ff
P90|Schematic|12.00|#4b69ff
P90|Scorched|0.80|#b0c3d9
P90|Shallow Grave|12.00|#d32ee6
P90|Shapewood|12.00|#d32ee6
P90|Straight Dimes|3.50|#5e98d9
P90|Storm|1.50|#b0c3d9
P90|Sunset Lily|15.00|#5e98d9
P90|Teardown|4.50|#4b69ff
P90|Tiger Pit|4.50|#4b69ff
P90|Traction|1.10|#4b69ff
P90|Trigon|12.00|#d32ee6
P90|Vent Rush|5.50|#8847ff
P90|Virus|15.00|#8847ff
P90|Wash me|12.00|#5e98d9
P90|Wave Breaker|22.00|#8847ff
PP-Bizon|Anolis|1.10|#b0c3d9
PP-Bizon|Antique|12.00|#8847ff
PP-Bizon|Bamboo Print|1.50|#b0c3d9
PP-Bizon|Bizoom|0.90|#b0c3d9
PP-Bizon|Blue Streak|15.00|#8847ff
PP-Bizon|Brass|15.00|#4b69ff
PP-Bizon|Breaker Box|1.10|#5e98d9
PP-Bizon|Candy Apple|3.50|#5e98d9
PP-Bizon|Carbon Fiber|15.00|#5e98d9
PP-Bizon|Chemical Green|12.00|#5e98d9
PP-Bizon|Cobalt Halftone|2.50|#4b69ff
PP-Bizon|Cold Cell|1.80|#5e98d9
PP-Bizon|Death Rattle|1.10|#b0c3d9
PP-Bizon|Embargo|5.50|#8847ff
PP-Bizon|Facility Sketch|0.80|#b0c3d9
PP-Bizon|Forest Leaves|0.80|#b0c3d9
PP-Bizon|Fuel Rod|12.00|#8847ff
PP-Bizon|Harvester|0.90|#4b69ff
PP-Bizon|High Roller|15.00|#d32ee6
PP-Bizon|Irradiated Alert|0.80|#b0c3d9
PP-Bizon|Judgement of Anubis|15.00|#eb4b4b
PP-Bizon|Jungle Slipstream|0.90|#4b69ff
PP-Bizon|Lumen|1.10|#4b69ff
PP-Bizon|Modern Hunter|140.00|#4b69ff
PP-Bizon|Night Ops|1.50|#5e98d9
PP-Bizon|Night Riot|1.10|#4b69ff
PP-Bizon|Osiris|2.50|#8847ff
PP-Bizon|Photic Zone|1.10|#4b69ff
PP-Bizon|Runic|0.90|#4b69ff
PP-Bizon|Rust Coat|15.00|#4b69ff
PP-Bizon|Sand Dashed|0.80|#b0c3d9
PP-Bizon|Seabird|0.90|#b0c3d9
PP-Bizon|Space Cat|5.50|#8847ff
PP-Bizon|Thermal Currents|0.90|#b0c3d9
PP-Bizon|Urban Dashed|0.80|#b0c3d9
PP-Bizon|Water Sigil|2.50|#4b69ff
PP-Bizon|Wood Block Camo|1.50|#b0c3d9
R8 Revolver|Amber Fade|15.00|#d32ee6
R8 Revolver|Banana Cannon|5.50|#8847ff
R8 Revolver|Blaze|12.00|#4b69ff
R8 Revolver|Bone Forged|1.10|#4b69ff
R8 Revolver|Bone Mask|0.80|#b0c3d9
R8 Revolver|Canal Spray|1.50|#b0c3d9
R8 Revolver|Cobalt Grip|1.50|#b0c3d9
R8 Revolver|Crazy 8|3.50|#8847ff
R8 Revolver|Crimson Web|12.00|#4b69ff
R8 Revolver|Dark Chamber|12.50|#5e98d9
R8 Revolver|Desert Brush|1.10|#b0c3d9
R8 Revolver|Fade|25.00|#eb4b4b
R8 Revolver|Grip|1.10|#4b69ff
R8 Revolver|Inlay|0.80|#b0c3d9
R8 Revolver|Junk Yard|1.10|#4b69ff
R8 Revolver|Leafhopper|1.80|#5e98d9
R8 Revolver|Llama Cannon|15.00|#d32ee6
R8 Revolver|Mauve Aside|1.10|#b0c3d9
R8 Revolver|Memento|1.10|#4b69ff
R8 Revolver|Night|12.50|#b0c3d9
R8 Revolver|Nitro|1.50|#5e98d9
R8 Revolver|Phoenix Marker|1.50|#5e98d9
R8 Revolver|Reboot|2.50|#8847ff
R8 Revolver|Skull Crusher|12.00|#d32ee6
R8 Revolver|Survivalist|1.10|#4b69ff
R8 Revolver|Tango|4.50|#4b69ff
SCAR-20|Assault|2.50|#4b69ff
SCAR-20|Bloodsport|15.00|#d32ee6
SCAR-20|Blueprint|1.10|#4b69ff
SCAR-20|Brass|12.00|#4b69ff
SCAR-20|Caged|8.50|#4b69ff
SCAR-20|Carbon Fiber|1.50|#5e98d9
SCAR-20|Cardiac|12.00|#d32ee6
SCAR-20|Contractor|0.80|#b0c3d9
SCAR-20|Crimson Web|12.00|#4b69ff
SCAR-20|Cyrex|15.00|#d32ee6
SCAR-20|Emerald|350.00|#8847ff
SCAR-20|Enforcer|2.50|#8847ff
SCAR-20|Fragments|1.10|#4b69ff
SCAR-20|Green Marine|1.10|#4b69ff
SCAR-20|Grotto|0.90|#4b69ff
SCAR-20|Jungle Slipstream|1.10|#4b69ff
SCAR-20|Keeping Tabs|1.10|#4b69ff
SCAR-20|Magna Carta|12.00|#4b69ff
SCAR-20|Murky|1.20|#4b69ff
SCAR-20|Outbreak|0.90|#4b69ff
SCAR-20|Palm|1.50|#5e98d9
SCAR-20|Poultrygeist|1.10|#4b69ff
SCAR-20|Powercore|2.50|#8847ff
SCAR-20|Sand Mesh|0.80|#b0c3d9
SCAR-20|Short Ochre|1.50|#b0c3d9
SCAR-20|Splash Jam|1450.00|#d32ee6
SCAR-20|Stone Mosaico|2.50|#b0c3d9
SCAR-20|Storm|1.50|#b0c3d9
SCAR-20|Torn|1.10|#4b69ff
SCAR-20|Trail Blazer|5.50|#4b69ff
SCAR-20|Wild Berry|12.50|#4b69ff
SCAR-20|Zinc|0.90|#b0c3d9
SG 553|Aerial|0.90|#4b69ff
SG 553|Aloha|0.90|#4b69ff
SG 553|Anodized Navy|15.00|#4b69ff
SG 553|Army Sheen|0.80|#b0c3d9
SG 553|Atlas|0.90|#4b69ff
SG 553|Barricade|0.80|#b0c3d9
SG 553|Berry Gel Coat|12.50|#4b69ff
SG 553|Bleached|1.10|#b0c3d9
SG 553|Bulldozer|140.00|#8847ff
SG 553|Candy Apple|1.50|#5e98d9
SG 553|Colony IV|15.00|#d32ee6
SG 553|Cyberforce|4.50|#4b69ff
SG 553|Cyrex|12.00|#d32ee6
SG 553|Damascus Steel|15.00|#4b69ff
SG 553|Danger Close|1.10|#4b69ff
SG 553|Darkwing|2.50|#8847ff
SG 553|Desert Blossom|12.00|#4b69ff
SG 553|Dragon Tech|2.50|#8847ff
SG 553|Fallout Warning|12.00|#5e98d9
SG 553|Gator Mesh|1.50|#5e98d9
SG 553|Hazard Pay|180.00|#d32ee6
SG 553|Heavy Metal|1.10|#4b69ff
SG 553|Hypnotic|120.00|#8847ff
SG 553|Integrale|140.00|#d32ee6
SG 553|Lush Ruins|1.10|#b0c3d9
SG 553|Night Camo|1.50|#b0c3d9
SG 553|Ol' Rusty|0.90|#4b69ff
SG 553|Phantom|2.50|#8847ff
SG 553|Pulse|12.00|#8847ff
SG 553|Safari Print|0.90|#b0c3d9
SG 553|Tiger Moth|8.50|#8847ff
SG 553|Tornado|1.50|#b0c3d9
SG 553|Traveler|15.00|#5e98d9
SG 553|Triarch|2.50|#8847ff
SG 553|Ultraviolet|15.00|#4b69ff
SG 553|Wave Spray|12.00|#4b69ff
SG 553|Waves Perforated|0.80|#b0c3d9
SSG 08|Abyss|2.50|#4b69ff
SSG 08|Acid Fade|35.00|#4b69ff
SSG 08|Azure Glyph|3.50|#5e98d9
SSG 08|Big Iron|15.00|#d32ee6
SSG 08|Blood in the Water|180.00|#eb4b4b
SSG 08|Bloodshot|22.00|#d32ee6
SSG 08|Blue Spruce|0.80|#b0c3d9
SSG 08|Blush Pour|12.50|#4b69ff
SSG 08|Calligrafaux|12.50|#5e98d9
SSG 08|Carbon Fiber|1.10|#5e98d9
SSG 08|Dark Water|45.00|#4b69ff
SSG 08|Death Strike|350.00|#d32ee6
SSG 08|Death's Head|12.00|#8847ff
SSG 08|Detour|15.00|#4b69ff
SSG 08|Dezastre|12.50|#4b69ff
SSG 08|Dragonfire|25.00|#eb4b4b
SSG 08|Fever Dream|2.50|#8847ff
SSG 08|Ghost Crusader|2.50|#8847ff
SSG 08|Green Ceramic|1.50|#b0c3d9
SSG 08|Grey Smoke|1.10|#b0c3d9
SSG 08|Halftone Whorl|1.80|#5e98d9
SSG 08|Hand Brake|12.00|#4b69ff
SSG 08|Jungle Dashed|0.80|#b0c3d9
SSG 08|Lichen Dashed|12.00|#b0c3d9
SSG 08|Mainframe 001|0.90|#4b69ff
SSG 08|Mayan Dreams|15.00|#5e98d9
SSG 08|Memorial|12.50|#4b69ff
SSG 08|Necropos|1.10|#4b69ff
SSG 08|Orange Filigree|12.00|#4b69ff
SSG 08|Parallax|3.50|#8847ff
SSG 08|PAW|2.50|#8847ff
SSG 08|Prey|0.80|#b0c3d9
SSG 08|Rapid Transit|22.00|#8847ff
SSG 08|Red Stone|1.50|#b0c3d9
SSG 08|Sand Dune|1.50|#b0c3d9
SSG 08|Sans Comic|12.50|#b0c3d9
SSG 08|Sea Calico|140.00|#8847ff
SSG 08|Slashed|1.10|#4b69ff
SSG 08|Spring Twilly|12.00|#4b69ff
SSG 08|Threat Detected|12.00|#4b69ff
SSG 08|Tiger Tear|3.80|#5e98d9
SSG 08|Tropical Storm|15.00|#5e98d9
SSG 08|Turbo Peek|15.00|#d32ee6
SSG 08|Zeno|12.50|#4b69ff
Sawed-Off|Amber Fade|15.00|#4b69ff
Sawed-Off|Analog Input|12.50|#8847ff
Sawed-Off|Apocalypto|2.50|#8847ff
Sawed-Off|Bamboo Shadow|1.50|#b0c3d9
Sawed-Off|Black Sand|0.90|#4b69ff
Sawed-Off|Brake Light|12.00|#4b69ff
Sawed-Off|Clay Ambush|1.10|#b0c3d9
Sawed-Off|Copper|125.00|#4b69ff
Sawed-Off|Crimson Batik|1.50|#b0c3d9
Sawed-Off|Devourer|12.00|#d32ee6
Sawed-Off|First Class|15.00|#4b69ff
Sawed-Off|Forest DDPAT|0.80|#b0c3d9
Sawed-Off|Fubar|0.90|#4b69ff
Sawed-Off|Full Stop|12.00|#4b69ff
Sawed-Off|Highwayman|5.50|#8847ff
Sawed-Off|Irradiated Alert|1.50|#b0c3d9
Sawed-Off|Jungle Thicket|0.80|#b0c3d9
Sawed-Off|Kiss‚ô•Love|15.00|#d32ee6
Sawed-Off|Limelight|2.50|#8847ff
Sawed-Off|Morris|1.10|#4b69ff
Sawed-Off|Mosaico|1.50|#5e98d9
Sawed-Off|Orange DDPAT|15.00|#8847ff
Sawed-Off|Origami|0.90|#4b69ff
Sawed-Off|Parched|1.10|#b0c3d9
Sawed-Off|Rust Coat|1.50|#5e98d9
Sawed-Off|Runoff|1.10|#b0c3d9
Sawed-Off|Sage Spray|0.80|#b0c3d9
Sawed-Off|Serenity|2.50|#8847ff
Sawed-Off|Snake Camo|15.00|#5e98d9
Sawed-Off|Spirit Board|1.10|#4b69ff
Sawed-Off|The Kraken|45.00|#eb4b4b
Sawed-Off|Wasteland Princess|12.00|#d32ee6
Sawed-Off|Yorick|1.10|#4b69ff
Sawed-Off|Zander|0.90|#4b69ff
Tec-9|Army Mesh|1.50|#b0c3d9
Tec-9|Avalanche|5.50|#8847ff
Tec-9|Bamboo Forest|1.50|#b0c3d9
Tec-9|Bamboozle|2.50|#8847ff
Tec-9|Banana Leaf|12.00|#5e98d9
Tec-9|Blast From the Past|12.00|#4b69ff
Tec-9|Blue Blast|1.10|#b0c3d9
Tec-9|Blue Titanium|12.00|#4b69ff
Tec-9|Brass|45.00|#4b69ff
Tec-9|Brother|2.50|#8847ff
Tec-9|Citric Acid|3.50|#5e98d9
Tec-9|Cracked Opal|1.10|#4b69ff
Tec-9|Cut Out|1.20|#4b69ff
Tec-9|Decimator|12.00|#d32ee6
Tec-9|Flash Out|1.20|#4b69ff
Tec-9|Fubar|0.90|#4b69ff
Tec-9|Fuel Injector|15.00|#d32ee6
Tec-9|Garter-9|12.00|#5e98d9
Tec-9|Groundwater|0.80|#b0c3d9
Tec-9|Hades|12.00|#5e98d9
Tec-9|Ice Cap|1.10|#4b69ff
Tec-9|Isaac|12.00|#4b69ff
Tec-9|Jambiya|1.10|#4b69ff
Tec-9|Mummy's Rot|4.50|#4b69ff
Tec-9|Nuclear Threat|180.00|#8847ff
Tec-9|Orange Murano|15.00|#5e98d9
Tec-9|Ossified|12.00|#4b69ff
Tec-9|Phoenix Chalk|1.10|#b0c3d9
Tec-9|Raw Ceramic|0.90|#b0c3d9
Tec-9|Re-Entry|2.50|#8847ff
Tec-9|Rebel|4.50|#4b69ff
Tec-9|Red Quartz|15.00|#8847ff
Tec-9|Remote Control|45.00|#d32ee6
Tec-9|Rust Leaf|12.00|#5e98d9
Tec-9|Safety Net|12.00|#4b69ff
Tec-9|Sandstorm|2.50|#4b69ff
Tec-9|Slag|4.50|#4b69ff
Tec-9|Snek-9|1.10|#4b69ff
Tec-9|Terrace|110.00|#4b69ff
Tec-9|Tiger Stencil|1.80|#5e98d9
Tec-9|Titanium Bit|15.00|#8847ff
Tec-9|Tornado|1.50|#b0c3d9
Tec-9|Toxic|12.00|#4b69ff
Tec-9|Urban DDPAT|0.80|#b0c3d9
Tec-9|VariCamo|1.50|#5e98d9
Tec-9|Whiteout|65.00|#8847ff
UMP-45|Arctic Wolf|2.50|#8847ff
UMP-45|Blaze|12.00|#4b69ff
UMP-45|Bone Pile|4.50|#4b69ff
UMP-45|Briefing|0.90|#4b69ff
UMP-45|Caramel|1.50|#b0c3d9
UMP-45|Carbon Fiber|1.50|#5e98d9
UMP-45|Continuum|28.00|#8847ff
UMP-45|Corporal|1.10|#4b69ff
UMP-45|Crime Scene|35.00|#8847ff
UMP-45|Crimson Foil|25.00|#8847ff
UMP-45|Day Lily|140.00|#4b69ff
UMP-45|Delusion|1.10|#4b69ff
UMP-45|Exposure|2.50|#8847ff
UMP-45|Facility Dark|0.80|#b0c3d9
UMP-45|Fade|95.00|#d32ee6
UMP-45|Fallout Warning|15.00|#5e98d9
UMP-45|Full Stop|12.00|#4b69ff
UMP-45|Gold Bismuth|2.50|#8847ff
UMP-45|Grand Prix|2.50|#8847ff
UMP-45|Green Swirl|1.50|#b0c3d9
UMP-45|Gunsmoke|1.50|#5e98d9
UMP-45|Houndstooth|12.00|#5e98d9
UMP-45|Indigo|1.50|#b0c3d9
UMP-45|K.O. Factory|42.00|#d32ee6
UMP-45|Labyrinth|1.10|#4b69ff
UMP-45|Late Night Transit|4.50|#4b69ff
UMP-45|Mechanism|1.10|#5e98d9
UMP-45|Metal Flowers|1.20|#4b69ff
UMP-45|Minotaur's Labyrinth|95.00|#4b69ff
UMP-45|Momentum|12.00|#d32ee6
UMP-45|Moonrise|2.50|#8847ff
UMP-45|Motorized|4.50|#4b69ff
UMP-45|Mudder|0.80|#b0c3d9
UMP-45|Neo-Noir|28.00|#d32ee6
UMP-45|Oscillator|1.10|#4b69ff
UMP-45|Plastique|2.50|#8847ff
UMP-45|Primal Saber|12.00|#d32ee6
UMP-45|Riot|1.10|#4b69ff
UMP-45|Roadblock|1.10|#4b69ff
UMP-45|Scaffold|2.50|#8847ff
UMP-45|Scorched|0.80|#b0c3d9
UMP-45|Urban DDPAT|0.80|#b0c3d9
UMP-45|Warm Blooded|8.50|#4b69ff
UMP-45|Wild Child|15.00|#d32ee6
USP-S|27|12.50|#4b69ff
USP-S|Alpine Camo|4.50|#4b69ff
USP-S|Ancient Visions|45.00|#8847ff
USP-S|Black Lotus|12.00|#4b69ff
USP-S|Bleeding Edge|32.00|#8847ff
USP-S|Blood Tiger|12.00|#4b69ff
USP-S|Blueprint|18.00|#4b69ff
USP-S|Bright Water|110.00|#8847ff
USP-S|Business Class|120.00|#4b69ff
USP-S|Caiman|65.00|#d32ee6
USP-S|Check Engine|12.00|#4b69ff
USP-S|Cortex|12.00|#d32ee6
USP-S|Cyrex|12.00|#8847ff
USP-S|Dark Water|95.00|#8847ff
USP-S|Desert Tactical|3.80|#5e98d9
USP-S|Flashback|2.50|#8847ff
USP-S|Forest Leaves|1.50|#5e98d9
USP-S|Guardian|12.00|#8847ff
USP-S|Jawbreaker|85.00|#d32ee6
USP-S|Kill Confirmed|150.00|#eb4b4b
USP-S|Lead Conduit|2.50|#4b69ff
USP-S|Monster Mashup|45.00|#d32ee6
USP-S|Neo-Noir|55.00|#eb4b4b
USP-S|Night Ops|12.00|#4b69ff
USP-S|Orange Anolis|14.00|#8847ff
USP-S|Orion|140.00|#d32ee6
USP-S|Overgrowth|110.00|#8847ff
USP-S|Para Green|15.00|#5e98d9
USP-S|Pathfinder|12.00|#5e98d9
USP-S|PC-GRN|12.50|#4b69ff
USP-S|Printstream|150.00|#eb4b4b
USP-S|Purple DDPAT|14.00|#4b69ff
USP-S|Road Rash|110.00|#8847ff
USP-S|Royal Blue|15.00|#5e98d9
USP-S|Royal Guard|28.00|#8847ff
USP-S|Serum|65.00|#d32ee6
USP-S|Sleeping Potion|35.00|#8847ff
USP-S|Stainless|15.00|#4b69ff
USP-S|Target Acquired|380.00|#d32ee6
USP-S|The Traitor|140.00|#eb4b4b
USP-S|Ticket to Hell|5.50|#8847ff
USP-S|Torque|2.50|#4b69ff
USP-S|Tropical Breeze|12.50|#4b69ff
USP-S|Whiteout|120.00|#d32ee6
XM1014|Ancient Lore|15.00|#8847ff
XM1014|Banana Leaf|12.00|#5e98d9
XM1014|Black Tie|2.50|#8847ff
XM1014|Blaze Orange|120.00|#4b69ff
XM1014|Blue Steel|3.50|#5e98d9
XM1014|Blue Spruce|0.80|#b0c3d9
XM1014|Blue Tire|1.10|#b0c3d9
XM1014|Bone Machine|4.50|#4b69ff
XM1014|CaliCamo|1.50|#5e98d9
XM1014|Canvas Cloud|1.10|#b0c3d9
XM1014|Charter|0.80|#b0c3d9
XM1014|Copperflage|8.50|#4b69ff
XM1014|Elegant Vines|45.00|#8847ff
XM1014|Entombed|5.50|#d32ee6
XM1014|Fallout Warning|15.00|#5e98d9
XM1014|Frost Borre|12.00|#4b69ff
XM1014|Grassland|0.80|#b0c3d9
XM1014|Gum Wall Camo|3.50|#5e98d9
XM1014|Halftone Shift|4.50|#4b69ff
XM1014|Heaven Guard|2.50|#8847ff
XM1014|Hieroglyph|0.80|#b0c3d9
XM1014|Incinegator|15.00|#d32ee6
XM1014|Irezumi|4.50|#4b69ff
XM1014|Jungle|0.80|#b0c3d9
XM1014|Mockingbird|12.50|#4b69ff
XM1014|Monster Melt|22.00|#8847ff
XM1014|Oxide Blaze|0.90|#4b69ff
XM1014|Quicksilver|0.90|#4b69ff
XM1014|Red Leather|15.00|#4b69ff
XM1014|Red Python|4.50|#4b69ff
XM1014|Run Run Run|8.50|#4b69ff
XM1014|Scumbria|0.90|#4b69ff
XM1014|Seasons|2.50|#8847ff
XM1014|Slipstream|0.90|#4b69ff
XM1014|Teclu Burner|2.50|#8847ff
XM1014|Tranquility|15.00|#d32ee6
XM1014|Urban Perforated|0.80|#b0c3d9
XM1014|VariCamo Blue|12.00|#4b69ff
XM1014|Watchdog|1.10|#4b69ff
XM1014|XOXO|8.50|#d32ee6
XM1014|XoooM|15.00|#5e98d9
XM1014|Zombie Offensive|2.50|#8847ff
Zeus x27|Olympus|45.00|#d32ee6
Zeus x27|Electric Blue|3.80|#5e98d9
Zeus x27|Dragon Snore|38.00|#d32ee6
Zeus x27|Earth Mandala|12.00|#4b69ff
Zeus x27|Swamp DDPAT|1.10|#b0c3d9
Zeus x27|Tosai|5.50|#8847ff
Zeus x27|Charged Up|8.50|#8847ff
`;
        const skinsDB = {};
        const GLOVE_TYPES = ["Driver Gloves", "Sport Gloves", "Specialist Gloves", "Hand Wraps", "Moto Gloves", "Broken Fang Gloves", "Hydra Gloves", "Bloodhound Gloves"];
        const REMOVED_SKIN_KEYS = new Set([
            "scar_20|murky",
            "desert_eagle|ice_cap",
            "ssg_08|po",
            "negev|midnight_palm",
            "galil_ar|robins_egg",
            "nova|copperfledge",
            "nova|copperflage",
            "nova|oxide_blaze",
            "nova|hieroglyph",
            "tec_9|mummys_rot",
            "m9_bayonet|sakaku",
            "mp9|sakkaku",
            "negev|manowar",
            "negev|man_o_war",
            "ssg_08|deadhead",
            "ssg_08|deaths_head",
            "ssg_08|paw",
            "ssg_08|pav",
            "ssg_08|pav2v",
            "sg_553|ol_rusty",
            "scar_20|keeping_tabs",
            "glock_18|remacy",
            "glock_18|ramese_s_reach",
            "glock_18|rameses_reach",
            "usp_s|bright_water",
            "aug|lil_pig",
            "ump_45|mintaur_slab",
            "p250|ape_skrs",
            "p250|apeps_curse",
            "mp9|pandoras_box",
            "ump_45|minotaurs_labyrinth",
            "zeus_x27|dragon_snore",
            "xm1014|incinegator",
            "xm1014|xooom",
            "m4a4|hellish",
            "m4a4|dark_blossom",
            "m4a4|etch_lord",
            "m4a4|global_offensive",
            "navaja_knife|bright_water",
            "navaja_knife|freehand",
            "navaja_knife|black_laminate",
            "navaja_knife|autotronic",
            "navaja_knife|boreal_forest",
            "nomad_knife|rust_coat",
            "nomad_knife|ultraviolet",
            "nomad_knife|damascus_steel",
            "nomad_knife|bright_water",
            "nomad_knife|black_laminate",
            "nomad_knife|freehand",
            "paracord_knife|rust_coat",
            "paracord_knife|ultraviolet",
            "paracord_knife|damascus_steel",
            "paracord_knife|bright_water",
            "paracord_knife|black_laminate",
            "paracord_knife|freehand",
            "paracord_knife|tiger_tooth",
            "paracord_knife|autotronic",
            "paracord_knife|boreal_forest",
            "survival_knife|rust_coat",
            "survival_knife|ultraviolet",
            "survival_knife|damascus_steel",
            "survival_knife|bright_water",
            "survival_knife|black_laminate",
            "survival_knife|freehand",
            "survival_knife|autotronic",
            "survival_knife|tiger_tooth",
            "survival_knife|boreal_forest",
            "classic_knife|rust_coat",
            "classic_knife|ultraviolet",
            "classic_knife|damascus_steel",
            "classic_knife|bright_water",
            "classic_knife|black_laminate",
            "classic_knife|freehand",
            "classic_knife|crimson_web",
            "ursus_knife|bright_water",
            "ursus_knife|freehand",
            "ursus_knife|black_laminate",
            "kukri_knife|rust_coat",
            "kukri_knife|ultraviolet",
            "kukri_knife|damascus_steel",
            "kukri_knife|bright_water",
            "kukri_knife|freehand",
            "kukri_knife|case_hardened"
        ]);
        
        function normalizeSkinKey(weapon, skinName) {
            const w = (weapon || '').toLowerCase().replace(/[^a-z0-9]+/g, '_').replace(/^_+|_+$/g, '');
            const n = (skinName || '').toLowerCase().replace(/[()'‚Äô]/g, '').replace(/[^a-z0-9]+/g, '_').replace(/^_+|_+$/g, '');
            return `${w}|${n}`;
        }

        function normalizeKnifeFinishName(weapon, skinName) {
            if (!KNIFE_TYPES.includes(weapon)) return skinName;
            const normalized = normalizeName(skinName);
            if (normalized.startsWith('doppler phase')) return 'Doppler';
            if (normalized.startsWith('gamma doppler phase')) return 'Gamma Doppler';
            return skinName;
        }

        function knifeNightSlug(weapon, skinName) {
            if (!KNIFE_TYPES.includes(weapon) || normalizeName(skinName) !== 'night') return skinName;
            const stripeNightKnives = new Set(['Classic Knife', 'Kukri Knife', 'Navaja Knife', 'Nomad Knife', 'Paracord Knife', 'Skeleton Knife', 'Stiletto Knife', 'Survival Knife', 'Talon Knife', 'Ursus Knife']);
            return stripeNightKnives.has(weapon) ? 'Night_Stripe' : 'Night';
        }

        function buildSupabaseAlts(_weapon, _skinName) {
            return [];
        }

        async function enrichSkinsFromHuggingFace() {
            return;
        }

        function adjustLowTierSkinPrice(weapon, skinName, basePrice, color) {
            const normalizedWeapon = (weapon || '').toLowerCase();
            const normalizedSkin = (skinName || '').toLowerCase();
            let price = Number(basePrice || 0);

            if (normalizedWeapon === 'p250' && normalizedSkin === 'sand dune') {
                return 0.03;
            }

            if (color === '#b0c3d9') {
                price = Math.min(price * 0.08, 0.06);
            } else if (color === '#4b69ff' && price <= 1.2) {
                price = Math.min(price * 0.45, 0.45);
            }

            if (price < 0.01) price = 0.01;
            return Math.round(price * 100) / 100;
        }

        rawSkinData.trim().split("\n").forEach((line, idx) => {
            const parts = line.split("|");
            if(parts.length < 4) return;
            const w = parts[0].trim();
            const c = parts[parts.length - 1].trim();
            const p = parts[parts.length - 2].trim();
            const n = parts.slice(1, parts.length - 2).join("|").trim();
            const normalizedFinish = normalizeKnifeFinishName(w, n);
            const parsedKey = normalizeSkinKey(w, normalizedFinish);
            if (REMOVED_SKIN_KEYS.has(parsedKey)) return;
            if (KNIFE_TYPES.includes(w)) {
                const allowed = KNIFE_ALLOWED_FINISHES[w] || [];
                if (!allowed.includes(normalizedFinish)) return;
            }
            let folder = "skins";
            if(GLOVE_TYPES.includes(w)) folder = "gloves";
            else if(KNIFE_TYPES.includes(w)) folder = "knives";
            
            const imgOverrides = {
                "M4A4|ÈæçÁéã (Dragon King)": "https://www.csgodatabase.com/images/skins/webp/M4A4_%E9%BE%8D%E7%8E%8B_(Dragon_King).webp",
                "Driver Gloves|Crimson Weave": "https://www.csgodatabase.com/images/gloves/webp/Driver_Gloves_Crimson_Weave.webp",
                "Broken Fang Gloves|Needle Point": "https://www.csgodatabase.com/images/gloves/webp/Broken_Fang_Gloves_Needle_Point.webp",
                "Sport Gloves|Pandora's Box": "https://www.csgodatabase.com/images/gloves/webp/Sport_Gloves_Pandora's_Box.webp",
                "AWP|Man-o'-war": "https://www.csgodatabase.com/images/skins/webp/AWP_Man-o'-war.webp",
                "Nova|Sobek's Bite": "https://www.csgodatabase.com/images/skins/webp/Nova_Sobek's_Bite.webp",
                "M4A1-S|Chantico's Fire": "https://www.csgodatabase.com/images/skins/webp/M4A1-S_Chantico's_Fire.webp",
                "USP-S|Bright Water": "https://www.csgodatabase.com/images/skins/webp/USP-S_Bright_Water.webp"
            };

            let urlWeapon = w.replace(/ /g, "_");
            let urlName = knifeNightSlug(w, normalizedFinish).replace(/ /g, "_").replace(/'/g, "");
            const overrideKey = `${w}|${normalizedFinish}`;
            const primaryRemote = imgOverrides[overrideKey] || `https://www.csgodatabase.com/images/${folder}/webp/${urlWeapon}_${urlName}.webp`;
            // Alternate patterns (some gloves/rare items have different naming on CDN)
            const altRemote1 = `https://www.csgodatabase.com/images/${folder}/webp/${urlName}.webp`;
            const altRemote2 = primaryRemote.replace('/webp/', '/').replace('.webp', '.png');
            const primaryImg = toCachedImage(primaryRemote);
            const alt1 = toCachedImage(altRemote1);
            const alt2 = toCachedImage(altRemote2);
            skinsDB[idx + 1] = {
                id: idx + 1,
                weapon: w,
                skinName: normalizedFinish,
                name: `${w} | ${normalizedFinish}`,
                price: adjustLowTierSkinPrice(w, n, parseFloat(p), c),
                color: c,
                img: primaryImg,
                imgAlts: Array.from(new Set([alt1, alt2])),
                rarityName: c === '#ebca44' ? 'gold' : (c === '#eb4b4b' ? 'red' : (c === '#d32ee6' ? 'pink' : 'blue'))
            };
        });

        function normalizeName(v) {
            return (v || '').toLowerCase().replace(/[‚Äô']/g, '').replace(/[^a-z0-9]+/g, ' ').trim();
        }

        function findSkin(w, n) {
            const normalizedInputFinish = normalizeKnifeFinishName(w, n);
            const exact = Object.values(skinsDB).find(s => s.weapon === w && s.skinName === n);
            if (exact) return exact;
            const normalizedExact = Object.values(skinsDB).find(s => s.weapon === w && s.skinName === normalizedInputFinish);
            if (normalizedExact) return normalizedExact;
            const nw = normalizeName(w);
            const nn = normalizeName(n);
            const nnNormalizedFinish = normalizeName(normalizedInputFinish);
            return Object.values(skinsDB).find((s) => normalizeName(s.weapon) === nw && (normalizeName(s.skinName) === nn || normalizeName(s.skinName) === nnNormalizedFinish)) || Object.values(skinsDB)[0];
        }

        function addOrUpdateSkin(weapon, skinName, price, color = "#ebca44") {
            const existing = Object.values(skinsDB).find((s) => s.weapon === weapon && s.skinName === skinName);
            const folder = GLOVE_TYPES.includes(weapon) ? "gloves" : (KNIFE_TYPES.includes(weapon) ? "knives" : "skins");
            const weaponSlug = weapon.replace(/ /g, "_");
            const normalizedFinish = normalizeKnifeFinishName(weapon, skinName);
            const skinSlug = knifeNightSlug(weapon, normalizedFinish).replace(/ /g, "_");
            const img = toCachedImage(`https://www.csgodatabase.com/images/${folder}/webp/${weaponSlug}_${skinSlug}.webp`);
            const payload = {
                weapon,
                skinName,
                name: `${weapon} | ${skinName}`,
                price: Math.max(0.01, Math.round(Number(price || 0.01) * 100) / 100),
                color,
                img,
                imgAlts: [],
                rarityName: color === '#ebca44' ? 'gold' : (color === '#eb4b4b' ? 'red' : (color === '#d32ee6' ? 'pink' : 'blue'))
            };
            if (existing) {
                Object.assign(existing, payload);
                return existing;
            }
            const nextId = Math.max(0, ...Object.keys(skinsDB).map(Number)) + 1;
            skinsDB[nextId] = { id: nextId, ...payload };
            return skinsDB[nextId];
        }

        function addExtendedGlovesAndKnives() {
            const gloveRows = [
                ["Bloodhound Gloves","Bronzed",665],["Bloodhound Gloves","Charred",444],["Bloodhound Gloves","Guerrilla",562],["Bloodhound Gloves","Snakebite",565],
                ["Broken Fang Gloves","Jade",596],["Broken Fang Gloves","Needle Point",354],["Broken Fang Gloves","Unhinged",408],["Broken Fang Gloves","Yellow-banded",287],
                ["Driver Gloves","Black Tie",1151],["Driver Gloves","Convoy",500],["Driver Gloves","Crimson Weave",4281],["Driver Gloves","Diamondback",1370],["Driver Gloves","Imperial Plaid",2403],["Driver Gloves","King Snake",3520],["Driver Gloves","Lunar Weave",1600],["Driver Gloves","Overtake",344],["Driver Gloves","Queen Jaguar",496],["Driver Gloves","Racing Green",262],["Driver Gloves","Rezan the Red",836],["Driver Gloves","Snow Leopard",2419],
                ["Hand Wraps","Arboreal",261],["Hand Wraps","Badlands",979],["Hand Wraps","CAUTION!",813],["Hand Wraps","Cobalt Skulls",1637],["Hand Wraps","Constrictor",278],["Hand Wraps","Desert Shamagh",776],["Hand Wraps","Duct Tape",352],["Hand Wraps","Giraffe",495],["Hand Wraps","Leather",1364],["Hand Wraps","Overprint",488],["Hand Wraps","Slaughter",1254],["Hand Wraps","Spruce DDPAT",834],
                ["Hydra Gloves","Case Hardened",650],["Hydra Gloves","Emerald",233],["Hydra Gloves","Mangrove",232],["Hydra Gloves","Rattler",188],
                ["Moto Gloves","3rd Commando Company",305],["Moto Gloves","Blood Pressure",550],["Moto Gloves","Boom!",3180],["Moto Gloves","Cool Mint",1981],["Moto Gloves","Eclipse",957],["Moto Gloves","Finish Line",665],["Moto Gloves","Polygon",645],["Moto Gloves","POW!",631],["Moto Gloves","Smoke Out",708],["Moto Gloves","Spearmint",6284],["Moto Gloves","Transport",642],["Moto Gloves","Turtle",488],
                ["Specialist Gloves","Buckshot",280],["Specialist Gloves","Crimson Kimono",6878],["Specialist Gloves","Crimson Web",1363],["Specialist Gloves","Emerald Web",5161],["Specialist Gloves","Fade",1579],["Specialist Gloves","Field Agent",893],["Specialist Gloves","Forest DDPAT",646],["Specialist Gloves","Foundation",1963],["Specialist Gloves","Lt. Commander",611],["Specialist Gloves","Marble Fade",1310],["Specialist Gloves","Mogul",717],["Specialist Gloves","Tiger Strike",1236],
                ["Sport Gloves","Amphibious",2152],["Sport Gloves","Arid",3417],["Sport Gloves","Big Game",1717],["Sport Gloves","Bronze Morph",559],["Sport Gloves","Hedge Maze",18932],["Sport Gloves","Nocts",5240],["Sport Gloves","Omega",3081],["Sport Gloves","Pandora's Box",17832],["Sport Gloves","Scarlet Shamagh",1241],["Sport Gloves","Slingshot",3715],["Sport Gloves","Superconductor",7993],["Sport Gloves","Vice",58406]
            ];

            gloveRows.forEach(([weapon, skin, avg]) => addOrUpdateSkin(weapon, skin, avg, '#ebca44'));

            const knifeBasePrice = {
                "Bayonet": 650, "Bowie Knife": 290, "Butterfly Knife": 1700, "Classic Knife": 420, "Falchion Knife": 260,
                "Flip Knife": 470, "Gut Knife": 220, "Huntsman Knife": 360, "Karambit": 1450, "Kukri Knife": 430,
                "M9 Bayonet": 980, "Navaja Knife": 170, "Nomad Knife": 350, "Paracord Knife": 290, "Shadow Daggers": 210,
                "Skeleton Knife": 640, "Stiletto Knife": 460, "Survival Knife": 300, "Talon Knife": 780, "Ursus Knife": 390
            };
            const finishMult = {
                "Safari Mesh": 0.72, "Scorched": 0.76, "Forest DDPAT": 0.78, "Urban Masked": 0.8,
                "Boreal Forest": 0.82, "Night": 0.9, "Night Stripe": 0.9, "Blue Steel": 1.02, "Stained": 0.94,
                "Case Hardened": 1.25, "Crimson Web": 1.28, "Slaughter": 1.55, "Fade": 2.05, "Tiger Tooth": 1.72,
                "Marble Fade": 2.18, "Damascus Steel": 1.1, "Ultraviolet": 1.06, "Rust Coat": 0.85, "Lore": 1.65,
                "Autotronic": 1.78, "Black Laminate": 1.24, "Freehand": 1.2, "Bright Water": 1.15,
                "Doppler": 2.35, "Doppler Ruby": 4.2, "Doppler Sapphire": 4.35, "Doppler Black Pearl": 3.7,
                "Gamma Doppler": 2.5,
                "Gamma Doppler Emerald": 5.1
            };
            KNIFE_TYPES.forEach((knife) => {
                const base = knifeBasePrice[knife] || 320;
                const allowedFinishes = KNIFE_ALLOWED_FINISHES[knife] || [];
                allowedFinishes.forEach((finish) => {
                    const price = base * (finishMult[finish] || 1);
                    addOrUpdateSkin(knife, finish, price, '#ebca44');
                });
            });
        }

        addExtendedGlovesAndKnives();

        const casesDB = [];
        setTimeout(() => {
            casesDB.push(
                {
                    id: "trash-or-knife", name: "1% KNIFE Risk", price: 25.00, color: "yellow-400",
                    img: findSkin("M9 Bayonet", "Autotronic").img,
                    contents: [
                        { skin: findSkin("P250", "Sand Dune"), chance: 99.0 },
                        { skin: findSkin("M9 Bayonet", "Autotronic"), chance: 1.0 }
                    ]
                },
                {
                    id: "coinflip", name: "50/50 Profit", price: 50.00, color: "red",
                    img: findSkin("AK-47", "Bloodsport").img,
                    contents: [
                        { skin: findSkin("AK-47", "Slate"), chance: 50.0 },
                        { skin: findSkin("AK-47", "Bloodsport"), chance: 50.0 }
                    ]
                },
                {
                    id: "budget", name: "Budget Grinder", price: 5.00, color: "blue",
                    img: findSkin("AWP", "Worm God").img,
                    contents: [
                        { skin: findSkin("Glock-18", "Catacombs"), chance: 60.0 },
                        { skin: findSkin("USP-S", "Ticket to Hell"), chance: 25.0 },
                        { skin: findSkin("AWP", "Mortis"), chance: 12.0 },
                        { skin: findSkin("M4A4", "Desolate Space"), chance: 2.5 },
                        { skin: findSkin("AK-47", "Redline"), chance: 0.5 }
                    ]
                },
                {
                    id: "covert", name: "Covert Dreams", price: 100.00, color: "red",
                    img: findSkin("AWP", "Asiimov").img,
                    contents: [
                        { skin: findSkin("M4A4", "The Emperor"), chance: 65.0 },
                        { skin: findSkin("AK-47", "Vulcan"), chance: 25.0 },
                        { skin: findSkin("AWP", "Asiimov"), chance: 8.0 },
                        { skin: findSkin("Desert Eagle", "Emerald J√∂rmungandr"), chance: 2.0 }
                    ]
                },
                {
                    id: "dragon", name: "Dragon Lore 1%", price: 200.00, color: "yellow-400",
                    img: findSkin("AWP", "Dragon Lore").img,
                    contents: [
                        { skin: findSkin("AWP", "Atheris"), chance: 80.0 },
                        { skin: findSkin("AWP", "Neo-Noir"), chance: 19.0 },
                        { skin: findSkin("AWP", "Dragon Lore"), chance: 1.0 }
                    ]
                },
                {
                    id: "knife-budget", name: "Budget Knives", price: 150.00, color: "purple",
                    img: findSkin("Bayonet", "Slaughter").img,
                    contents: [
                        { skin: findSkin("Gut Knife", "Tiger Tooth"), chance: 70.0 },
                        { skin: findSkin("Flip Knife", "Tiger Tooth"), chance: 20.0 },
                        { skin: findSkin("Bayonet", "Tiger Tooth"), chance: 10.0 }
                    ]
                },
                {
                    id: "knife-ultra", name: "Ultra Knife Box", price: 500.00, color: "gold",
                    img: findSkin("Karambit", "Fade").img,
                    contents: [
                        { skin: findSkin("M9 Bayonet", "Doppler"), chance: 30.0 },
                        { skin: findSkin("Butterfly Knife", "Fade"), chance: 25.0 },
                        { skin: findSkin("Karambit", "Tiger Tooth"), chance: 20.0 },
                        { skin: findSkin("Karambit", "Fade"), chance: 15.0 },
                        { skin: findSkin("Talon Knife", "Fade"), chance: 10.0 }
                    ]
                },
                {
                    id: "top-tier", name: "TOP TIER All Star", price: 300.00, color: "red",
                    img: findSkin("M4A4", "Howl").img,
                    contents: [
                        { skin: findSkin("M4A4", "Howl"), chance: 35.0 },
                        { skin: findSkin("AWP", "Medusa"), chance: 30.0 },
                        { skin: findSkin("AK-47", "Wild Lotus"), chance: 25.0 },
                        { skin: findSkin("Karambit", "Doppler"), chance: 10.0 }
                    ]
                },
                {
                    id: "mystery", name: "Mystery Case", price: 75.00, color: "purple",
                    img: findSkin("Glock-18", "Water Elemental").img,
                    contents: [
                        { skin: findSkin("USP-S", "Orion"), chance: 40.0 },
                        { skin: findSkin("M4A1-S", "Hyper Beast"), chance: 30.0 },
                        { skin: findSkin("AK-47", "Neon Rider"), chance: 20.0 },
                        { skin: findSkin("Huntsman Knife", "Slaughter"), chance: 10.0 }
                    ]
                },
                {
                    id: "gloves", name: "Glove Heaven", price: 250.00, color: "pink",
                    img: findSkin("Sport Gloves", "Vice").img,
                    contents: [
                        { skin: findSkin("Moto Gloves", "Specter"), chance: 40.0 },
                        { skin: findSkin("Specialist Gloves", "Crimson Kimono"), chance: 35.0 },
                        { skin: findSkin("Hand Wraps", "Slaughter"), chance: 20.0 },
                        { skin: findSkin("Sport Gloves", "Pandoras Box"), chance: 5.0 }
                    ]
                },
                {
                    id: "legendary", name: "LEGENDARY Box", price: 1000.00, color: "gold",
                    img: findSkin("AWP", "Gungnir").img,
                    contents: [
                        { skin: findSkin("AWP", "Dragon Lore"), chance: 20.0 },
                        { skin: findSkin("AWP", "Gungnir"), chance: 30.0 },
                        { skin: findSkin("M4A4", "Howl"), chance: 25.0 },
                        { skin: findSkin("Karambit", "Lore"), chance: 15.0 },
                        { skin: findSkin("M9 Bayonet", "Lore"), chance: 10.0 }
                    ]
                },
                {
                    id: "low-budget", name: "Low Roller", price: 2.50, color: "blue",
                    img: findSkin("P250", "Sand Dune").img,
                    contents: [
                        { skin: findSkin("Glock-18", "Catacombs"), chance: 50.0 },
                        { skin: findSkin("P250", "Sand Dune"), chance: 30.0 },
                        { skin: findSkin("USP-S", "Ticket to Hell"), chance: 15.0 },
                        { skin: findSkin("MAC-10", "Candy Apple"), chance: 5.0 }
                    ]
                },
                {
                    id: "mid-tier", name: "MID-TIER Master", price: 80.00, color: "purple",
                    img: findSkin("M4A4", "Desolate Space").img,
                    contents: [
                        { skin: findSkin("AK-47", "Redline"), chance: 35.0 },
                        { skin: findSkin("M4A4", "Desolate Space"), chance: 30.0 },
                        { skin: findSkin("AWP", "Containment Breach"), chance: 25.0 },
                        { skin: findSkin("Desert Eagle", "Printstream"), chance: 10.0 }
                    ]
                },
                {
                    id: "premium-gloves", name: "Premium Gloves", price: 350.00, color: "pink",
                    img: findSkin("Moto Gloves", "Eclipse").img,
                    contents: [
                        { skin: findSkin("Moto Gloves", "Eclipse"), chance: 40.0 },
                        { skin: findSkin("Driver Gloves", "Mogul"), chance: 30.0 },
                        { skin: findSkin("Sport Gloves", "Superconductor"), chance: 20.0 },
                        { skin: findSkin("Specialist Gloves", "Emerald Web"), chance: 10.0 }
                    ]
                },
                {
                    id: "ultra-premium", name: "Ultra Premium", price: 500.00, color: "red",
                    img: findSkin("AWP", "Dragon Lore").img,
                    contents: [
                        { skin: findSkin("AWP", "Dragon Lore"), chance: 25.0 },
                        { skin: findSkin("M4A4", "Howl"), chance: 25.0 },
                        { skin: findSkin("Karambit", "Fade"), chance: 20.0 },
                        { skin: findSkin("Butterfly Knife", "Fade"), chance: 15.0 },
                        { skin: findSkin("Moto Gloves", "Blood Pressure"), chance: 15.0 }
                    ]
                },
                {
                    id: "knife-masters", name: "KNIFE Masters", price: 400.00, color: "yellow-400",
                    img: findSkin("Karambit", "Lore").img,
                    contents: [
                        { skin: findSkin("Karambit", "Lore"), chance: 30.0 },
                        { skin: findSkin("M9 Bayonet", "Lore"), chance: 25.0 },
                        { skin: findSkin("Butterfly Knife", "Crimson Web"), chance: 20.0 },
                        { skin: findSkin("Skeleton Knife", "Fade"), chance: 15.0 },
                        { skin: findSkin("Talon Knife", "Fade"), chance: 10.0 }
                    ]
                },
                {
                    id: "mega-pack", name: "MEGA PACK", price: 150.00, color: "red",
                    img: findSkin("M4A4", "Howl").img,
                    contents: [
                        { skin: findSkin("AWP", "Medusa"), chance: 20.0 },
                        { skin: findSkin("M4A4", "Howl"), chance: 25.0 },
                        { skin: findSkin("AK-47", "Wild Lotus"), chance: 20.0 },
                        { skin: findSkin("Desert Eagle", "Emerald J√∂rmungandr"), chance: 15.0 },
                        { skin: findSkin("Karambit", "Tiger Tooth"), chance: 20.0 }
                    ]
                }
            );

            // CaseHug-inspired extra bedny (unik√°tn√≠, bez duplicit typu GAME ON 1/2/3/4)
            const extraCases = [
                { id:'neon-flora', name:'NEON FLORA', price:0.25, color:'blue', img:'https://cdn.casehug.com/cases/LUCKY_TEDDY_NEW.png?width=640&quality=85', top:[['AK-47','Nightwish'],['AK-47','Neon Rider']] },
                { id:'organic', name:'ORGANIC', price:0.30, color:'blue', img:'https://cdn.casehug.com/cases/ORGANIC.png?width=640&quality=85', top:[['M4A1-S','Player Two'],['USP-S','Cortex']] },
                { id:'candy-drop', name:'CANDY DROP', price:0.40, color:'purple', img:'https://cdn.casehug.com/cases/candy_drop_1.png?width=640&quality=85', top:[['M4A1-S','Mecha Industries'],['MAC-10','Disco Tech']] },
                { id:'double-cheese', name:'DOUBLE CHEESE', price:0.70, color:'blue', img:'https://cdn.casehug.com/cases/DOUBLE_CHEESE.png?width=640&quality=85', top:[['AK-47','Bloodsport'],['AK-47','Slate']] },
                { id:'ritual', name:'RITUAL', price:0.80, color:'purple', img:'https://cdn.casehug.com/cases/RITUAL.png?width=640&quality=85', top:[['Survival Knife','Case Hardened'],['Karambit','Case Hardened']] },
                { id:'hellfire', name:'HELLFIRE', price:0.70, color:'red', img:'https://cdn.casehug.com/cases/HELLFIRE_NEW.png?width=640&quality=85', top:[['M4A4','Hellfire'],['M4A4','The Emperor']] },
                { id:'frosty', name:'FROSTY', price:0.80, color:'blue', img:'https://cdn.casehug.com/cases/FROSTY.png?width=640&quality=85', top:[['AK-47','Ice Coaled'],['AK-47','Vulcan']] },
                { id:'sweet-tooth', name:'SWEET TOOTH', price:1.00, color:'purple', img:'https://cdn.casehug.com/content/case/regular/01/SWEET_TOOTH_1758194472.png?width=640&quality=85', top:[['Karambit','Tiger Tooth'],['Desert Eagle','Printstream']] },
                { id:'duck-luck', name:'DUCK LUCK', price:1.00, color:'blue', img:'https://cdn.casehug.com/cases/DUCK_LUCK.png?width=640&quality=85', top:[['Shadow Daggers','Lore'],['P90','Emerald Dragon']] },
                { id:'alien', name:'ALIEN', price:1.25, color:'purple', img:'https://cdn.casehug.com/cases/ALIEN.png?width=640&quality=85', top:[['AK-47','Vulcan'],['AK-47','Ice Coaled']] },
                { id:'savanna', name:'SAVANNA', price:2.00, color:'blue', img:'https://cdn.casehug.com/cases/SAVANNA.png?width=640&quality=85', top:[['M4A1-S','Chantico\'s Fire'],['M4A1-S','Icarus Fell']] },
                { id:'wild-west', name:'WILD WEST', price:2.00, color:'purple', img:'https://cdn.casehug.com/cases/WILD_WEST.png?width=640&quality=85', top:[['Karambit','Lore'],['M9 Bayonet','Lore']] },
                { id:'insector', name:'INSECTOR', price:2.50, color:'blue', img:'https://cdn.casehug.com/cases/INSECTOR.png?width=640&quality=85', top:[['Flip Knife','Autotronic'],['M4A4','Temukau']] },
                { id:'toxic', name:'TOXIC', price:2.60, color:'purple', img:'https://cdn.casehug.com/cases/TOXIC.png?width=640&quality=85', top:[['AWP','Containment Breach'],['AWP','Atheris']] },
                { id:'workshop', name:'WORKSHOP', price:2.75, color:'blue', img:'https://cdn.casehug.com/cases/WORKSHOP.png?width=640&quality=85', top:[['M9 Bayonet','Lore'],['M4A4','In Living Color']] },
                { id:'game-on', name:'GAME ON', price:4.50, color:'purple', img:'https://cdn.casehug.com/cases/GAME_ON.png?width=640&quality=85', top:[['Glock-18','Gamma Doppler'],['Glock-18','Water Elemental']] },
                { id:'bank-heist', name:'BANK HEIST', price:11.00, color:'red', img:'https://cdn.casehug.com/cases/BANK_HEIST.png?width=640&quality=85', top:[['AK-47','The Empress'],['AK-47','Leet Museo']] },
                { id:'retro', name:'RETRO', price:11.50, color:'purple', img:'https://cdn.casehug.com/cases/RETRO.png?width=640&quality=85', top:[['M9 Bayonet','Lore'],['Karambit','Lore']] },
                { id:'bunny-hop', name:'BUNNY HOP', price:12.75, color:'purple', img:'https://cdn.casehug.com/cases/BUNNY_HOP.png?width=640&quality=85', top:[['Bowie Knife','Gamma Doppler'],['Bowie Knife','Ultraviolet']] },
                { id:'titan', name:'TITAN', price:14.50, color:'red', img:'https://cdn.casehug.com/cases/TITAN.png?width=640&quality=85', top:[['AWP','Medusa'],['AWP','Asiimov']] },
                { id:'gambit', name:'GAMBIT', price:18.00, color:'yellow-400', img:'https://cdn.casehug.com/cases/GAMBIT.png?width=640&quality=85', top:[['Stiletto Knife','Tiger Tooth'],['Karambit','Tiger Tooth']] },
                { id:'savage', name:'SAVAGE', price:25.00, color:'red', img:'https://cdn.casehug.com/cases/SAVAGE.png?width=640&quality=85', top:[['Karambit','Tiger Tooth'],['M9 Bayonet','Tiger Tooth']] },
                { id:'golderra', name:'GOLDERRA', price:26.00, color:'yellow-400', img:'https://cdn.casehug.com/cases/GOLDERRA.png?width=640&quality=85', top:[['Sport Gloves','Amphibious'],['Sport Gloves','Slingshot']] },
                { id:'ferro', name:'FERRO', price:30.00, color:'red', img:'https://cdn.casehug.com/cases/FERRO.png?width=640&quality=85', top:[['Butterfly Knife','Tiger Tooth'],['Desert Eagle','Blaze']] },
                { id:'plant-b', name:'PLANT B', price:36.00, color:'red', img:'https://cdn.casehug.com/cases/bombsite_b_1.png?width=640&quality=85', top:[['AWP','Dragon Lore'],['AK-47','Bloodsport']] },
                { id:'buzzer-blade', name:'BUZZER BLADE', price:42.00, color:'yellow-400', img:'https://cdn.casehug.com/cases/BUZZER_BLADE.png?width=640&quality=85', top:[['M9 Bayonet','Gamma Doppler'],['M9 Bayonet','Autotronic']] },
                { id:'candy-shop', name:'CANDY SHOP', price:45.00, color:'red', img:'https://cdn.casehug.com/cases/CANDY_SHOP.png?width=640&quality=85', top:[['Skeleton Knife','Marble Fade'],['AK-47','Neon Rider']] },
                { id:'kingdom', name:'KINGDOM', price:46.50, color:'red', img:'https://cdn.casehug.com/cases/kingdom_1.png?width=640&quality=85', top:[['Butterfly Knife','Gamma Doppler'],['Butterfly Knife','Gamma Doppler Emerald']] },
                { id:'sushi-master', name:'SUSHI MASTER', price:50.00, color:'red', img:'https://cdn.casehug.com/content/case/regular/01/SUSHI_MASTER_1758194472.png?width=640&quality=85', top:[['M4A4','Howl'],['AK-47','Wild Lotus']] },
                { id:'warzone', name:'WARZONE', price:75.00, color:'red', img:'https://cdn.casehug.com/cases/WARZONE.png?width=640&quality=85', top:[['M9 Bayonet','Autotronic'],['Karambit','Autotronic']] },
                { id:'circus', name:'CIRCUS', price:80.00, color:'red', img:'https://cdn.casehug.com/cases/CIRCUS.png?width=640&quality=85', top:[['M9 Bayonet','Marble Fade'],['Karambit','Marble Fade']] },
                { id:'vac-attack', name:'VAC ATTACK', price:85.00, color:'red', img:'https://cdn.casehug.com/cases/VAC_ATTACK.png?width=640&quality=85', top:[['AWP','Dragon Lore'],['Sport Gloves',"Pandora's Box"]] },
                { id:'chinatown', name:'CHINATOWN', price:97.50, color:'red', img:'https://cdn.casehug.com/cases/CHINATOWN.png?width=640&quality=85', top:[['Specialist Gloves','Crimson Kimono'],['Sport Gloves','Vice']] },
                { id:'el-dorado', name:'EL DORADO', price:100.00, color:'yellow-400', img:'https://cdn.casehug.com/content/case/regular/01/EL_DORADO_1758194472.png?width=640&quality=85', top:[['AK-47','Gold Arabesque'],['Desert Eagle','Blaze']] },
                { id:'arcana', name:'ARCANA', price:120.00, color:'yellow-400', img:'https://cdn.casehug.com/cases/ARCANA.png?width=640&quality=85', top:[['Butterfly Knife','Gamma Doppler'],['Butterfly Knife','Gamma Doppler Emerald']] },
                { id:'babushka', name:'BABUSHKA', price:152.50, color:'red', img:'https://cdn.casehug.com/cases/BABUSHKA.png?width=640&quality=85', top:[['M9 Bayonet','Gamma Doppler Black Pearl'],['M9 Bayonet','Gamma Doppler Emerald']] },
                { id:'quantum', name:'QUANTUM', price:358.00, color:'yellow-400', img:'https://cdn.casehug.com/cases/QUANTUM.png?width=640&quality=85', top:[['AWP','Gungnir'],['Karambit','Fade']] },
                { id:'tiger', name:'TIGER', price:3.80, color:'purple', img:'https://cdn.casehug.com/cases/TIGER.png?width=640&quality=85', top:[['M9 Bayonet','Tiger Tooth'],['Karambit','Tiger Tooth']] },
                { id:'demolition', name:'DEMOLITION', price:11.00, color:'red', img:'https://cdn.casehug.com/cases/DEMOLITION.png?width=640&quality=85', top:[['AWP','The Prince'],['AWP','Asiimov']] },
                { id:'electronic', name:'ELECTRONIC', price:33.00, color:'purple', img:'https://cdn.casehug.com/cases/ELECTRONIC.png?width=640&quality=85', top:[['M9 Bayonet','Autotronic'],['Karambit','Autotronic']] },
                { id:'lab', name:'LAB', price:150.00, color:'red', img:'https://cdn.casehug.com/cases/LAB.png?width=640&quality=85', top:[['Specialist Gloves','Emerald Web'],['Sport Gloves','Vice']] },
                { id:'howl-case', name:'HOWL', price:300.00, color:'yellow-400', img:'https://cdn.casehug.com/cases/HOWL_4.png?width=640&quality=85', top:[['M4A4','Howl'],['AK-47','Wild Lotus']] },

                // New rarity / weapon / themed collection cases
                { id:'rarity-milspec', name:'MIL-SPEC', price:0.35, color:'blue', img:'https://cdn.casehug.com/cases/RARITY_MILSPEC.png?width=640&quality=85', top:[['M4A1-S','Night Terror'],['Galil AR','Rocket Pop']] },
                { id:'rarity-restricted', name:'RESTRICTED', price:2.00, color:'purple', img:'https://cdn.casehug.com/cases/RARITY_RESTRICTED.png?width=640&quality=85', top:[['Glock-18','Water Elemental'],['AWP','PAW']] },
                { id:'rarity-classified', name:'CLASSIFIED', price:6.00, color:'pink', img:'https://cdn.casehug.com/cases/RARITY_CLASSIFIED.png?width=640&quality=85', top:[['AK-47','Redline'],['M4A4','Hellfire']] },
                { id:'rarity-covert', name:'COVERT', price:13.00, color:'red', img:'https://cdn.casehug.com/cases/RARITY_COVERT.png?width=640&quality=85', top:[['AWP','Asiimov'],['AK-47','Bloodsport']] },

                { id:'wpn-p90', name:'P90', price:0.90, color:'blue', img:'https://cdn.casehug.com/cases/P90_2.png?width=640&quality=85', top:[['P90','Death by Kitty'],['P90','Asiimov']] },
                { id:'wpn-deagle', name:'DESERT EAGLE', price:1.50, color:'purple', img:'https://cdn.casehug.com/cases/DESERT_EAGLE.png?width=640&quality=85', top:[['Desert Eagle','Blaze'],['Desert Eagle','Printstream']] },
                { id:'wpn-usps', name:'USP-S', price:1.65, color:'purple', img:'https://cdn.casehug.com/cases/USP_S_2.png?width=640&quality=85', top:[['USP-S','Kill Confirmed'],['USP-S','Neo-Noir']] },
                { id:'wpn-m4a4', name:'M4A4', price:2.75, color:'purple', img:'https://cdn.casehug.com/cases/M4A4_2.png?width=640&quality=85', top:[['M4A4','Howl'],['M4A4','In Living Color']] },
                { id:'wpn-ak47', name:'AK-47', price:6.00, color:'pink', img:'https://cdn.casehug.com/cases/AK_47_3.png?width=640&quality=85', top:[['AK-47','Vulcan'],['AK-47','The Empress']] },
                { id:'wpn-awp', name:'AWP', price:10.00, color:'red', img:'https://cdn.casehug.com/cases/AWP.png?width=640&quality=85', top:[['AWP','Dragon Lore'],['AWP','Gungnir']] },

                { id:'knife-shadow-daggers', name:'SHADOW DAGGERS', price:62.50, color:'yellow-400', img:'https://cdn.casehug.com/cases/SHADOW_DAGGERS.png?width=640&quality=85', top:[['Shadow Daggers','Tiger Tooth'],['Shadow Daggers','Fade']] },
                { id:'gloves-guaranteed', name:'GLOVES', price:110.00, color:'yellow-400', img:'https://cdn.casehug.com/cases/GLOVES_2.png?width=640&quality=85', top:[['Sport Gloves','Vice'],['Specialist Gloves','Crimson Kimono']] },
                { id:'knife-guaranteed', name:'KNIFE', price:180.00, color:'yellow-400', img:'https://cdn.casehug.com/cases/KNIFE_2.png?width=640&quality=85', top:[['Karambit','Doppler Sapphire'],['Butterfly Knife','Fade']] },
                { id:'flip-knives-x', name:'FLIP KNIVES', price:200.00, color:'yellow-400', img:'https://cdn.casehug.com/cases/FLIP_KNIVES_2.png?width=640&quality=85', top:[['Flip Knife','Gamma Doppler Emerald'],['Flip Knife','Lore']] },

                { id:'gummy-love', name:'GUMMY LOVE', price:0.80, color:'pink', img:'https://cdn.casehug.com/cases/GUMMY_LOVE_2.png?width=640&quality=85', top:[['AWP','Wildfire'],['USP-S','Cortex']] },
                { id:'happy-cake', name:'HAPPY CAKE', price:2.50, color:'purple', img:'https://cdn.casehug.com/cases/HAPPY_CAKE_2.png?width=640&quality=85', top:[['Shadow Daggers','Gamma Doppler'],['Shadow Daggers','Lore']] },
                { id:'juice-20', name:'20 JUICE', price:150.00, color:'blue', img:'https://cdn.casehug.com/cases/20_JUICE.png?width=640&quality=85', top:[['Desert Eagle','Fennec Fox'],['M4A1-S','Bright Water']] },
                { id:'lucky-teddy', name:'LUCKY TEDDY', price:3.00, color:'purple', img:'https://cdn.casehug.com/cases/LUCKY_TEDDY_NEW.png?width=640&quality=85', top:[['P90','Death by Kitty'],['M4A4','ÈæçÁéã (Dragon King)']] },

                { id:'bombsite-b', name:'BOMSITE B', price:5.00, color:'red', img:'https://cdn.casehug.com/cases/bombsite_b_1.png?width=640&quality=85', top:[['M4A1-S','Hot Rod'],['M4A4','Hellfire']] },
                { id:'afk-trash', name:'AFK', price:0.10, color:'blue', img:'https://cdn.casehug.com/cases/AFK.png?width=640&quality=85', top:[['Shadow Daggers','Lore'],['P90','Emerald Dragon']] },
                { id:'gold-nova', name:'GOLD NOVA', price:1.00, color:'yellow-400', img:'https://cdn.casehug.com/cases/GOLD_NOVA.png?width=640&quality=85', top:[['AK-47','Bloodsport'],['AK-47','Legion of Anubis']] },

                { id:'printstream-only', name:'PRINTSTREAM', price:25.00, color:'red', img:'https://cdn.casehug.com/cases/PRINTSTREAM.png?width=640&quality=85', top:[['M4A1-S','Printstream'],['USP-S','Printstream']] },
                { id:'stattrak-case', name:'STATTRAK', price:8.00, color:'purple', img:'https://cdn.casehug.com/cases/STATTRAK_2.png?width=640&quality=85', top:[['AK-47','Bloodsport'],['M4A1-S','Printstream']] },

                { id:'ten-boombox', name:'10 BOOMBOX', price:10.00, color:'red', img:'https://cdn.casehug.com/cases/10_boombox.png?width=640&quality=85', top:[['Bowie Knife','Gamma Doppler'],['AK-47','Fuel Injector']] },
                { id:'fifty-race', name:'50 RACE', price:1250.00, color:'red', img:'https://cdn.casehug.com/cases/50_RACE.png?width=640&quality=85', top:[['M9 Bayonet','Gamma Doppler Emerald'],['M9 Bayonet','Gamma Doppler Black Pearl']] }
            ];

            const chanceProfiles = [
                [30, 25, 18, 14, 9, 4],
                [22, 24, 21, 16, 12, 5],
                [12, 20, 24, 22, 16, 6],
                [6, 14, 24, 24, 22, 10],
                [2.5, 7.5, 18, 27, 28, 17],
                [0.8, 3.2, 10, 22, 31, 33],
                [0.1, 1.9, 8, 20, 30, 40]
            ];

            const allSkins = Object.values(skinsDB);
            const seededIndex = (seed, len) => {
                if (!len) return 0;
                const str = String(seed || 'seed');
                let h = 2166136261;
                for (let i = 0; i < str.length; i += 1) {
                    h ^= str.charCodeAt(i);
                    h = Math.imul(h, 16777619);
                }
                return Math.abs(h) % len;
            };
            const pickRange = (minPrice, maxPrice, exclude = []) => {
                const pool = allSkins.filter(s => s.price >= minPrice && s.price <= maxPrice && !exclude.find(e => e.id === s.id));
                if(pool.length === 0) return null;
                return pool[Math.floor(Math.random() * pool.length)];
            };
            const pickRangeBySeed = (minPrice, maxPrice, exclude = [], seed = 'x') => {
                const pool = allSkins.filter(s => s.price >= minPrice && s.price <= maxPrice && !exclude.find(e => e.id === s.id));
                if(pool.length === 0) return null;
                return pool[seededIndex(seed, pool.length)];
            };
            const pickAny = (exclude = []) => {
                const pool = allSkins.filter(s => !exclude.find(e => e.id === s.id));
                if(pool.length === 0) return null;
                return pool[Math.floor(Math.random() * pool.length)];
            };
            const pickAnyBySeed = (exclude = [], seed = 'x') => {
                const pool = allSkins.filter(s => !exclude.find(e => e.id === s.id));
                if(pool.length === 0) return null;
                return pool[seededIndex(seed, pool.length)];
            };

            const hash = (str) => str.split('').reduce((a, ch) => ((a * 31) + ch.charCodeAt(0)) % 9973, 7);
            const normalizeProfile = (arr) => {
                const sum = arr.reduce((a,b)=>a+b,0);
                const scaled = arr.map(v => (v / sum) * 100);
                const rounded = scaled.map(v => Math.round(v * 10) / 10);
                const diff = Math.round((100 - rounded.reduce((a,b)=>a+b,0)) * 10) / 10;
                rounded[rounded.length - 1] = Math.round((rounded[rounded.length - 1] + diff) * 10) / 10;
                return rounded;
            };

            const chooseChancePattern = (caseObj, jackpotPrice) => {
                const ratio = jackpotPrice / Math.max(0.01, caseObj.price);
                let tier = 0;
                if(ratio >= 120) tier = 6;
                else if(ratio >= 50) tier = 5;
                else if(ratio >= 20) tier = 4;
                else if(ratio >= 10) tier = 3;
                else if(ratio >= 5) tier = 2;
                else if(ratio >= 2) tier = 1;
                const variability = hash(caseObj.id + caseObj.name) % 3;
                const idx = Math.max(0, Math.min(chanceProfiles.length - 1, tier - (variability === 0 ? 0 : (variability === 1 ? 1 : -1))));
                return normalizeProfile([...chanceProfiles[idx]]);
            };

            extraCases.forEach(ec => {
                if(casesDB.find(c => c.id === ec.id)) return;

                const price = ec.price;
                const top1 = findSkin(ec.top[0][0], ec.top[0][1]);
                const top2 = findSkin(ec.top[1][0], ec.top[1][1]);
                const picks = [];
                const used = [];

                const low1 = pickRangeBySeed(0.01, Math.max(0.05, price * 0.20), used, `${ec.id}-low1`) || pickAnyBySeed(used, `${ec.id}-any1`);
                if(low1) { picks.push(low1); used.push(low1); }

                const low2 = pickRangeBySeed(Math.max(0.02, price * 0.15), Math.max(0.15, price * 0.45), used, `${ec.id}-low2`) || pickAnyBySeed(used, `${ec.id}-any2`);
                if(low2) { picks.push(low2); used.push(low2); }

                const mid = pickRangeBySeed(Math.max(0.05, price * 0.40), Math.max(0.3, price * 0.95), used, `${ec.id}-mid`) || pickAnyBySeed(used, `${ec.id}-any3`);
                if(mid) { picks.push(mid); used.push(mid); }

                const hi = top2 && !used.find(x => x.id === top2.id)
                    ? top2
                    : (pickRangeBySeed(Math.max(0.2, price * 0.9), Math.max(1, price * 1.8), used, `${ec.id}-hi`) || pickAnyBySeed(used, `${ec.id}-any4`));
                if(hi) { picks.push(hi); used.push(hi); }

                const superHi = pickRangeBySeed(Math.max(0.5, price * 1.3), Math.max(2, price * 3.0), used, `${ec.id}-super`) || pickAnyBySeed(used, `${ec.id}-any5`);
                if(superHi) { picks.push(superHi); used.push(superHi); }

                const jackpot = top1 && !used.find(x => x.id === top1.id)
                    ? top1
                    : (pickRangeBySeed(Math.max(1, price * 2.0), Math.max(5, price * 20), used, `${ec.id}-jack`) || pickAnyBySeed(used, `${ec.id}-any6`));
                if(jackpot) { picks.push(jackpot); used.push(jackpot); }

                while(picks.length < 6) {
                    const extra = pickAnyBySeed(used, `${ec.id}-extra-${picks.length}`);
                    if(!extra) break;
                    picks.push(extra);
                    used.push(extra);
                }

                const sortedByPrice = picks.slice(0, 6).sort((a, b) => b.price - a.price);
                const chances = chooseChancePattern(ec, sortedByPrice[0]?.price || price);

                casesDB.push({
                    id: ec.id,
                    name: ec.name,
                    price: ec.price,
                    color: ec.color,
                    img: ec.img,
                    contents: sortedByPrice.map((skin, idx) => ({ skin, chance: chances[idx] || 0.1 }))
                });
            });

            // Manual tailored loadouts for newly added cases (no generic generator output)
            const manualCaseIds = new Set();
            const setManualCaseContents = (caseId, rows) => {
                const c = casesDB.find((x) => x.id === caseId);
                if (!c || !Array.isArray(rows) || !rows.length) return;
                const parsed = rows
                    .map(([w, n, ch]) => ({ skin: findSkin(w, n), chance: Number(ch || 0) }))
                    .filter((x) => x.skin && x.chance > 0);
                if (!parsed.length) return;
                const total = parsed.reduce((a, b) => a + b.chance, 0);
                const scaled = parsed.map((x) => ({ ...x, chance: (x.chance / total) * 100 }));
                const rounded = scaled.map((x) => ({ ...x, chance: Math.round(x.chance * 100000) / 100000 }));
                const diff = Math.round((100 - rounded.reduce((a, b) => a + b.chance, 0)) * 100000) / 100000;
                rounded[rounded.length - 1].chance = Math.max(0.00001, Math.round((rounded[rounded.length - 1].chance + diff) * 100000) / 100000);
                c.contents = rounded;
                manualCaseIds.add(caseId);
            };

            setManualCaseContents('rarity-milspec', [
                ['MP7','Asterion',20],['Galil AR','Rocket Pop',16],['M249','Spectre',15],['P90','Traction',14],['UMP-45','Scaffold',10],['PP-Bizon','Embargo',9],['MP9','Capillary',8],['M4A1-S','Night Terror',5],['AWP','PAW',2],['AK-47','Slate',1]
            ]);
            setManualCaseContents('rarity-restricted', [
                ['Glock-18','Water Elemental',18],['MAC-10','Fade',15],['USP-S','Cortex',14],['M4A4','Tooth Fairy',12],['AK-47','Ice Coaled',10],['P90','Shapewood',10],['AWP','PAW',8],['M4A1-S','Nightmare',7],['AK-47','Redline',4],['AWP','Neo-Noir',2]
            ]);
            setManualCaseContents('rarity-classified', [
                ['AK-47','Redline',17],['M4A4','Hellfire',15],['AWP','Pink DDPAT',12],['USP-S','Neo-Noir',12],['M4A1-S','Player Two',10],['AK-47','The Empress',9],['Desert Eagle','Printstream',8],['AWP','Wildfire',7],['M4A4','Temukau',6],['AK-47','Bloodsport',4]
            ]);
            setManualCaseContents('rarity-covert', [
                ['M4A4','Neo-Noir',16],['AK-47','Bloodsport',15],['AWP','Asiimov',13],['M4A1-S','Printstream',12],['AK-47','Vulcan',10],['Desert Eagle','Blaze',9],['AWP','Wildfire',8],['M4A4','The Emperor',7],['Flip Knife','Rust Coat',6],['Karambit','Doppler Phase 1',4]
            ]);

            setManualCaseContents('wpn-p90', [
                ['P90','Traction',22],['P90','Grim',20],['P90','Shapewood',16],['P90','Nostalgia',12],['P90','Asiimov',10],['P90','Death by Kitty',6],['P90','Cold Blooded',5],['P90','Blind Spot',4],['P90','Emerald Dragon',3],['P90','Trigon',2]
            ]);
            setManualCaseContents('wpn-deagle', [
                ['Desert Eagle','Conspiracy',22],['Desert Eagle','Mecha Industries',18],['Desert Eagle','Kumicho Dragon',14],['Desert Eagle','Naga',12],['Desert Eagle','Code Red',9],['Desert Eagle','Printstream',8],['Desert Eagle','Ocean Drive',6],['Desert Eagle','Golden Koi',5],['Desert Eagle','Blaze',4],['Desert Eagle','Emerald J√∂rmungandr',2]
            ]);
            setManualCaseContents('wpn-usps', [
                ['USP-S','Blueprint',19],['USP-S','Cortex',18],['USP-S','Cyrex',14],['USP-S','Ticket to Hell',12],['USP-S','Flashback',11],['USP-S','The Traitor',8],['USP-S','Neo-Noir',7],['USP-S','Printstream',5],['USP-S','Kill Confirmed',4],['USP-S','Orion',2]
            ]);
            setManualCaseContents('wpn-m4a4', [
                ['M4A4','Spider Lily',17],['M4A4','Tooth Fairy',15],['M4A4','In Living Color',13],['M4A4','Desolate Space',12],['M4A4','Neo-Noir',10],['M4A4','Hellfire',10],['M4A4','Temukau',8],['M4A4','The Emperor',7],['M4A4','ÈæçÁéã (Dragon King)',5],['M4A4','Howl',3]
            ]);
            setManualCaseContents('wpn-ak47', [
                ['AK-47','Slate',20],['AK-47','Ice Coaled',17],['AK-47','Phantom Disruptor',14],['AK-47','Legion of Anubis',10],['AK-47','Head Shot',10],['AK-47','Redline',9],['AK-47','Neon Rider',7],['AK-47','The Empress',6],['AK-47','Vulcan',5],['AK-47','Bloodsport',2]
            ]);
            setManualCaseContents('wpn-awp', [
                ['AWP','Atheris',20],['AWP','Exoskeleton',18],['AWP','Mortis',16],['AWP','PAW',12],['AWP','Pink DDPAT',10],['AWP','Neo-Noir',8],['AWP','Wildfire',6],['AWP','Asiimov',5],['AWP','Oni Taiji',3],['AWP','Dragon Lore',2]
            ]);

            setManualCaseContents('knife-shadow-daggers', [
                ['Shadow Daggers','Safari Mesh',18],['Shadow Daggers','Boreal Forest',16],['Shadow Daggers','Scorched',14],['Shadow Daggers','Urban Masked',13],['Shadow Daggers','Stained',11],['Shadow Daggers','Blue Steel',9],['Shadow Daggers','Crimson Web',7],['Shadow Daggers','Tiger Tooth',6],['Shadow Daggers','Fade',4],['Shadow Daggers','Doppler Sapphire',2]
            ]);
            setManualCaseContents('gloves-guaranteed', [
                ['Driver Gloves','Racing Green',18],['Driver Gloves','Convoy',14],['Moto Gloves','Transport',13],['Moto Gloves','Smoke Out',12],['Hand Wraps','Duct Tape',10],['Hydra Gloves','Mangrove',9],['Broken Fang Gloves','Needle Point',8],['Specialist Gloves','Field Agent',7],['Sport Gloves','Nocts',5],['Sport Gloves','Vice',4]
            ]);
            setManualCaseContents('knife-guaranteed', [
                ['Navaja Knife','Rust Coat',16],['Gut Knife','Safari Mesh',14],['Ursus Knife','Scorched',13],['Paracord Knife','Blue Steel',12],['Nomad Knife','Stained',10],['Flip Knife','Case Hardened',9],['M9 Bayonet','Tiger Tooth',8],['Karambit','Doppler Phase 2',7],['Butterfly Knife','Fade',6],['Karambit','Doppler Sapphire',5]
            ]);
            setManualCaseContents('flip-knives-x', [
                ['Flip Knife','Rust Coat',20],['Flip Knife','Stained',16],['Flip Knife','Blue Steel',14],['Flip Knife','Case Hardened',12],['Flip Knife','Crimson Web',10],['Flip Knife','Tiger Tooth',9],['Flip Knife','Doppler Phase 4',7],['Flip Knife','Lore',6],['Flip Knife','Gamma Doppler',4],['Flip Knife','Gamma Doppler Emerald',2]
            ]);

            setManualCaseContents('candy-shop', [
                ['Glock-18','Snack Attack',17],['Five-SeveN','Monkey Business',15],['MAC-10','Disco Tech',14],['MP9','Mount Fuji',10],['AK-47','Neon Rider',10],['M4A1-S','Player Two',8],['USP-S','Neo-Noir',8],['AUG','Akihabara Accept',6],['Desert Eagle','Printstream',7],['AWP','Oni Taiji',5]
            ]);
            setManualCaseContents('gummy-love', [
                ['USP-S','Cortex',19],['CZ75-Auto','Xiangliu',16],['M4A4','Temukau',14],['MP9','Mount Fuji',12],['Glock-18','Water Elemental',10],['M4A1-S','Nightmare',8],['AWP','Pink DDPAT',7],['AK-47','Neon Rider',6],['USP-S','Neo-Noir',5],['AWP','Neo-Noir',3]
            ]);
            setManualCaseContents('happy-cake', [
                ['Negev','Power Loader',18],['P250','See Ya Later',16],['M4A1-S','Player Two',14],['Desert Eagle','Mecha Industries',12],['AK-47','The Empress',10],['M4A4','In Living Color',9],['USP-S','The Traitor',8],['AWP','Wildfire',6],['Desert Eagle','Blaze',4],['M4A4','Howl',3]
            ]);
            setManualCaseContents('juice-20', [
                ['Glock-18','Water Elemental',20],['USP-S','Blueprint',16],['M4A1-S','Bright Water',12],['AK-47','Aquamarine Revenge',10],['P90','Cold Blooded',8],['M4A4','Poseidon',6],['AWP','Lightning Strike',5],['Desert Eagle','Code Red',4],['AK-47','Fuel Injector',4],['Desert Eagle','Fennec Fox',15]
            ]);
            setManualCaseContents('lucky-teddy', [
                ['AUG','Chameleon',17],['P90','Death by Kitty',16],['M4A4','ÈæçÁéã (Dragon King)',14],['USP-S','Cortex',12],['AK-47','Neon Rider',11],['M4A1-S','Player Two',9],['AWP','Neo-Noir',8],['Five-SeveN','Monkey Business',6],['M4A4','Temukau',4],['AWP','Oni Taiji',3]
            ]);
            setManualCaseContents('vac-attack', [
                ['AK-47','Head Shot',17],['M4A4','Griffin',15],['USP-S','Cyrex',13],['AWP','Neo-Noir',11],['M4A4','Hellfire',10],['AK-47','Bloodsport',9],['M4A4','The Emperor',8],['M4A1-S','Printstream',7],['M4A4','Howl',6],['AWP','Dragon Lore',4]
            ]);
            setManualCaseContents('bunny-hop', [
                ['SSG 08','Rapid Transit',20],['MP9','Mount Fuji',15],['P90','Traction',14],['MAC-10','Disco Tech',12],['Tec-9','Fuel Injector',10],['AK-47','Head Shot',8],['M4A4','Temukau',6],['AWP','Neo-Noir',5],['Bowie Knife','Ultraviolet',4],['Bowie Knife','Gamma Doppler',6]
            ]);
            setManualCaseContents('bombsite-b', [
                ['P90','Asiimov',16],['Tec-9','Fuel Injector',15],['MAC-10','Neon Rider',14],['P90','Death by Kitty',12],['UMP-45','Primal Saber',10],['Desert Eagle','Code Red',8],['M4A4','Hellfire',8],['AK-47','Head Shot',7],['AWP','Wildfire',6],['AK-47','Bloodsport',4]
            ]);
            setManualCaseContents('afk-trash', [
                ['P250','Sand Dune',23],['G3SG1','Safari Mesh',20],['XM1014','Blue Spruce',14],['MAC-10','Palm',11],['PP-Bizon','Sand Dashed',9],['P90','Sand Spray',7],['UMP-45','Scorched',6],['MP7','Armor Core',4],['P90','Emerald Dragon',4],['Shadow Daggers','Lore',2]
            ]);
            setManualCaseContents('gold-nova', [
                ['AK-47','Legion of Anubis',16],['M4A4','The Emperor',15],['USP-S','The Traitor',13],['P250','See Ya Later',12],['AUG','Chameleon',11],['Desert Eagle','Mecha Industries',10],['M4A1-S','Icarus Fell',8],['AWP','Corticera',7],['AK-47','The Empress',5],['Desert Eagle','Blaze',3]
            ]);

            setManualCaseContents('printstream-only', [
                ['Desert Eagle','Printstream',42],['USP-S','Printstream',36],['M4A1-S','Printstream',22]
            ]);
            setManualCaseContents('stattrak-case', [
                ['AK-47','Bloodsport',16],['M4A1-S','Printstream',14],['USP-S','Neo-Noir',13],['Desert Eagle','Printstream',12],['AWP','Neo-Noir',11],['M4A4','The Emperor',10],['AK-47','The Empress',9],['AWP','Asiimov',8],['M4A4','Howl',5],['Karambit','Tiger Tooth',2]
            ]);
            setManualCaseContents('titan', [
                ['AWP','PAW',20],['AWP','Atheris',16],['AK-47','Slate',14],['M4A4','Tooth Fairy',12],['AWP','Neo-Noir',10],['AK-47','Redline',8],['M4A1-S','Nightmare',7],['AWP','Asiimov',6],['AWP','Wildfire',4],['AWP','Medusa',3]
            ]);
            setManualCaseContents('ten-boombox', [
                ['P250','Sand Dune',41],['PP-Bizon','Sand Dashed',21],['MP7','Armor Core',13],['MAC-10','Palm',10],['Bowie Knife','Ultraviolet',5],['AK-47','Fuel Injector',4],['Desert Eagle','Blaze',3],['Bowie Knife','Gamma Doppler',3]
            ]);
            setManualCaseContents('fifty-race', [
                ['M4A1-S','Printstream',32],['AK-47','Bloodsport',24],['M9 Bayonet','Doppler Phase 2',18],['Karambit','Fade',14],['M9 Bayonet','Gamma Doppler Emerald',12]
            ]);

            // Image-driven tuning for specific showcased case artworks
            setManualCaseContents('electronic', [
                ['MAC-10','Disco Tech',18],['UMP-45','Scaffold',15],['P90','Traction',13],['USP-S','Blueprint',11],['AK-47','Head Shot',10],['M4A4','In Living Color',9],['M4A1-S','Icarus Fell',8],['M9 Bayonet','Autotronic',6],['Karambit','Doppler Phase 3',6],['Butterfly Knife','Doppler Sapphire',4]
            ]);
            setManualCaseContents('alien', [
                ['AK-47','Ice Coaled',20],['M4A4','Temukau',16],['AWP','PAW',13],['USP-S','Cyrex',12],['Glock-18','Water Elemental',11],['AK-47','Neon Rider',9],['M4A1-S','Printstream',7],['AWP','Neo-Noir',6],['AK-47','Vulcan',4],['AWP','Dragon Lore',2]
            ]);
            setManualCaseContents('lab', [
                ['Flip Knife','Damascus Steel',17],['Flip Knife','Case Hardened',15],['Butterfly Knife','Blue Steel',12],['Karambit','Damascus Steel',11],['M9 Bayonet','Tiger Tooth',10],['Flip Knife','Tiger Tooth',9],['Flip Knife','Lore',8],['Karambit','Doppler Phase 2',7],['Flip Knife','Gamma Doppler',6],['Specialist Gloves','Emerald Web',5]
            ]);
            setManualCaseContents('el-dorado', [
                ['AK-47','Gold Arabesque',22],['Desert Eagle','Blaze',18],['M4A1-S','Icarus Fell',13],['AK-47','The Empress',12],['USP-S','The Traitor',10],['M4A4','The Emperor',9],['AWP','Wildfire',7],['M9 Bayonet','Lore',5],['Karambit','Lore',3],['Sport Gloves','Omega',1]
            ]);
            setManualCaseContents('arcana', [
                ['M9 Bayonet','Doppler Phase 4',16],['Karambit','Doppler Phase 2',15],['Butterfly Knife','Fade',13],['Talon Knife','Fade',11],['Skeleton Knife','Tiger Tooth',10],['Karambit','Tiger Tooth',9],['M9 Bayonet','Lore',8],['Karambit','Lore',7],['Sport Gloves','Vice',6],['Sport Gloves','Pandora\'s Box',5]
            ]);
            setManualCaseContents('babushka', [
                ['M9 Bayonet','Doppler Phase 1',18],['Bayonet','Doppler Phase 2',16],['Stiletto Knife','Doppler Phase 3',13],['Falchion Knife','Doppler Phase 4',11],['M9 Bayonet','Case Hardened',10],['Bayonet','Blue Steel',9],['M9 Bayonet','Tiger Tooth',8],['Karambit','Doppler Phase 1',7],['M9 Bayonet','Doppler Ruby',5],['M9 Bayonet','Doppler Sapphire',3]
            ]);
            setManualCaseContents('bank-heist', [
                ['AK-47','Case Hardened',18],['AK-47','The Empress',15],['AK-47','Leet Museo',14],['AK-47','Vulcan',12],['M4A4','The Emperor',10],['Desert Eagle','Printstream',9],['AWP','Asiimov',8],['M4A1-S','Printstream',7],['AK-47','Bloodsport',5],['AWP','Dragon Lore',2]
            ]);
            setManualCaseContents('gloves-guaranteed', [
                ['Moto Gloves','Blood Pressure',18],['Moto Gloves','Finish Line',14],['Driver Gloves','Rezan the Red',13],['Specialist Gloves','Crimson Web',12],['Hand Wraps','Slaughter',10],['Specialist Gloves','Foundation',9],['Driver Gloves','Crimson Weave',8],['Sport Gloves','Scarlet Shamagh',7],['Sport Gloves','Slingshot',5],['Sport Gloves','Vice',4]
            ]);
            setManualCaseContents('wpn-deagle', [
                ['Desert Eagle','Mecha Industries',20],['Desert Eagle','Conspiracy',18],['Desert Eagle','Code Red',15],['Desert Eagle','Ocean Drive',12],['Desert Eagle','Kumicho Dragon',10],['Desert Eagle','Printstream',9],['Desert Eagle','Golden Koi',7],['Desert Eagle','Blaze',5],['Desert Eagle','Emerald J√∂rmungandr',3],['Desert Eagle','Fennec Fox',1]
            ]);
            setManualCaseContents('rarity-covert', [
                ['AK-47','Bloodsport',16],['M4A4','Neo-Noir',15],['M4A4','Hellfire',12],['AWP','Asiimov',11],['M4A1-S','Printstream',10],['AK-47','Head Shot',9],['Flip Knife','Crimson Web',8],['Karambit','Crimson Web',7],['Bayonet','Crimson Web',6],['M9 Bayonet','Crimson Web',6]
            ]);

            // Full tailored pass: manually define all remaining CaseHug-inspired cases
            setManualCaseContents('neon-flora', [
                ['AK-47','Nightwish',0.003],
                ['USP-S','Jawbreaker',0.025],
                ['M4A4','Tooth Fairy',0.033],
                ['M4A1-S','Glitched Paint',0.067],
                ['USP-S','Bleeding Edge',0.111],
                ['MP9','Ruby Poison Dart',0.112],
                ['USP-S','Ticket to Hell',0.453],
                ['Glock-18','Moonrise',0.366],
                ['UMP-45','Moonrise',0.546],
                ['MP5-SD','Kitbash',0.596],
                ['SG 553','Dragon Tech',0.75],
                ['P90','Vent Rush',0.687],
                ['P2000','Acid Etched',0.597],
                ['Glock-18','Block-18',0.72],
                ['M4A1-S','Nitro',2.639],
                ['Dual Berettas','Cobalt Quartz',1.981],
                ['M4A1-S','Rose Hex',3.076],
                ['Desert Eagle','Bronze Deco',1.956],
                ['Galil AR','NV',2.538],
                ['M249','Spectrogram',2.6],
                ['Desert Eagle','Calligraffiti',2.512],
                ['MAC-10','Light Box',2.333],
                ['R8 Revolver','Crimson Web',2.375],
                ['MP5-SD','Statics',2.678],
                ['UMP-45','Motorized',11.912],
                ['Dual Berettas','Hideout',12.357],
                ['Glock-18','High Beam',6.614],
                ['P2000','Red Wing',7.371],
                ['M4A4','Choppa',7.393],
                ['Dual Berettas','BorDeux',24.599]
            ]);
            setManualCaseContents('organic', [
                ['MP7','Asterion',28],['USP-S','Cortex',21],['AK-47','Slate',18],['M4A1-S','Night Terror',14],['P90','Traction',10],['M4A1-S','Player Two',9]
            ]);
            setManualCaseContents('candy-drop', [
                ['MAC-10','Candy Apple',26],['Glock-18','Water Elemental',20],['USP-S','Cortex',16],['M4A1-S','Mecha Industries',14],['M4A4','Temukau',12],['AK-47','Neon Rider',8],['Desert Eagle','Printstream',4]
            ]);
            setManualCaseContents('double-cheese', [
                ['P250','Sand Dune',30],['MAC-10','Palm',24],['PP-Bizon','Sand Dashed',18],['UMP-45','Scorched',12],['AK-47','Slate',9],['AK-47','Bloodsport',7]
            ]);
            setManualCaseContents('ritual', [
                ['USP-S','Ticket to Hell',24],['M4A1-S','Night Terror',18],['AWP','PAW',16],['AK-47','Redline',13],['M4A4','Tooth Fairy',11],['Survival Knife','Case Hardened',8],['Karambit','Case Hardened',6],['M9 Bayonet','Case Hardened',4]
            ]);
            setManualCaseContents('hellfire', [
                ['M4A4','Hellfire',28],['M4A4','Tooth Fairy',21],['AK-47','Head Shot',17],['USP-S','Cyrex',14],['AWP','Atheris',10],['M4A4','The Emperor',7],['M4A4','Howl',3]
            ]);
            setManualCaseContents('frosty', [
                ['AK-47','Slate',26],['USP-S','Blueprint',22],['M4A1-S','Night Terror',18],['AWP','PAW',13],['AK-47','Ice Coaled',12],['AWP','Neo-Noir',6],['AK-47','Vulcan',3]
            ]);
            setManualCaseContents('sweet-tooth', [
                ['Five-SeveN','Monkey Business',22],['MAC-10','Disco Tech',18],['P90','Shapewood',15],['AK-47','Neon Rider',14],['Desert Eagle','Printstream',11],['Karambit','Tiger Tooth',8],['M9 Bayonet','Tiger Tooth',7],['Butterfly Knife','Tiger Tooth',5]
            ]);
            setManualCaseContents('duck-luck', [
                ['P250','Sand Dune',25],['PP-Bizon','Sand Dashed',20],['MP7','Armor Core',16],['MAC-10','Palm',13],['UMP-45','Scorched',10],['P90','Sand Spray',8],['Shadow Daggers','Lore',6],['AWP','Atheris',2]
            ]);
            setManualCaseContents('savanna', [
                ['FAMAS','Afterimage',22],['AK-47','Point Disarray',19],['USP-S','Cyrex',16],['M4A1-S','Nightmare',14],['M4A1-S','Chantico\'s Fire',12],['Desert Eagle','Conspiracy',10],['M4A1-S','Icarus Fell',7]
            ]);
            setManualCaseContents('wild-west', [
                ['R8 Revolver','Fade',25],['Desert Eagle','Conspiracy',19],['AK-47','Redline',16],['USP-S','Cortex',13],['M4A4','Griffin',11],['Karambit','Lore',8],['M9 Bayonet','Lore',5],['AWP','Wildfire',3]
            ]);
            setManualCaseContents('insector', [
                ['P90','Traction',24],['UMP-45','Scaffold',18],['USP-S','Blueprint',16],['AK-47','Head Shot',13],['M4A4','Temukau',11],['Flip Knife','Autotronic',10],['Karambit','Autotronic',8]
            ]);
            setManualCaseContents('toxic', [
                ['MP9','Capillary',23],['MAC-10','Neon Rider',18],['USP-S','Cortex',16],['M4A4','Desolate Space',14],['AK-47','Neon Rider',12],['AWP','Atheris',9],['AWP','Containment Breach',8]
            ]);
            setManualCaseContents('workshop', [
                ['Glock-18','Catacombs',26],['USP-S','Ticket to Hell',20],['M4A4','Tooth Fairy',16],['AK-47','Slate',13],['AWP','PAW',11],['M9 Bayonet','Lore',9],['Karambit','Lore',5]
            ]);
            setManualCaseContents('game-on', [
                ['Glock-18','Water Elemental',24],['Glock-18','Neo-Noir',18],['USP-S','Cortex',14],['M4A4','Temukau',13],['AK-47','Neon Rider',11],['Glock-18','Gamma Doppler',10],['M9 Bayonet','Gamma Doppler',6],['Karambit','Gamma Doppler Emerald',4]
            ]);
            setManualCaseContents('retro', [
                ['P250','See Ya Later',21],['USP-S','Neo-Noir',17],['M4A4','Desolate Space',16],['AK-47','Redline',13],['M4A1-S','Player Two',11],['M9 Bayonet','Lore',10],['Karambit','Lore',7],['AWP','Asiimov',5]
            ]);
            setManualCaseContents('gambit', [
                ['AK-47','Slate',22],['M4A4','Tooth Fairy',18],['USP-S','Blueprint',14],['AWP','Atheris',13],['Stiletto Knife','Ultraviolet',11],['Stiletto Knife','Tiger Tooth',10],['Karambit','Tiger Tooth',7],['Butterfly Knife','Tiger Tooth',5]
            ]);
            setManualCaseContents('savage', [
                ['AK-47','Head Shot',18],['M4A4','The Emperor',15],['Desert Eagle','Blaze',13],['AWP','Wildfire',11],['AK-47','Bloodsport',10],['Karambit','Tiger Tooth',9],['M9 Bayonet','Tiger Tooth',8],['AK-47','Gold Arabesque',6],['AWP','Dragon Lore',4],['Sport Gloves','Vice',2]
            ]);
            setManualCaseContents('golderra', [
                ['USP-S','The Traitor',18],['Desert Eagle','Blaze',14],['AK-47','The Empress',13],['M4A1-S','Icarus Fell',12],['M9 Bayonet','Lore',10],['Karambit','Lore',9],['Sport Gloves','Amphibious',8],['Sport Gloves','Slingshot',7],['Sport Gloves','Vice',5],['AWP','Gungnir',4]
            ]);
            setManualCaseContents('ferro', [
                ['AK-47','Bloodsport',17],['M4A4','Temukau',14],['M4A1-S','Blue Phosphor',12],['Desert Eagle','Blaze',11],['AWP','Wildfire',10],['Butterfly Knife','Tiger Tooth',9],['Karambit','Tiger Tooth',8],['M9 Bayonet','Tiger Tooth',7],['Sport Gloves','Omega',6],['AWP','Dragon Lore',6]
            ]);
            setManualCaseContents('plant-b', [
                ['UMP-45','Primal Saber',18],['MAC-10','Neon Rider',16],['P90','Asiimov',14],['M4A4','Hellfire',13],['AK-47','Head Shot',11],['M4A1-S','Hot Rod',9],['AWP','Asiimov',8],['AK-47','Bloodsport',6],['M4A4','Howl',3],['AWP','Dragon Lore',2]
            ]);
            setManualCaseContents('buzzer-blade', [
                ['USP-S','Blueprint',16],['AK-47','Head Shot',14],['M4A4','In Living Color',12],['M4A1-S','Icarus Fell',11],['M9 Bayonet','Autotronic',10],['Karambit','Doppler Phase 3',9],['M9 Bayonet','Gamma Doppler',8],['Karambit','Gamma Doppler Emerald',7],['Butterfly Knife','Gamma Doppler Emerald',7],['AWP','Gungnir',6]
            ]);
            setManualCaseContents('kingdom', [
                ['AK-47','The Empress',18],['M4A4','The Emperor',15],['USP-S','The Traitor',13],['M4A1-S','Printstream',11],['AWP','Asiimov',10],['M9 Bayonet','Lore',9],['Karambit','Lore',8],['Butterfly Knife','Gamma Doppler',7],['Butterfly Knife','Gamma Doppler Emerald',6],['AWP','Dragon Lore',3]
            ]);
            setManualCaseContents('sushi-master', [
                ['Five-SeveN','Monkey Business',20],['M4A4','Temukau',16],['USP-S','Neo-Noir',14],['AK-47','Neon Rider',13],['Desert Eagle','Printstream',11],['Karambit','Autotronic',9],['M9 Bayonet','Autotronic',7],['Karambit','Fade',6],['M9 Bayonet','Marble Fade',4]
            ]);
            setManualCaseContents('warzone', [
                ['AK-47','Bloodsport',16],['M4A4','The Emperor',13],['AWP','Wildfire',11],['M4A1-S','Printstream',10],['M9 Bayonet','Autotronic',10],['Karambit','Autotronic',9],['Butterfly Knife','Autotronic',8],['Sport Gloves','Slingshot',7],['AWP','Dragon Lore',6],['AWP','Gungnir',10]
            ]);
            setManualCaseContents('circus', [
                ['Glock-18','Water Elemental',18],['USP-S','Neo-Noir',15],['AK-47','Neon Rider',13],['M4A4','In Living Color',11],['Desert Eagle','Printstream',9],['M9 Bayonet','Tiger Tooth',8],['Karambit','Tiger Tooth',7],['M9 Bayonet','Marble Fade',7],['Butterfly Knife','Marble Fade',6],['AWP','Dragon Lore',6]
            ]);
            setManualCaseContents('chinatown', [
                ['AK-47','Case Hardened',15],['M4A1-S','Blue Phosphor',13],['USP-S','Printstream',11],['Desert Eagle','Blaze',10],['M9 Bayonet','Doppler Phase 2',9],['Karambit','Doppler Phase 4',8],['Specialist Gloves','Crimson Kimono',8],['Sport Gloves','Vice',7],['AWP','Gungnir',6],['AWP','Dragon Lore',13]
            ]);
            setManualCaseContents('quantum', [
                ['M4A1-S','Printstream',20],['AK-47','Gold Arabesque',16],['M4A4','Howl',13],['Karambit','Fade',11],['Butterfly Knife','Fade',9],['M9 Bayonet','Gamma Doppler',8],['Sport Gloves','Vice',7],['Sport Gloves','Pandora\'s Box',6],['AWP','Dragon Lore',5],['AWP','Gungnir',5]
            ]);
            setManualCaseContents('tiger', [
                ['P250','Sand Dune',22],['USP-S','Ticket to Hell',18],['AK-47','Slate',14],['M4A4','Tooth Fairy',12],['M9 Bayonet','Tiger Tooth',10],['Karambit','Tiger Tooth',9],['Butterfly Knife','Tiger Tooth',8],['AWP','Asiimov',7]
            ]);
            setManualCaseContents('demolition', [
                ['Glock-18','Water Elemental',20],['AK-47','Redline',16],['M4A4','Desolate Space',14],['M4A1-S','Player Two',12],['AWP','Asiimov',10],['AWP','Wildfire',9],['AWP','The Prince',8],['AWP','Dragon Lore',6],['AWP','Gungnir',5]
            ]);
            setManualCaseContents('howl-case', [
                ['M4A4','Hellfire',18],['M4A4','The Emperor',15],['AK-47','Bloodsport',13],['M4A1-S','Printstream',11],['AWP','Wildfire',9],['M9 Bayonet','Lore',7],['Karambit','Lore',6],['Sport Gloves','Vice',6],['AK-47','Wild Lotus',5],['M4A4','Howl',10]
            ]);

            const enforceExtraCaseTopDrops = () => {
                extraCases.forEach((ec) => {
                    const c = casesDB.find((x) => x.id === ec.id);
                    if (!c || !Array.isArray(c.contents) || !c.contents.length) return;
                    const tops = (ec.top || []).map(([w, n]) => findSkin(w, n)).filter(Boolean);
                    if (!tops.length) return;

                    tops.forEach((skin, idx) => {
                        let row = c.contents.find((it) => it.skin?.id === skin.id);
                        if (!row) {
                            row = { skin, chance: 0.00001 };
                            c.contents.push(row);
                        }
                        // Keep jackpot odds very low but guaranteed present.
                        row.chance = idx === 0 ? 0.00001 : 0.00002;
                    });

                    const sum = c.contents.reduce((a, b) => a + Number(b.chance || 0), 0);
                    const diff = Math.round((100 - sum) * 100000) / 100000;
                    const receiver = c.contents
                        .filter((it) => !tops.find((t) => t.id === it.skin?.id))
                        .sort((a, b) => Number(a.chance || 0) - Number(b.chance || 0))[0]
                        || c.contents[0];
                    receiver.chance = Math.max(0.00001, Math.round((Number(receiver.chance || 0) + diff) * 100000) / 100000);
                    c.contents = c.contents
                        .map((it) => ({ ...it, chance: Math.max(0.00001, Number(it.chance || 0)) }))
                        .sort((a, b) => Number(a.skin?.price || 0) - Number(b.skin?.price || 0));
                });
            };

            enforceExtraCaseTopDrops();

            const MANUAL_CASE_TOP_DROP = {
                'neon-flora': [['AK-47','Nightwish']],
                'organic': [['M4A1-S','Player Two']],
                'candy-drop': [['M4A1-S','Mecha Industries']],
                'double-cheese': [['AK-47','Bloodsport']],
                'ritual': [['Survival Knife','Case Hardened']],
                'hellfire': [['M4A4','Hellfire']],
                'duck-luck': [['Shadow Daggers','Lore']],
                'alien': [['AK-47','Vulcan']],
                'savanna': [['M4A1-S','Chantico\'s Fire']],
                'insector': [['Flip Knife','Autotronic']],
                'toxic': [['AWP','Containment Breach']],
                'workshop': [['M9 Bayonet','Lore']],
                'game-on': [['Glock-18','Gamma Doppler']],
                'bank-heist': [['AK-47','The Empress']],
                'bunny-hop': [['Bowie Knife','Gamma Doppler']],
                'titan': [['AWP','Medusa']],
                'gambit': [['Stiletto Knife','Tiger Tooth']],
                'savage': [['Karambit','Tiger Tooth']],
                'golderra': [['Sport Gloves','Amphibious']],
                'ferro': [['Butterfly Knife','Tiger Tooth']],
                'buzzer-blade': [['M9 Bayonet','Gamma Doppler']],
                'candy-shop': [['Skeleton Knife','Marble Fade']],
                'kingdom': [['Butterfly Knife','Gamma Doppler']],
                'warzone': [['M9 Bayonet','Autotronic']],
                'circus': [['M9 Bayonet','Marble Fade']],
                'chinatown': [['Specialist Gloves','Crimson Kimono']],
                'arcana': [['Butterfly Knife','Gamma Doppler']],
                'babushka': [['M9 Bayonet','Gamma Doppler Emerald']],
                'quantum': [['AWP','Gungnir']],
                'demolition': [['AWP','The Prince']],
                'electronic': [['M9 Bayonet','Autotronic']],
                'lab': [['Specialist Gloves','Emerald Web']],
                'howl-case': [['M4A4','Howl']],
                'juice-20': [['Desert Eagle','Fennec Fox']],
                'afk-trash': [['Shadow Daggers','Lore'], ['P90','Emerald Dragon']],
                'ten-boombox': [['Bowie Knife','Gamma Doppler']],
                'fifty-race': [['M9 Bayonet','Gamma Doppler']],
                'wpn-p90': [['P90','Death by Kitty']],
                'wpn-deagle': [['Desert Eagle','Fennec Fox']],
                'wpn-usps': [['USP-S','Kill Confirmed']],
                'wpn-m4a4': [['M4A4','Howl']],
                'wpn-ak47': [['AK-47','Fuel Injector']],
                'wpn-awp': [['AWP','Gungnir']]
            };
            const WEAPON_ONLY_CASES = {
                'wpn-p90': 'P90',
                'wpn-deagle': 'Desert Eagle',
                'wpn-usps': 'USP-S',
                'wpn-m4a4': 'M4A4',
                'wpn-ak47': 'AK-47',
                'wpn-awp': 'AWP'
            };

            const harmonizeManualCaseContents = () => {
                const seeded = (seed) => {
                    const str = String(seed || 'x');
                    return str.split('').reduce((a, ch) => (a * 131 + ch.charCodeAt(0)) % 1000003, 17);
                };
                const pickDeterministic = (arr, seed, used = new Set()) => {
                    const pool = (arr || []).filter((x) => x && !used.has(x.id));
                    if (!pool.length) return null;
                    const idx = seeded(seed) % pool.length;
                    return pool[idx];
                };
                const targetCountForCase = (c) => {
                    const p = Number(c.price || 0);
                    const roll = seeded(`${c.id}-count`) % 9;
                    if (p <= 1) return 18 + roll;     // 18-26
                    if (p <= 5) return 14 + roll;     // 14-22
                    if (p <= 20) return 12 + roll;    // 12-20
                    if (p <= 100) return 10 + roll;   // 10-18
                    return 8 + (roll % 6);            // 8-13
                };
                const topChanceForCase = (c) => {
                    const p = Number(c.price || 0);
                    if (p <= 1) return 0.03;
                    if (p <= 5) return 0.05;
                    if (p <= 20) return 0.08;
                    if (p <= 100) return 0.12;
                    return 0.2;
                };
                casesDB.forEach((c) => {
                    if (!manualCaseIds.has(c.id) || !c.contents?.length) return;

                    const onlyWeapon = WEAPON_ONLY_CASES[c.id];
                    if (onlyWeapon) {
                        c.contents = c.contents.filter((it) => it?.skin?.weapon === onlyWeapon);
                    }

                    const tops = (MANUAL_CASE_TOP_DROP[c.id] || []).map(([w, n]) => findSkin(w, n)).filter(Boolean);
                    if (!tops.length) return;
                    const primaryTop = tops[0];

                    c.contents = c.contents.filter((it) => (it?.skin && Number(it.skin.price || 0) < Number(primaryTop.price || 0)) || it.skin?.id === primaryTop.id);

                    const used = new Set((c.contents || []).map((it) => it.skin?.id).filter(Boolean));
                    const maxAllowed = Math.max(0.05, Number(primaryTop.price || 0) * 0.98);
                    const lowerBound = Math.max(0.01, Number(c.price || 0) * 0.02);
                    const fillersPool = Object.values(skinsDB || {})
                        .filter((s) => Number(s.price || 0) >= lowerBound && Number(s.price || 0) <= maxAllowed)
                        .sort((a, b) => Number(a.price || 0) - Number(b.price || 0));

                    const targetCount = Math.max(4, targetCountForCase(c));
                    while (c.contents.length < targetCount) {
                        const pick = pickDeterministic(fillersPool, `${c.id}-fill-${c.contents.length}`, used);
                        if (!pick) break;
                        used.add(pick.id);
                        c.contents.push({ skin: pick, chance: 0.00001 });
                    }

                    tops.forEach((topSkin) => {
                        if (!c.contents.find((it) => it.skin?.id === topSkin.id)) c.contents.push({ skin: topSkin, chance: 0.00001 });
                    });

                    const nonTop = c.contents.filter((it) => !tops.find((t) => t.id === it.skin?.id));
                    const topChance = topChanceForCase(c);
                    const secondTopChance = tops.length > 1 ? Math.max(0.01, Math.round((topChance * 0.5) * 100000) / 100000) : 0;
                    const jackpotTotal = topChance + secondTopChance;
                    const available = Math.max(0.001, 100 - jackpotTotal);

                    const sortedNonTop = nonTop.sort((a, b) => Number(a.skin?.price || 0) - Number(b.skin?.price || 0));
                    const n = sortedNonTop.length;
                    const ws = sortedNonTop.map((_it, i) => Math.pow(n - i, 1.1));
                    const sw = ws.reduce((a, b) => a + b, 0) || 1;
                    sortedNonTop.forEach((it, i) => {
                        it.chance = Math.max(0.00001, Math.round(((ws[i] / sw) * available) * 100000) / 100000);
                    });

                    tops.forEach((topSkin, i) => {
                        const row = c.contents.find((it) => it.skin?.id === topSkin.id);
                        if (row) row.chance = i === 0 ? topChance : secondTopChance;
                    });

                    const sum = c.contents.reduce((a, b) => a + Number(b.chance || 0), 0);
                    const diff = Math.round((100 - sum) * 100000) / 100000;
                    const receiver = c.contents.filter((it) => !tops.find((t) => t.id === it.skin?.id)).sort((a, b) => Number(a.chance || 0) - Number(b.chance || 0))[0] || c.contents[0];
                    if (receiver) receiver.chance = Math.max(0.00001, Math.round((Number(receiver.chance || 0) + diff) * 100000) / 100000);

                    c.contents = c.contents
                        .map((it) => ({ ...it, chance: Math.max(0.00001, Number(it.chance || 0)) }))
                        .sort((a, b) => Number(a.skin?.price || 0) - Number(b.skin?.price || 0));
                });
            };

            harmonizeManualCaseContents();


            const rebalanceUltraCheapCases = () => {
                const fallbackLow = allSkins
                    .filter((s) => Number(s.price || 0) <= 0.25)
                    .sort((a, b) => Number(a.price || 0) - Number(b.price || 0));

                casesDB.forEach((c) => {
                    if (!c.contents?.length || c.price >= 1) return;
                    if (manualCaseIds.has(c.id)) return;

                    const allowedMax = Math.max(0.18, c.price * 2.2);
                    const used = [];
                    const rebuilt = c.contents.map((entry) => {
                        const current = entry.skin;
                        if (Number(current?.price || 0) <= allowedMax) {
                            used.push(current);
                            return { ...entry };
                        }
                        const replacement = pickRangeBySeed(0.01, allowedMax, used, `${c.id}-cheap-${used.length}`)
                            || fallbackLow[seededIndex(`${c.id}-fallback-${used.length}`, Math.max(1, fallbackLow.length))]
                            || pickAnyBySeed(used, `${c.id}-cheap-any-${used.length}`)
                            || current;
                        used.push(replacement);
                        return { ...entry, skin: replacement };
                    });

                    c.contents = rebuilt.sort((a, b) => Number(a.skin?.price || 0) - Number(b.skin?.price || 0));
                });
            };

            rebalanceUltraCheapCases();
            const rebalanceAllCasesByPrice = () => {
                // Keep original case identity/variety (1% knife, jackpots, budget, premium...),
                // only do light sanitation so each case still has both losing and winning outcomes.
                casesDB.forEach((c) => {
                    if (!c.contents?.length) return;
                    if (manualCaseIds.has(c.id)) return;
                    c.contents = c.contents
                        .filter((it) => it?.skin && Number(it.skin.price || 0) > 0)
                        .sort((a, b) => Number(a.skin?.price || 0) - Number(b.skin?.price || 0));

                    if (!c.contents.length) return;

                    const hasWinner = c.contents.some((it) => Number(it.skin?.price || 0) > c.price);
                    const hasLoser = c.contents.some((it) => Number(it.skin?.price || 0) <= c.price);

                    if (!hasWinner) {
                        const winnerCandidate = pickRange(
                            Math.max(0.01, c.price * 1.05),
                            Math.max(c.price * 3.0, c.price + 0.2),
                            c.contents.map((x) => x.skin)
                        ) || pickAnyBySeed(c.contents.map((x) => x.skin), `${c.id}-winner-fallback`);
                        if (winnerCandidate) c.contents[c.contents.length - 1] = { ...c.contents[c.contents.length - 1], skin: winnerCandidate };
                    }

                    if (!hasLoser) {
                        const loserCandidate = pickRange(
                            0.01,
                            Math.max(0.02, c.price * 0.9),
                            c.contents.map((x) => x.skin)
                        ) || pickAnyBySeed(c.contents.map((x) => x.skin), `${c.id}-loser-fallback`);
                        if (loserCandidate) c.contents[0] = { ...c.contents[0], skin: loserCandidate };
                    }

                    // Prevent absurd jackpots in ultra-cheap cases (keeps EV controllable while still allowing profit).
                    if (c.price <= 2) {
                        const used = c.contents.map((x) => x.skin);
                        c.contents = c.contents.map((entry) => {
                            const price = Number(entry.skin?.price || 0);
                            if (price <= c.price * 3.0) return entry;
                            const replacement = pickRange(Math.max(0.01, c.price * 1.03), Math.max(c.price * 2.2, c.price + 0.1), used)
                                || pickRange(Math.max(0.01, c.price * 1.01), Math.max(c.price * 3.0, c.price + 0.2), used)
                                || entry.skin;
                            return { ...entry, skin: replacement };
                        });
                    }

                    c.contents = c.contents.sort((a, b) => Number(a.skin?.price || 0) - Number(b.skin?.price || 0));
                });
            };

            rebalanceAllCasesByPrice();
            const applyHouseEdge = () => {
                const expectedValue = (contents = []) => contents.reduce((acc, it) => acc + ((Number(it?.skin?.price || 0) * Number(it?.chance || 0)) / 100), 0);
                const sumChance = (contents = []) => contents.reduce((a, b) => a + Number(b?.chance || 0), 0);

                const normalizeRounded = (contents = []) => {
                    if (!contents.length) return contents;
                    const out = contents.map((it) => ({ ...it, chance: Math.max(0.1, Math.round(Number(it.chance || 0) * 10) / 10) }));
                    const diff = Math.round((100 - sumChance(out)) * 10) / 10;
                    out[out.length - 1].chance = Math.max(0.1, Math.round((out[out.length - 1].chance + diff) * 10) / 10);
                    const fix = Math.round((100 - sumChance(out)) * 10) / 10;
                    if (Math.abs(fix) > 0.001) out[0].chance = Math.max(0.1, Math.round((out[0].chance + fix) * 10) / 10);
                    return out;
                };

                const caseProfile = (c) => {
                    const id = String(c.id || '').toLowerCase();
                    const name = String(c.name || '').toLowerCase();
                    const p = Number(c.price || 0);

                    // "1% knife" styl: mal√° jackpot ≈°ance, hodnƒõ levn√Ωch drop≈Ø, velk√Ω n√°sobek.
                    if (id.includes('trash-or-knife') || name.includes('1%') || (name.includes('knife') && name.includes('risk'))) {
                        return { targetProfitChance: 12, targetRtp: 0.92, jackpotChance: 1.0, jackpotMultiplier: 90 };
                    }
                    // High-risk jackpot bedny.
                    if (id.includes('legendary') || id.includes('dragon') || id.includes('ultra') || id.includes('knife-ultra') || id.includes('top-tier')) {
                        return { targetProfitChance: 24, targetRtp: 0.93, jackpotChance: 2.5, jackpotMultiplier: 20 };
                    }
                    // Levn√© fun bedny - ƒçastƒõj≈°√≠ profit pocit.
                    if (p <= 1) return { targetProfitChance: 47, targetRtp: 0.96, jackpotChance: 0.0, jackpotMultiplier: 0 };
                    if (p <= 5) return { targetProfitChance: 43, targetRtp: 0.95, jackpotChance: 0.0, jackpotMultiplier: 0 };
                    if (p <= 50) return { targetProfitChance: 38, targetRtp: 0.94, jackpotChance: 0.0, jackpotMultiplier: 0 };
                    return { targetProfitChance: 33, targetRtp: 0.93, jackpotChance: 0.0, jackpotMultiplier: 0 };
                };

                casesDB.forEach((c) => {
                    if (!c.contents?.length) return;

                    const profile = caseProfile(c);
                    let items = c.contents.slice().sort((a, b) => Number(a.skin?.price || 0) - Number(b.skin?.price || 0));

                    // Ensure at least one winner and one loser.
                    const ensureWinner = () => {
                        if (items.some((it) => Number(it.skin?.price || 0) > c.price)) return;
                        const repl = pickRange(Math.max(0.01, c.price * 1.05), Math.max(c.price * 4, c.price + 0.3), items.map((x) => x.skin)) || items[items.length - 1]?.skin;
                        if (repl) items[items.length - 1] = { ...items[items.length - 1], skin: repl };
                    };
                    const ensureLoser = () => {
                        if (items.some((it) => Number(it.skin?.price || 0) <= c.price)) return;
                        const repl = pickRange(0.01, Math.max(0.02, c.price * 0.9), items.map((x) => x.skin)) || items[0]?.skin;
                        if (repl) items[0] = { ...items[0], skin: repl };
                    };
                    ensureWinner();
                    ensureLoser();

                    // Jackpot enforcement for special archetypes.
                    if (profile.jackpotChance > 0) {
                        const desired = c.price * profile.jackpotMultiplier;
                        const jackpotSkin = pickRange(desired * 0.95, desired * 1.05, items.map((x) => x.skin))
                            || pickRange(c.price * 85, c.price * 99, items.map((x) => x.skin))
                            || pickRange(desired * 0.7, desired * 1.4, items.map((x) => x.skin))
                            || items[items.length - 1]?.skin;
                        if (jackpotSkin) {
                            items[items.length - 1] = { ...items[items.length - 1], skin: jackpotSkin };
                        }
                    }

                    items = items.sort((a, b) => Number(a.skin?.price || 0) - Number(b.skin?.price || 0));
                    let losers = items.filter((it) => Number(it.skin?.price || 0) <= c.price);
                    let winners = items.filter((it) => Number(it.skin?.price || 0) > c.price);
                    if (!losers.length || !winners.length) return;

                    // Start with archetype target chance split.
                    const baseWinTotal = Math.max(5, Math.min(80, profile.targetProfitChance));
                    let loseTotal = 100 - baseWinTotal;

                    const distribute = (arr, total, weightFn) => {
                        const ws = arr.map((it) => Math.max(0.0001, Number(weightFn(it) || 0.0001)));
                        const sw = ws.reduce((a, b) => a + b, 0) || 1;
                        return arr.map((it, i) => ({ ...it, chance: (ws[i] / sw) * total }));
                    };

                    // Optional fixed jackpot slice (e.g. 1% knife).
                    let jackpotPart = null;
                    if (profile.jackpotChance > 0 && winners.length) {
                        jackpotPart = winners[winners.length - 1];
                        jackpotPart.chance = Math.max(0.1, profile.jackpotChance);
                        winners = winners.slice(0, -1);
                    }

                    let winnerBudget = Math.max(0.1, baseWinTotal - (jackpotPart?.chance || 0));
                    if (!winners.length) {
                        winnerBudget = 0;
                        loseTotal = 100 - (jackpotPart?.chance || baseWinTotal);
                    }

                    const winnerDist = winners.length ? distribute(
                        winners,
                        winnerBudget,
                        (it) => 1 / Math.max(c.price * 1.02, Number(it.skin?.price || c.price * 1.02))
                    ) : [];
                    const loserDist = distribute(
                        losers,
                        loseTotal,
                        (it) => 1 / Math.max(0.01, Math.pow(Number(it.skin?.price || 0.01), 1.25))
                    );

                    const merged = [...loserDist, ...winnerDist, ...(jackpotPart ? [jackpotPart] : [])];
                    const byId = new Map(merged.map((it) => [it.skin.id, it.chance]));
                    items = items.map((it) => ({ ...it, chance: byId.get(it.skin.id) || 0.1 }));

                    // EV correction: keep slightly house-favored while preserving archetype feel.
                    const targetEv = c.price * profile.targetRtp;
                    let ev = expectedValue(items);
                    let guard = 0;
                    while (ev > targetEv && guard < 500) {
                        const ws = items.filter((it) => Number(it.skin?.price || 0) > c.price).sort((a, b) => Number(a.skin?.price || 0) - Number(b.skin?.price || 0));
                        if (!ws.length) break;

                        const expensiveWinner = ws[ws.length - 1];
                        const cheapWinner = ws[0];
                        if (expensiveWinner.chance > 0.1 && expensiveWinner !== cheapWinner) {
                            expensiveWinner.chance = Math.max(0.1, Math.round((expensiveWinner.chance - 0.1) * 10) / 10);
                            cheapWinner.chance = Math.round((cheapWinner.chance + 0.1) * 10) / 10;
                        } else {
                            const ls = items.filter((it) => Number(it.skin?.price || 0) <= c.price).sort((a, b) => Number(a.skin?.price || 0) - Number(b.skin?.price || 0));
                            if (!ls.length) break;
                            const richLose = ls[ls.length - 1];
                            const cheapLose = ls[0];
                            if (richLose.chance <= 0.1 || richLose === cheapLose) break;
                            richLose.chance = Math.max(0.1, Math.round((richLose.chance - 0.1) * 10) / 10);
                            cheapLose.chance = Math.round((cheapLose.chance + 0.1) * 10) / 10;
                        }
                        items = normalizeRounded(items);
                        ev = expectedValue(items);
                        guard += 1;
                    }

                    // Final hard guard: never let EV >= price.
                    let hardGuard = 0;
                    while (expectedValue(items) >= c.price && hardGuard < 600) {
                        const ws = items.filter((it) => Number(it.skin?.price || 0) > c.price);
                        const ls = items.filter((it) => Number(it.skin?.price || 0) <= c.price).sort((a, b) => Number(a.skin?.price || 0) - Number(b.skin?.price || 0));
                        if (!ws.length || !ls.length) break;

                        const donor = ws
                            .filter((w) => {
                                const minChance = jackpotPart && w.skin?.id === jackpotPart.skin?.id ? Math.max(0.1, profile.jackpotChance) : 0.1;
                                return Number(w.chance || 0) > minChance;
                            })
                            .sort((a, b) => ((Number(b.skin?.price || 0) * Number(b.chance || 0)) - (Number(a.skin?.price || 0) * Number(a.chance || 0))))[0];
                        const cheapLose = ls[0];
                        if (!donor || !cheapLose) break;

                        const minWinnerChance = jackpotPart && donor.skin?.id === jackpotPart.skin?.id
                            ? Math.max(0.1, profile.jackpotChance)
                            : 0.1;

                        donor.chance = Math.max(minWinnerChance, Math.round((donor.chance - 0.1) * 10) / 10);
                        cheapLose.chance = Math.round((cheapLose.chance + 0.1) * 10) / 10;
                        items = normalizeRounded(items);
                        hardGuard += 1;
                    }

                    c.contents = normalizeRounded(items).sort((a, b) => Number(a.skin?.price || 0) - Number(b.skin?.price || 0));
                });
            };
            const applyCaseCatalogRefresh = () => {
                const renameMap = {
                    'trash-or-knife': '1% Knife Rush',
                    'dragon': '1% Dragon Lore',
                    'frosty': 'FROSTY'
                };
                casesDB.forEach((c) => {
                    if (renameMap[c.id]) c.name = renameMap[c.id];
                });
            };

            const diversifyCaseContents = () => {
                const all = Object.values(skinsDB || {});
                const byPrice = [...all].sort((a, b) => Number(a.price || 0) - Number(b.price || 0));

                const seeded = (seed) => {
                    const str = String(seed || 'x');
                    return str.split('').reduce((a, ch) => (a * 33 + ch.charCodeAt(0)) % 9973, 17);
                };

                const pick = (min, max, used, seed) => {
                    const pool = byPrice.filter((s) => Number(s.price || 0) >= min && Number(s.price || 0) <= max && !used.has(s.id));
                    if (!pool.length) return null;
                    const idx = seeded(seed) % pool.length;
                    return pool[idx];
                };

                casesDB.forEach((c) => {
                    if (manualCaseIds.has(c.id)) return;
                    const p = Number(c.price || 0);
                    const seedBase = seeded(c.id);
                    const target = p <= 1 ? 20 : p <= 5 ? 18 : p <= 20 ? 16 : p <= 100 ? 14 : 12;
                    const used = new Set();
                    const chosen = [];

                    const pushSkin = (skin) => {
                        if (!skin || used.has(skin.id)) return;
                        used.add(skin.id);
                        chosen.push(skin);
                    };

                    // Keep current themed tops.
                    const tops = (c.contents || []).slice().sort((a, b) => Number(b.skin?.price || 0) - Number(a.skin?.price || 0)).slice(0, 4).map((x) => x.skin);
                    tops.forEach(pushSkin);

                    if (c.id === 'frosty') pushSkin(findSkin('AK-47', 'Ice Coaled'));
                    if (c.id === 'dragon') pushSkin(findSkin('AWP', 'Dragon Lore'));
                    if (c.id === 'trash-or-knife') pushSkin(findSkin('M9 Bayonet', 'Autotronic'));

                    while (chosen.length < target) {
                        const slot = chosen.length;
                        const r = slot / Math.max(1, target - 1);
                        let minP = 0.01;
                        let maxP = Math.max(0.03, p * 0.8);
                        if (r > 0.62) { minP = Math.max(0.02, p * 0.85); maxP = Math.max(0.08, p * 1.6); }
                        if (r > 0.85) { minP = Math.max(0.03, p * 1.0); maxP = Math.max(0.12, p * 4.0); }

                        if (c.id === 'trash-or-knife') {
                            if (slot < target - 1) { minP = 0.01; maxP = Math.max(0.05, p * 0.25); }
                            else { minP = p * 90; maxP = p * 99; }
                        }
                        if (c.id === 'dragon') {
                            if (slot < target - 1) { minP = 0.02; maxP = Math.max(0.08, p * 0.55); }
                            else { minP = p * 60; maxP = p * 110; }
                        }

                        const skin = pick(minP, maxP, used, `${seedBase}-${slot}`)
                            || pick(0.01, Math.max(0.06, p * 2.0), used, `${seedBase}-fb-${slot}`)
                            || byPrice.find((s) => !used.has(s.id));
                        if (!skin) break;
                        pushSkin(skin);
                    }

                    if (!chosen.some((s) => Number(s.price || 0) > p)) {
                        pushSkin(pick(Math.max(0.05, p * 1.03), Math.max(0.1, p * 4), used, `${seedBase}-winner`) || findSkin('AK-47', 'Redline'));
                    }

                    const winners = chosen.filter((s) => Number(s.price || 0) > p);
                    const losers = chosen.filter((s) => Number(s.price || 0) <= p);
                    const winnerShare = c.id === 'trash-or-knife' ? 1.0 : (c.id === 'dragon' ? 1.0 : (p <= 1 ? 35 : p <= 10 ? 28 : 22));
                    const loserShare = 100 - winnerShare;

                    const dist = (arr, total, fn) => {
                        if (!arr.length) return [];
                        const ws = arr.map((s) => Math.max(0.0001, fn(s)));
                        const sum = ws.reduce((a, b) => a + b, 0) || 1;
                        return arr.map((s, i) => ({ skin: s, chance: (ws[i] / sum) * total }));
                    };

                    const winnerDist = dist(winners, winnerShare, (s) => 1 / Math.max(p * 1.02, Number(s.price || p * 1.02)));
                    const loserDist = dist(losers, loserShare, (s) => 1 / Math.max(0.01, Math.pow(Number(s.price || 0.01), 1.2)));

                    c.contents = [...loserDist, ...winnerDist]
                        .map((it) => ({ ...it, chance: Math.max(0.1, Math.round((it.chance || 0) * 10) / 10) }))
                        .sort((a, b) => Number(a.skin?.price || 0) - Number(b.skin?.price || 0));

                    const diff = Math.round((100 - c.contents.reduce((a, b) => a + (b.chance || 0), 0)) * 10) / 10;
                    if (c.contents.length) c.contents[c.contents.length - 1].chance = Math.max(0.1, Math.round((c.contents[c.contents.length - 1].chance + diff) * 10) / 10);
                });
            };

            const enforceHouseProfitStrict = () => {
                const ev = (contents=[]) => contents.reduce((a,it)=>a+((Number(it?.skin?.price||0)*Number(it?.chance||0))/100),0);
                const norm = (contents=[]) => {
                    if (!contents.length) return contents;
                    const sum = contents.reduce((a,b)=>a+Number(b.chance||0),0);
                    const diff = Math.round((100 - sum) * 10) / 10;
                    contents[contents.length - 1].chance = Math.max(0.1, Math.round((Number(contents[contents.length - 1].chance || 0) + diff) * 10) / 10);
                    return contents;
                };

                casesDB.forEach((c) => {
                    if (!c.contents?.length) return;
                    if (manualCaseIds.has(c.id)) return;
                    c.contents = c.contents.map((it) => ({ ...it, chance: Math.max(0.1, Math.round(Number(it.chance || 0) * 10) / 10) }));
                    let guard = 0;
                    while (ev(c.contents) >= Number(c.price || 0) && guard < 1200) {
                        const winners = c.contents
                            .filter((it) => Number(it.skin?.price || 0) > Number(c.price || 0) && Number(it.chance || 0) > 0.1)
                            .sort((a, b) => (Number(b.skin?.price || 0) * Number(b.chance || 0)) - (Number(a.skin?.price || 0) * Number(a.chance || 0)));
                        const losers = c.contents
                            .filter((it) => Number(it.skin?.price || 0) <= Number(c.price || 0))
                            .sort((a, b) => Number(a.skin?.price || 0) - Number(b.skin?.price || 0));
                        if (!winners.length || !losers.length) break;
                        const donor = winners[0];
                        const receiver = losers[0];
                        donor.chance = Math.max(0.1, Math.round((Number(donor.chance || 0) - 0.1) * 10) / 10);
                        receiver.chance = Math.round((Number(receiver.chance || 0) + 0.1) * 10) / 10;
                        norm(c.contents);
                        guard += 1;
                    }
                    c.contents = norm(c.contents).sort((a,b)=>Number(a.skin?.price||0)-Number(b.skin?.price||0));
                });
            };

            const mixKnivesIntoCases = () => {
                const knifePool = Object.values(skinsDB).filter((s) => KNIFE_TYPES.includes(s.weapon)).sort((a, b) => Number(a.price || 0) - Number(b.price || 0));
                if (!knifePool.length) return;
                const pickKnife = (min, max, seed = 'knife') => knifePool.find((k) => Number(k.price || 0) >= min && Number(k.price || 0) <= max)
                    || knifePool.find((k) => Number(k.price || 0) >= min)
                    || knifePool[seededIndex(seed, knifePool.length)];

                casesDB.forEach((c) => {
                    if (!c.contents?.length) return;
                    if (manualCaseIds.has(c.id)) return;
                    const lowerName = `${c.id} ${c.name}`.toLowerCase();
                    const hasKnife = c.contents.some((it) => KNIFE_TYPES.includes(it?.skin?.weapon));

                    c.contents = c.contents.map((it) => {
                        if (Number(it.chance || 0) <= 1) {
                            const jackpotKnife = pickKnife(c.price * 1.2, c.price * 40, `${c.id}-jackpot`);
                            return jackpotKnife ? { ...it, skin: jackpotKnife } : it;
                        }
                        return it;
                    });

                    if (!hasKnife && /(knife|tiger|arcana|legend|top|vac|quantum|dragon)/.test(lowerName)) {
                        const knife = pickKnife(c.price * 0.9, c.price * 6, `${c.id}-mix`);
                        if (knife) {
                            const targetIdx = c.contents.reduce((best, cur, idx, arr) => Number(cur.chance || 0) < Number(arr[best].chance || 999) ? idx : best, 0);
                            c.contents[targetIdx] = { ...c.contents[targetIdx], skin: knife, chance: Math.min(5, Number(c.contents[targetIdx].chance || 1)) };
                        }
                    }
                });

                if (!casesDB.find((c) => c.id === 'all-knives')) {
                    const knifeCaseItems = [
                        pickKnife(80, 250, 'all-k-1'), pickKnife(200, 450, 'all-k-2'), pickKnife(400, 800, 'all-k-3'), pickKnife(700, 1300, 'all-k-4'), pickKnife(1200, 999999, 'all-k-5')
                    ].filter(Boolean);
                    if (knifeCaseItems.length >= 3) {
                        casesDB.push({
                            id: 'all-knives',
                            name: 'ALL KNIVES',
                            price: 180.00,
                            color: 'yellow-400',
                            img: knifeCaseItems[knifeCaseItems.length - 1].img,
                            contents: knifeCaseItems.map((skin, i) => ({ skin, chance: [45, 28, 16, 8, 3][i] || 1 }))
                        });
                    }
                }
            };

            applyCaseCatalogRefresh();
            mixKnivesIntoCases();
            diversifyCaseContents();
            applyHouseEdge();
            enforceHouseProfitStrict();
            renderCases();
        }, 100);

        let userInventory = [];
        let activeCaseId = null;
        let isSpinning = false;
        let spinAnimationId = null;
        let casesCategoryFilter = 'all';
        let casesAffordableOnly = false;
        let casesSortDirection = 'asc';
        let userProfile = {
            nickname: '',
            displayName: '',
            avatar: '',
            provider: 'Guest'
        };

        // --- Z√ÅKLADY UI ---
        function toggleMobileMenu(force) {
            const panel = document.getElementById('mobile-menu');
            if (!panel) return;
            if (typeof force === 'boolean') panel.classList.toggle('hidden', !force);
            else panel.classList.toggle('hidden');
        }
        function currentCurrency() {
            return document.getElementById('currency-select')?.value || 'EUR';
        }
        function formatChancePercent(v) {
            const n = Number(v || 0);
            if (!Number.isFinite(n)) return '0%';
            if (n >= 1) return `${(Math.round(n * 100) / 100).toString()}%`;
            return `${(Math.round(n * 100000) / 100000).toString()}%`;
        }
        function formatMoney(val) {
            const cur = currentCurrency();
            const rate = CURRENCY_RATES[cur] || 1;
            const num = Number(val || 0) * rate;
            const decimals = ['CZK', 'RUB'].includes(cur) ? 0 : 2;
            const locale = cur === 'CZK' ? 'cs-CZ' : cur === 'PLN' ? 'pl-PL' : cur === 'RUB' ? 'ru-RU' : 'en-US';
            return `${num.toLocaleString(locale, { minimumFractionDigits: decimals, maximumFractionDigits: decimals })} ${cur}`;
        }
        const CURRENCY_RATES = { EUR: 1, USD: 1.08, CZK: 25.5, PLN: 4.35, RUB: 95 };
        function updateUI() {
            const sel = document.getElementById('currency-select');
            const cur = sel ? sel.value : 'EUR';
            const rate = CURRENCY_RATES[cur] || 1;
            const converted = balanceBase * rate;
            const decimals = cur === 'CZK' ? 0 : 2;
            const formatted = converted.toLocaleString(cur === 'CZK' ? 'cs-CZ' : 'en-US', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
            document.getElementById('balance').textContent = `${formatted} ${cur}`;
            const mobileBalance = document.getElementById('mobile-balance');
            if (mobileBalance) mobileBalance.textContent = `${formatted} ${cur}`;
            const lbl = document.getElementById('balance-currency-label');
            if(lbl) lbl.textContent = `Z≈Østatek (${cur})`;
            const authBtn = document.getElementById('auth-open-btn');
            const authLabel = document.getElementById('auth-open-label');
            const pill = document.getElementById('profile-pill');
            const pillName = document.getElementById('profile-pill-name');
            const pillNick = document.getElementById('profile-pill-nick');
            const pillAvatar = document.getElementById('profile-pill-avatar');
            const freeMoneyBtn = document.getElementById('free-money-btn');
            const isDemoMode = !currentUser;
            if(authLabel) authLabel.textContent = userProfile.nickname ? 'Profil' : 'P≈ôihl√°sit';
            if(authBtn) authBtn.classList.toggle('hidden', !!currentUser);
            if(freeMoneyBtn) {
                freeMoneyBtn.classList.toggle('hidden', !isDemoMode);
            }
            const adminBtn = document.getElementById('admin-nav-btn');
            if (adminBtn) {
                adminBtn.classList.toggle('hidden', !currentUser?.isAdmin);
                adminBtn.classList.toggle('flex', !!currentUser?.isAdmin);
            }
            if(pill && pillName && pillNick && pillAvatar) {
                if(userProfile.nickname) {
                    pill.classList.remove('hidden');
                    pill.classList.add('flex');
                    pillName.textContent = userProfile.displayName || userProfile.nickname;
                    pillNick.textContent = `@${userProfile.nickname} ‚Ä¢ ${userProfile.provider || 'User'}`;
                    pillAvatar.src = userProfile.avatar || FALLBACK_IMG;
                } else {
                    pill.classList.add('hidden');
                    pill.classList.remove('flex');
                }
            }
            lucide.createIcons();
            scheduleStateSave();
        }

        let currentUser = null;
        let stateSaveTimer = null;
        let authProviders = { steam: true, google: true };
        let authProviderStateLoaded = false;
        let selectedProfile = null;
        let tradeInbox = [];
        const tradeSelectedMine = new Set();
        const tradeSelectedTarget = new Set();
        const SELECTOR_PAGE_SIZE = 120;
        let selectorOffset = 0;


        function renderOwnPublicProfile() {
            const card = document.getElementById('my-public-profile-card');
            const invGrid = document.getElementById('my-public-profile-inventory');
            if (!card || !invGrid) return;
            if (!currentUser) {
                card.innerHTML = '<div class="text-gray-400 text-sm">P≈ôihlas se pro zobrazen√≠ ve≈ôejn√©ho profilu.</div>';
                invGrid.innerHTML = '';
                return;
            }
            const list = Array.isArray(userInventory) ? userInventory : [];
            const total = list.reduce((a, i) => a + Number(i.price || 0), 0);
            card.innerHTML = `
                <div class="flex items-center gap-3">
                    <img src="${userProfile.avatar || FALLBACK_IMG}" class="w-14 h-14 rounded-full border border-yellow-400/40 object-cover">
                    <div>
                        <div class="text-2xl font-black">${userProfile.displayName || userProfile.nickname || 'User'}</div>
                        <div class="text-xs text-gray-400">@${userProfile.nickname || 'user'} ‚Ä¢ ${userProfile.provider || 'User'}</div>
                    </div>
                </div>
                <div class="text-xs text-yellow-300">Invent√°≈ô: ${list.length} item≈Ø ‚Ä¢ Hodnota: ${formatMoney(total)}</div>
            `;
            invGrid.innerHTML = list.map((it) => `<div class="bg-black/30 border border-yellow-400/20 rounded-sm p-2 relative"><button onclick="sellSkin('${it.uid}')" class="absolute top-1 right-1 bg-red-500/80 hover:bg-red-500 text-white text-[9px] font-black px-1.5 py-0.5 rounded">Prodat</button><img src="${it.img}" class="h-16 w-full object-contain" onerror="handleImgError(this)"><div class="text-[10px] truncate">${it.name}</div><div class="text-yellow-300 text-[10px]">${formatMoney(it.price || 0)}</div></div>`).join('') || '<div class="text-gray-500 text-xs">Pr√°zdn√Ω invent√°≈ô</div>';
        }

        function openOwnPublicProfile() {
            if (!currentUser) return openAuthModal();
            renderOwnPublicProfile();
            switchPage('profile');
        }

        function sanitizeDuplicateSocialButtons() {
            const authModal = document.getElementById('auth-modal');
            if (!authModal) return;

            const selectors = [
                '#steam-login-btn',
                '#google-login-btn',
                "button[onclick=\"socialLogin('steam')\"]",
                "button[onclick=\"socialLogin('google')\"]"
            ];

            selectors.forEach((selector) => {
                const nodes = Array.from(authModal.querySelectorAll(selector));
                if (nodes.length <= 1) return;
                nodes.slice(1).forEach((node) => node.remove());
            });
        }

        function updateSocialLoginButtons() {
            const steamBtn = document.getElementById('steam-login-btn');
            const googleBtn = document.getElementById('google-login-btn');
            if (steamBtn) {
                steamBtn.disabled = false;
                const unavailable = authProviderStateLoaded && !authProviders.steam;
                steamBtn.classList.toggle('opacity-60', unavailable);
                steamBtn.classList.toggle('cursor-not-allowed', false);
                steamBtn.title = unavailable
                    ? 'Steam login teƒè nen√≠ dostupn√Ω na serveru. Kliknut√≠m zkus√≠≈° p≈ôihl√°≈°en√≠ i tak.'
                    : '';
            }
            if (googleBtn) {
                googleBtn.disabled = false;
                const unavailable = authProviderStateLoaded && !authProviders.google;
                googleBtn.classList.toggle('opacity-60', unavailable);
                googleBtn.classList.toggle('cursor-not-allowed', false);
                googleBtn.title = unavailable
                    ? 'Google login teƒè nen√≠ dostupn√Ω na serveru. Kliknut√≠m zkus√≠≈° p≈ôihl√°≈°en√≠ i tak.'
                    : '';
            }
        }

        async function apiRequest(url, method = 'GET', payload) {
            const opts = { method, headers: { 'Content-Type': 'application/json' }, credentials: 'include' };
            if (payload !== undefined) opts.body = JSON.stringify(payload);
            const res = await fetch(url, opts);
            const data = await res.json().catch(() => ({}));
            if (!res.ok || data.ok === false) {
                throw new Error(data.message || data.error || `HTTP ${res.status}`);
            }
            return data;
        }

        async function loadSessionFromBackend() {
            try {
                sanitizeDuplicateSocialButtons();
                const providerState = await apiRequest('/api/auth/providers');
                if (providerState?.providers) {
                    authProviders = {
                        steam: Boolean(providerState.providers.steam),
                        google: Boolean(providerState.providers.google)
                    };
                }
                authProviderStateLoaded = true;
                const auth = await apiRequest('/api/auth/session');
                if (!auth.user) return;
                currentUser = auth.user;
                userProfile = {
                    nickname: auth.user.nickname,
                    displayName: auth.user.displayName || auth.user.nickname,
                    avatar: auth.user.avatar || '',
                    provider: auth.user.isAdmin ? 'Admin' : 'Email √∫ƒçet',
                    phone: auth.user.phone || ''
                };
                const state = await apiRequest('/api/state');
                balanceBase = Number(state.balance || 10);
                userInventory = Array.isArray(state.inventory) ? state.inventory : [];
                if (auth.user.isAdmin) {
                    const hint = document.getElementById('admin-hint');
                    if (hint) hint.classList.remove('hidden');
                }
                loadTradeInbox();
            } catch (err) {
                console.warn('Nepovedlo se naƒç√≠st session:', err.message);
            } finally {
                updateSocialLoginButtons();
                updateUI();
                renderOwnPublicProfile();
            }
        }

        function scheduleStateSave() {
            if (!currentUser) return;
            clearTimeout(stateSaveTimer);
            stateSaveTimer = setTimeout(async () => {
                try {
                    await apiRequest('/api/state', 'POST', { balance: Number(balanceBase.toFixed(2)), inventory: userInventory });
                } catch (err) {
                    console.warn('State save failed:', err.message);
                }
            }, 1000);
        }

        function requireAuthAction() {
            if (currentUser) return true;
            showToast('Nejd≈ô√≠v se p≈ôihlas nebo registruj.', true);
            openAuthModal();
            return false;
        }

        function openAuthModal() {
            const friendInput = document.getElementById('friend-search');
            if (friendInput) friendInput.addEventListener('input', () => searchUsers());
            const modal = document.getElementById('auth-modal');
            if(!modal) return;
            sanitizeDuplicateSocialButtons();
            updateSocialLoginButtons();
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.getElementById('profile-nickname').value = userProfile.nickname || '';
            document.getElementById('profile-display-name').value = userProfile.displayName || '';
            document.getElementById('profile-avatar').value = userProfile.avatar || '';
            const phoneAuth = document.getElementById('profile-phone-auth');
            const phoneProfile = document.getElementById('profile-phone');
            if (phoneAuth) phoneAuth.value = userProfile.phone || '';
            if (phoneProfile) phoneProfile.value = userProfile.phone || '';
            lucide.createIcons();
        }

        function closeAuthModal() {
            const friendInput = document.getElementById('friend-search');
            if (friendInput) friendInput.addEventListener('input', () => searchUsers());
            const modal = document.getElementById('auth-modal');
            if(!modal) return;
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        async function registerAccount() {
            try {
                const payload = {
                    email: (document.getElementById('auth-email')?.value || '').trim(),
                    password: document.getElementById('auth-password')?.value || '',
                    nickname: (document.getElementById('profile-nickname')?.value || '').trim(),
                    displayName: (document.getElementById('profile-display-name')?.value || '').trim(),
                    avatar: (document.getElementById('profile-avatar')?.value || '').trim(),
                    phone: (document.getElementById('profile-phone-auth')?.value || document.getElementById('profile-phone')?.value || '').trim(),
                };
                const result = await apiRequest('/api/auth/register', 'POST', payload);
                currentUser = result.user;
                await loadSessionFromBackend();
                updateUI();
                renderInventory();
                closeAuthModal();
                showToast('Registrov√°no. Start m√°≈° 10 USD.');
            } catch (err) {
                showToast(err.message, true);
            }
        }

        async function loginAccount() {
            try {
                const payload = {
                    email: (document.getElementById('auth-email')?.value || '').trim(),
                    password: document.getElementById('auth-password')?.value || '',
                };
                const result = await apiRequest('/api/auth/login', 'POST', payload);
                currentUser = result.user;
                await loadSessionFromBackend();
                updateUI();
                renderInventory();
                closeAuthModal();
                showToast('P≈ôihl√°≈°en√≠ probƒõhlo.');
            } catch (err) {
                showToast(err.message, true);
            }
        }

        function socialLogin(provider) {
            if (provider !== 'steam' && provider !== 'google') return;
            if (authProviderStateLoaded && !authProviders[provider]) {
                showToast(`${provider === 'steam' ? 'Steam' : 'Google'} login nen√≠ plnƒõ nakonfigurovan√Ω. Zkou≈°√≠m p≈ôesmƒõrovat‚Ä¶`, true);
            }
            // P≈ôesmƒõrov√°n√≠ na backend routu
            window.location.href = `/auth/${provider}`; 
        }

        async function saveLocalProfile() {
            if (!currentUser) return showToast('Nejd≈ô√≠v se p≈ôihlas.', true);
            const nickname = (document.getElementById('profile-nickname')?.value || '').trim();
            if(!nickname) return showToast('Vypl≈à nickname.', true);
            try {
                const result = await apiRequest('/api/profile', 'PUT', {
                    nickname,
                    displayName: (document.getElementById('profile-display-name')?.value || nickname).trim(),
                    avatar: (document.getElementById('profile-avatar')?.value || '').trim(),
                    phone: (document.getElementById('profile-phone-auth')?.value || document.getElementById('profile-phone')?.value || '').trim(),
                });
                currentUser = result.user;
                await loadSessionFromBackend();
                updateUI();
                closeAuthModal();
                showToast('Profil ulo≈æen ‚úÖ');
            } catch (err) {
                showToast(err.message, true);
            }
        }

        async function logoutLocalProfile() {
            try { await apiRequest('/api/auth/logout', 'POST'); } catch (err) { console.warn(err.message); }
            currentUser = null;
            userProfile = { nickname: '', displayName: '', avatar: '', provider: 'Guest' };
            userInventory = [];
            balanceBase = 10;
            updateUI();
            renderOwnPublicProfile();
            renderInventory();
            showToast('Odhl√°≈°eno');
        }

        async function loadAdminUsers() {
            if (!currentUser?.isAdmin) return;
            const wrap = document.getElementById('admin-users');
            if (!wrap) return;
            try {
                const data = await apiRequest('/api/admin/users');
                wrap.innerHTML = (data.users || []).map((u) => {
                    const skinOptions = Object.values(skinsDB).slice(0, 600).map((s) => `<option value="${s.name.replace(/"/g, '&quot;')}">${s.name}</option>`).join('');
                    const invOptions = (u.inventory || []).map((it) => `<option value="${it.uid}">${it.name} (${formatMoney(it.price || 0)})</option>`).join('');
                    return `
                    <div class="bg-black/30 border border-yellow-400/20 rounded-xl p-3 space-y-2">
                        <div class="flex items-center justify-between gap-2">
                            <div class="flex items-center gap-2 min-w-0"><img src="${u.avatar || FALLBACK_IMG}" class="w-9 h-9 rounded-full object-cover border border-yellow-400/30"><div><div class="font-black text-white truncate">${u.displayName || u.nickname || 'user'} (${u.email || '-'})</div><div class="text-xs text-yellow-300">Balance: ${formatMoney(Number(u.balance || 0))}</div></div></div>
                            <div class="flex items-center gap-1"><input type="number" step="0.01" id="admin-bal-${u.id}" class="w-24 bg-black/40 border border-yellow-400/30 rounded px-2 py-1 text-white" value="10"><button onclick="adminAddBalance('${u.id}','admin-bal-${u.id}')" class="bg-green-600 px-2 py-1 rounded font-black text-xs">+ Pen√≠ze</button><button onclick="adminAddBalance('${u.id}','admin-bal-${u.id}', true)" class="bg-red-600 px-2 py-1 rounded font-black text-xs">- Pen√≠ze</button></div>
                        </div>
                        <details class="bg-black/25 border border-yellow-400/10 rounded p-2">
                            <summary class="cursor-pointer text-xs font-black text-blue-300">Give skin (v√Ωbƒõr)</summary>
                            <div class="mt-2 grid md:grid-cols-2 gap-2">
                                <input list="admin-skin-list-${u.id}" id="admin-skin-name-${u.id}" class="bg-black/40 border border-yellow-400/20 rounded px-2 py-1 text-xs" placeholder="N√°zev skinu">
                                <datalist id="admin-skin-list-${u.id}">${skinOptions}</datalist>
                                <button onclick="adminGiveSkin('${u.id}','${u.id}')" class="bg-blue-600 px-2 py-1 rounded font-black text-xs">Give skin</button>
                            </div>
                        </details>
                        <details class="bg-black/25 border border-yellow-400/10 rounded p-2">
                            <summary class="cursor-pointer text-xs font-black text-red-300">Odebrat skin (z invent√°≈ôe)</summary>
                            <div class="mt-2 grid md:grid-cols-2 gap-2">
                                <select id="admin-skin-uid-${u.id}" class="bg-black/40 border border-yellow-400/20 rounded px-2 py-1 text-xs">${invOptions || '<option value="">Pr√°zdn√Ω invent√°≈ô</option>'}</select>
                                <button onclick="adminRemoveSkin('${u.id}','${u.id}')" class="bg-red-700 px-2 py-1 rounded font-black text-xs">Odeber</button>
                            </div>
                        </details>
                    </div>`;
                }).join('');
            } catch (err) {
                wrap.innerHTML = `<div class="text-red-400">${err.message}</div>`;
            }
        }

        async function adminAddBalance(userIdentifier, inputId, subtract = false) {
            const rawAmount = Number(document.getElementById(inputId)?.value || 0);
            const amount = subtract ? -Math.abs(rawAmount) : Math.abs(rawAmount);
            try {
                await apiRequest('/api/admin/add-balance', 'POST', { userIdentifier, amount });
                showToast('Z≈Østatek upraven');
                loadAdminUsers();
            } catch (err) { showToast(err.message, true); }
        }

        
        async function adminGiveSkin(userIdentifier, userId) {
            const name = (document.getElementById(`admin-skin-name-${userId}`)?.value || '').trim();
            if (!name) return showToast('Vypl≈à n√°zev skinu', true);
            const skin = Object.values(skinsDB).find((s) => s.name.toLowerCase() === name.toLowerCase()) || null;
            if (!skin) return showToast('Skin nenalezen v datab√°zi.', true);
            const item = {
                uid: `${Date.now()}-${Math.random().toString(36).slice(2,7)}`,
                name: skin.name,
                weapon: skin.weapon,
                skin: skin.skinName,
                price: Number(skin.price || 0),
                color: skin.color,
                img: skin.img || FALLBACK_IMG
            };
            try {
                await apiRequest('/api/admin/inventory-edit', 'POST', { userIdentifier, mode: 'add', item });
                showToast('Skin p≈ôid√°n');
                loadAdminUsers();
            } catch (err) { showToast(err.message, true); }
        }

        async function adminRemoveSkin(userIdentifier, userId) {
            const uid = (document.getElementById(`admin-skin-uid-${userId}`)?.value || '').trim();
            if (!uid) return showToast('Vyber skin z invent√°≈ôe', true);
            try {
                await apiRequest('/api/admin/inventory-edit', 'POST', { userIdentifier, mode: 'remove', uid });
                showToast('Skin odebr√°n');
                loadAdminUsers();
            } catch (err) { showToast(err.message, true); }
        }

        async function requestTopUp() {
            if (!requireAuthAction()) return;
            const amount = Number(document.getElementById('topup-amount')?.value || 0);
            try {
                const data = await apiRequest('/api/wallet/topup', 'POST', { amount });
                balanceBase = Number(data.balance || balanceBase);
                updateUI();
                showToast('Top-up p≈ôips√°n');
            } catch (err) { showToast(err.message, true); }
        }

        async function searchUsers() {
            if (!requireAuthAction()) return;
            const q = (document.getElementById('friend-search')?.value || '').trim();
            const out = document.getElementById('friend-search-results');
            if (!out) return;
            if (q.length < 2) { out.innerHTML = '<div class="text-gray-500 text-xs">Napi≈° aspo≈à 2 znaky‚Ä¶</div>'; return; }
            try {
                const data = await apiRequest(`/api/users/search?q=${encodeURIComponent(q)}`);
                out.innerHTML = (data.users || []).map((u) => `
                    <div class="bg-black/30 rounded-lg p-2 flex items-center justify-between gap-2 border border-yellow-400/10">
                        <div class="flex items-center gap-2 min-w-0"><img src="${u.avatar || FALLBACK_IMG}" class="w-8 h-8 rounded-full object-cover border border-yellow-400/30"><div class="truncate">${u.displayName || u.nickname}</div></div>
                        <div class="flex gap-1"><button onclick="openUserProfile('${u.id}')" class="bg-purple-500 px-2 py-1 rounded text-xs font-black">Profil</button><button onclick="addFriend('${u.id}')" class="bg-blue-500 px-2 py-1 rounded text-xs font-black">P≈ôidat</button></div>
                    </div>`).join('') || '<div class="text-gray-500 text-xs">Nikdo nenalezen.</div>';
            } catch (err) { out.innerHTML = `<div class="text-red-400">${err.message}</div>`; }
        }

        async function loadFriends() {
            if (!currentUser) return;
            const out = document.getElementById('friends-list');
            if (!out) return;
            try {
                const data = await apiRequest('/api/friends');
                const reqHtml = (data.requests || []).map((u) => `
                    <div class="bg-blue-950/25 rounded-lg p-2 flex items-center justify-between gap-2 border border-blue-400/30">
                        <div class="flex items-center gap-2"><img src="${u.avatar || FALLBACK_IMG}" class="w-8 h-8 rounded-full object-cover border border-blue-300/40"><div class="font-bold">${u.displayName || u.nickname}</div></div>
                        <div class="flex gap-1"><button onclick="respondFriendRequest('${u.id}', true)" class="bg-green-600 px-2 py-1 rounded text-xs font-black">P≈ôijmout</button><button onclick="respondFriendRequest('${u.id}', false)" class="bg-red-600 px-2 py-1 rounded text-xs font-black">Odm√≠tnout</button></div>
                    </div>`).join('');
                const frHtml = (data.friends || []).map((u) => `
                    <div class="bg-black/30 rounded-lg p-2 flex items-center justify-between gap-2 border border-yellow-400/10">
                        <div class="flex items-center gap-2"><img src="${u.avatar || FALLBACK_IMG}" class="w-8 h-8 rounded-full object-cover border border-yellow-400/30"><div class="font-bold">${u.displayName || u.nickname}</div></div>
                        <div class="flex gap-1"><button onclick="openUserProfile('${u.id}')" class="bg-purple-500 px-2 py-1 rounded text-xs font-black">Profil</button><input type="number" step="0.01" min="0.01" id="donate-${u.id}" value="1" class="w-16 bg-black/40 border border-yellow-400/30 rounded px-2 py-1 text-xs"><button onclick="donateToFriend('${u.id}','donate-${u.id}')" class="bg-yellow-400 text-black px-2 py-1 rounded text-xs font-black">Donate</button></div>
                    </div>`).join('');
                out.innerHTML = (reqHtml ? `<div class=\"text-xs font-black text-blue-300 uppercase\">≈Ω√°dosti</div>${reqHtml}` : '') + (frHtml || '<div class=\"text-gray-500\">Zat√≠m ≈æ√°dn√≠ p≈ô√°tel√©.</div>');
            } catch (err) { out.innerHTML = `<div class="text-red-400">${err.message}</div>`; }
        }

        async function addFriend(userId) {
            try { await apiRequest('/api/friends/add', 'POST', { userId }); showToast('≈Ω√°dost odesl√°na'); loadFriends(); } catch (err) { showToast(err.message, true); }
        }

        async function respondFriendRequest(userId, accept) {
            try { await apiRequest('/api/friends/respond', 'POST', { userId, accept }); showToast(accept ? 'P≈ô√°telstv√≠ potvrzeno' : '≈Ω√°dost odm√≠tnuta'); loadFriends(); } catch (err) { showToast(err.message, true); }
        }

        async function donateToFriend(toUserId, amountId) {
            const amount = Number(document.getElementById(amountId)?.value || 0);
            try {
                const data = await apiRequest('/api/transfer', 'POST', { toUserId, amount });
                balanceBase = Number(data.balance || balanceBase);
                updateUI();
                showToast('P≈ôevod odesl√°n');
            } catch (err) { showToast(err.message, true); }
        }

        function renderTradeInventory(gridId, items, selectedSet) {
            const grid = document.getElementById(gridId);
            if (!grid) return;
            grid.innerHTML = (items || []).map((it) => {
                const checked = selectedSet.has(String(it.uid));
                return `
                    <div data-uid="${it.uid}" class="trade-item-card ${checked ? 'ring-2 ring-green-400 bg-green-500/10' : 'bg-black/30'} border border-yellow-400/20 rounded-sm p-2 text-xs cursor-pointer transition-all">
                        <img src="${it.img}" class="h-14 w-full object-contain mb-1" onerror="handleImgError(this)">
                        <div class="truncate">${it.name}</div>
                        <div class="text-yellow-300">${formatMoney(it.price || 0)}</div>
                    </div>
                `;
            }).join('') || '<div class="text-gray-500 text-xs">Pr√°zdn√©.</div>';

            Array.from(grid.querySelectorAll('.trade-item-card')).forEach((card) => {
                card.addEventListener('click', () => {
                    const uid = String(card.getAttribute('data-uid') || '');
                    if (!uid) return;
                    if (selectedSet.has(uid)) selectedSet.delete(uid);
                    else selectedSet.add(uid);
                    card.classList.toggle('ring-2', selectedSet.has(uid));
                    card.classList.toggle('ring-green-400', selectedSet.has(uid));
                    card.classList.toggle('bg-green-500/10', selectedSet.has(uid));
                    card.classList.toggle('bg-black/30', !selectedSet.has(uid));
                });
            });
        }

        function openTradeBuilder() {
            const modal = document.getElementById('trade-builder-modal');
            if (!modal) return;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeTradeBuilder() {
            const modal = document.getElementById('trade-builder-modal');
            if (!modal) return;
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        async function openUserProfile(userId) {
            try {
                const data = await apiRequest(`/api/profile/${userId}`);
                selectedProfile = data.profile;
                const card = document.getElementById('user-profile-card');
                if (card) {
                    card.innerHTML = `
                        <div class="flex items-center gap-3 mb-3"><img src="${selectedProfile.avatar || FALLBACK_IMG}" class="w-14 h-14 rounded-full border border-yellow-400/40 object-cover"><div><div class="text-2xl font-black">${selectedProfile.displayName || selectedProfile.nickname}</div><div class="text-xs text-gray-400">@${selectedProfile.nickname || 'user'}</div></div></div>
                        <div class="text-xs text-gray-400">Registrov√°n: ${selectedProfile.createdAt ? new Date(selectedProfile.createdAt).toLocaleString('cs-CZ') : '-'}</div>
                        <div class="text-xs text-gray-400">Posledn√≠ p≈ôihl√°≈°en√≠: ${selectedProfile.lastLoginAt ? new Date(selectedProfile.lastLoginAt).toLocaleString('cs-CZ') : '-'}</div>
                        <div class="mt-3 text-xs text-yellow-300">Invent√°≈ô: ${selectedProfile.inventory?.length || 0} item≈Ø</div>
                    `;
                }
                const invGrid = document.getElementById('user-profile-inventory');
                if (invGrid) {
                    invGrid.innerHTML = (selectedProfile.inventory || []).map((it) => `<div class="bg-black/30 border border-yellow-400/20 rounded-sm p-2"><img src="${it.img}" class="h-16 w-full object-contain" onerror="handleImgError(this)"><div class="text-[10px] truncate">${it.name}</div><div class="text-yellow-300 text-[10px]">${formatMoney(it.price || 0)}</div></div>`).join('') || '<div class="text-gray-500 text-xs">Pr√°zdn√Ω invent√°≈ô</div>';
                }

                const openBtn = document.getElementById('open-trade-builder-btn');
                if (openBtn) {
                    openBtn.onclick = () => {
                        tradeSelectedMine.clear();
                        tradeSelectedTarget.clear();
                        renderTradeInventory('trade-my-items', userInventory, tradeSelectedMine);
                        renderTradeInventory('trade-target-items', selectedProfile.inventory || [], tradeSelectedTarget);
                        openTradeBuilder();
                    };
                }

                const sendBtn = document.getElementById('trade-send-btn');
                if (sendBtn) {
                    sendBtn.onclick = async () => {
                        const offeredUids = Array.from(tradeSelectedMine);
                        const requestedUids = Array.from(tradeSelectedTarget);
                        try {
                            await apiRequest('/api/trades/send', 'POST', { toUserId: selectedProfile.id, offeredUids, requestedUids });
                            showToast('Trade nab√≠dka odesl√°na');
                            closeTradeBuilder();
                        } catch (err) { showToast(err.message, true); }
                    };
                }

                switchPage('user-profile');
            } catch (err) { showToast(err.message, true); }
        }

        
        async function loadTradeInbox() {
            if (!currentUser) return;
            try {
                const [notifData, tradeData] = await Promise.all([
                    apiRequest('/api/notifications'),
                    apiRequest('/api/trades/inbox').catch(() => ({ trades: [] }))
                ]);

                const notes = notifData.notifications || [];
                const pendingTrades = tradeData.trades || [];

                const badge = document.getElementById('trade-bell-count');
                if (badge) {
                    const count = notes.length;
                    badge.textContent = String(count);
                    badge.classList.toggle('hidden', count === 0);
                }

                const list = document.getElementById('trade-inbox-list');
                if (list) {
                    const noteHtml = notes.map((n) => `<div class="bg-black/30 border border-yellow-400/20 rounded-lg p-2 text-xs"><div class="text-yellow-300 font-bold">${n.type || 'info'}</div><div>${n.text}</div><div class="text-gray-500 text-[10px]">${new Date(n.createdAt).toLocaleString('cs-CZ')}</div></div>`).join('');
                    const tradeHtml = pendingTrades.map((t) => `
                        <div class="bg-black/30 border border-green-400/30 rounded-lg p-2 text-xs">
                            <div class="font-bold text-green-300 mb-1">Trade #${String(t.id).slice(-6)}</div>
                            <div>Za tebe: ${t.requestedItems?.length || 0} item≈Ø ‚Ä¢ Od nich: ${t.offeredItems?.length || 0} item≈Ø</div>
                            <div class="mt-2 flex gap-1"><button onclick="respondTrade('${t.id}','accept')" class="bg-green-600 px-2 py-1 rounded font-black">P≈ôijmout</button><button onclick="respondTrade('${t.id}','reject')" class="bg-red-600 px-2 py-1 rounded font-black">Odm√≠tnout</button></div>
                        </div>
                    `).join('');
                    list.innerHTML = (tradeHtml + noteHtml) || '<div class="text-gray-500 text-xs">≈Ω√°dn√© notifikace.</div>';
                }
            } catch (err) {
                console.warn('notifications error', err.message);
            }
        }

        function toggleTradeInbox(force = null) {
            const panel = document.getElementById('trade-inbox-panel');
            if (!panel) return;
            const show = force === null ? panel.classList.contains('hidden') : Boolean(force);
            panel.classList.toggle('hidden', !show);
            if (show) loadTradeInbox();
        }

        async function respondTrade(tradeId, action) {
            try {
                await apiRequest(`/api/trades/${tradeId}/respond`, 'POST', { action });
                showToast(action === 'accept' ? 'Trade p≈ôijat' : 'Trade odm√≠tnut');
                await loadTradeInbox();
                if (action === 'accept') await loadSessionFromBackend();
            } catch (err) {
                showToast(err.message, true);
            }
        }



        function fmtLeft(ms) {
            const s = Math.ceil(ms / 1000);
            const h = Math.floor(s / 3600);
            const m = Math.floor((s % 3600) / 60);
            const sec = s % 60;
            return `${h}h ${m}m ${sec}s`;
        }

        function pickGiveawaySkin(minPrice, maxPrice) {
            const all = Object.values(skinsDB);
            const pool = all.filter((sk) => Number(sk.price || 0) >= minPrice && Number(sk.price || 0) <= maxPrice);
            return pool[Math.floor(Math.random() * Math.max(1, pool.length))] || all[Math.floor(Math.random() * all.length)];
        }

        async function initGiveaways() {
            const grid = document.getElementById('giveaway-grid');
            if (!grid) return;
            const tiersCfg = [
                { id: 'gw-hourly', name: 'Tier 1 ‚Ä¢ Hourly', cooldownMs: 60 * 60 * 1000, min: 5, max: 15, accent: 'from-green-500/30 to-emerald-500/20' },
                { id: 'gw-six', name: 'Tier 2 ‚Ä¢ 6 Hours', cooldownMs: 6 * 60 * 60 * 1000, min: 60, max: 100, accent: 'from-blue-500/30 to-cyan-500/20' },
                { id: 'gw-daily', name: 'Tier 3 ‚Ä¢ Daily', cooldownMs: 24 * 60 * 60 * 1000, min: 400, max: 9000, accent: 'from-yellow-500/30 to-orange-500/20' }
            ];
            try {
                const payloadTiers = tiersCfg.map((t) => {
                    const skin = pickGiveawaySkin(t.min, t.max);
                    return { id: t.id, cooldownMs: t.cooldownMs, skin: { name: skin.name, price: Number(skin.price || 0), color: skin.color, img: skin.img } };
                });
                const data = await apiRequest('/api/giveaways/state', 'POST', { tiers: payloadTiers });
                const map = Object.fromEntries((data.tiers || []).map((t) => [t.tierId, t]));
                grid.innerHTML = tiersCfg.map((t) => {
                    const st = map[t.id] || {};
                    const skin = st.skin || pickGiveawaySkin(t.min, t.max);
                    const left = Math.max(0, new Date(st.endsAt || Date.now()).getTime() - Date.now());
                    const history = Array.isArray(st.history) ? st.history : [];
                    return `<div class="bg-gradient-to-br ${t.accent} border border-yellow-400/30 rounded-2xl p-4">
                        <div class="text-sm font-black uppercase mb-2">${t.name}</div>
                        <img src="${skin.img || FALLBACK_IMG}" class="h-24 w-full object-contain mb-2" onerror="handleImgError(this)">
                        <div class="text-xs text-gray-200 truncate">${skin.name || 'Skin'}</div>
                        <div class="text-yellow-300 font-black mb-1">${formatMoney(skin.price || 0)}</div>
                        <div class="text-[11px] text-gray-300 mb-2">Tickety: ${st.entriesCount || 0} ${st.myEntered ? '‚Ä¢ Tv≈Øj ticket vlo≈æen' : ''}</div>
                        <button onclick="enterGiveawayTicket('${t.id}')" class="w-full bg-yellow-400 text-black font-black rounded-lg py-2 text-xs">Vlo≈æit ticket</button>
                        <div class="text-[11px] text-gray-400 mt-2">Losov√°n√≠ za: ${fmtLeft(left)}</div>
                        <div class="mt-2 text-[11px] text-gray-300">Posledn√≠ v√Ωherci:</div>
                        <div class="text-[10px] text-gray-400 space-y-1">${history.map((h)=>`<div>${h.nickname} ‚Ä¢ ${h.skinName} ‚Ä¢ ${formatMoney(h.price||0)}</div>`).join('') || '<div>zat√≠m ≈æ√°dn√≠</div>'}</div>
                    </div>`;
                }).join('');
            } catch (err) {
                grid.innerHTML = `<div class="text-red-400">${err.message}</div>`;
            }
        }

        async function enterGiveawayTicket(tierId) {
            if (!requireAuthAction()) return;
            try {
                await apiRequest('/api/giveaways/ticket', 'POST', { tierId });
                showToast('Ticket vlo≈æen');
                initGiveaways();
            } catch (err) { showToast(err.message, true); }
        }
        let cbPollTimer = null;
        let cbActiveRoomId = null;
        let cbAnimationLock = false;
        let cbAnimationSession = 0;
        let cbLastAnimatedSignature = '';
        let cbListTab = 'active';
        let cbModeFilter = 'all';
        const CB_ITEM_WIDTH = 136;
        const CB_WIN_INDEX = 50;
        const CB_BOT_AVATAR = 'Gemini_Generated_Image_v28osov28osov28o-removebg-preview (1).png';
        const cbBuilderState = { mode: '1v1', teamFormat: '1v1', gameMode: 'classic', privacy: 'public', selected: new Map() };
        let cbSelectedCases = new Map();

        function cbSetPanels(inRoom) {
            const createPanel = document.getElementById('cb-create-panel');
            const roomPanel = document.getElementById('cb-room-panel');
            
            if (inRoom) {
                if (createPanel) createPanel.classList.add('hidden');
                if (roomPanel) roomPanel.classList.remove('hidden');
                if (roomPanel) roomPanel.classList.add('flex');
            } else {
                if (createPanel) createPanel.classList.remove('hidden');
                if (roomPanel) roomPanel.classList.add('hidden');
                if (roomPanel) roomPanel.classList.remove('flex');
            }
        }
        function cbSleep(ms) { return new Promise((r) => setTimeout(r, ms)); }
        function cbAddLog(text) { const log = document.getElementById('cb-log'); if (!log) return; const row = document.createElement('div'); row.className='mb-1 text-gray-200'; row.textContent=text; log.appendChild(row); log.scrollTop=log.scrollHeight; }

        function setCaseBattleListTab(tab) {
            cbListTab = tab;
            document.querySelectorAll('.cb-hub-tab').forEach((x) => x.classList.toggle('active', x.dataset.cbList === tab));
            loadCaseBattleRooms();
        }
        function setCaseBattleFilter(filter) {
            cbModeFilter = filter;
            document.querySelectorAll('.cb-filter-chip').forEach((x) => x.classList.toggle('active', x.dataset.cbFilter === filter));
            loadCaseBattleRooms();
        }

        function initCaseBattle() {
            const panel = document.getElementById('cb-create-panel');
            if (!panel) return;
            if (!panel.dataset.ready) panel.dataset.ready = '1';
            cbSetPanels(Boolean(cbActiveRoomId));
            loadCaseBattleRooms();
            if (cbPollTimer) clearInterval(cbPollTimer);
            cbPollTimer = setInterval(async () => {
                if (cbActiveRoomId) await refreshCaseBattleRoom();
                else await loadCaseBattleRooms();
            }, 1100);
        }

        function openCaseBattleBuilder() {
            const modal = document.getElementById('cb-builder-modal');
            if (!modal) return;
            modal.classList.remove('hidden');
            modal.querySelectorAll('.cb-builder-opt').forEach((btn) => {
                btn.onclick = () => {
                    const g = btn.dataset.cbGroup;
                    const v = btn.dataset.cbVal;
                    modal.querySelectorAll(`.cb-builder-opt[data-cb-group="${g}"]`).forEach((x) => x.classList.remove('active'));
                    btn.classList.add('active');
                    cbBuilderState[g] = v;
                    if (g === 'teamFormat' && v === '2v2') cbBuilderState.mode = '1v1v1v1';
                };
            });
            renderCreateBattleQueue();
            renderCaseSelectorGrid();
        }
        function closeCaseBattleBuilder() { document.getElementById('cb-builder-modal')?.classList.add('hidden'); document.getElementById('cb-case-selector-modal')?.classList.add('hidden'); }
        function setCBBuilderCaseCount(caseId, value) {
            const next = Math.max(0, Math.min(30, Number(value || 0)));
            if (next <= 0) cbSelectedCases.delete(caseId);
            else cbSelectedCases.set(caseId, next);
            cbBuilderState.selected = new Map(cbSelectedCases);
            renderCreateBattleQueue();
            updateSelectorBottomBar();
        }

        function updateCbCaseCount(caseId, delta) {
            const cur = Number(cbSelectedCases.get(caseId) || 0);
            setCBBuilderCaseCount(caseId, cur + Number(delta || 0));
            renderCaseSelectorModal();
        }

        function changeCBBuilderCase(caseId, delta) {
            updateCbCaseCount(caseId, delta);
        }

        function cbBuilderSummary() {
            let rounds = 0; let total = 0;
            cbSelectedCases.forEach((cnt, id) => {
                const c = casesDB.find((x) => x.id === id); if (!c) return;
                rounds += cnt; total += Number(c.price || 0) * cnt;
            });
            return { rounds, total };
        }

        function renderCreateBattleQueue() {
            const wrap = document.getElementById('cb-builder-queue');
            const { rounds, total } = cbBuilderSummary();
            if (wrap) {
                const items = [];
                cbSelectedCases.forEach((cnt, id) => {
                    const c = casesDB.find((x) => x.id === id); if (!c) return;
                    items.push(`<div class="cb-case-pill rounded-lg px-2 py-1 min-w-[120px]"><div class="text-[10px] font-black truncate">${c.name}</div><div class="text-[10px] text-yellow-200">x${cnt} ‚Ä¢ ${formatMoney(Number(c.price||0)*cnt)}</div></div>`);
                });
                wrap.innerHTML = items.join('') || '<div class="text-xs text-gray-500">≈Ω√°dn√© caseky zat√≠m.</div>';
            }
            const r = document.getElementById('cb-builder-rounds'); if (r) r.textContent = String(rounds);
            const t = document.getElementById('cb-builder-total'); if (t) t.textContent = formatMoney(total);
            const b = document.getElementById('cb-balance'); if (b) b.textContent = formatMoney(balanceBase || 0);
            const ready = document.getElementById('cb-selector-ready'); if (ready) ready.textContent = `Ready ${formatMoney(total)}`;
            const rr = document.getElementById('cb-ready-rounds'); if (rr) rr.textContent = String(rounds);
            const rt = document.getElementById('cb-ready-total'); if (rt) rt.textContent = formatMoney(total);
        }

        function cbCaseSelectorCategory(c) {
            const n = String(c.name || '').toLowerCase();
            const p = Number(c.price || 0);
            if (/event|halloween|xmas|christmas|limited/i.test(n)) return 'EVENT';
            if (p >= 120) return 'HIGH RISK';
            if (p >= 35) return 'PREMIUM';
            if (p >= 10) return 'BESTSELLERS';
            return 'CLASSIC';
        }

        function updateSelectorBottomBar() {
            const { rounds, total } = cbBuilderSummary();
            const rr = document.getElementById('cb-ready-rounds'); if (rr) rr.textContent = String(rounds);
            const ready = document.getElementById('cb-selector-ready'); if (ready) ready.textContent = `Ready ${formatMoney(total)}`;
            const b = document.getElementById('cb-balance'); if (b) b.textContent = formatMoney(balanceBase || 0);
        }

        function renderCaseSelectorModal() {
            const grid = document.getElementById('cb-selector-grid');
            if (!grid) return;
            if (!Array.isArray(casesDB) || casesDB.length === 0) {
                grid.innerHTML = '<div class="text-center text-gray-500 p-6">Naƒç√≠t√°m caseky‚Ä¶</div>';
                setTimeout(() => renderCaseSelectorModal(), 400);
                return;
            }
            const q = (document.getElementById('cb-selector-search')?.value || '').toLowerCase().trim();
            const all = [...casesDB].filter((c) => !q || String(c.name || '').toLowerCase().includes(q));
            const groups = new Map();
            all.forEach((c) => {
                const key = cbCaseSelectorCategory(c);
                if (!groups.has(key)) groups.set(key, []);
                groups.get(key).push(c);
            });
            const order = ['EVENT', 'HIGH RISK', 'PREMIUM', 'BESTSELLERS', 'CLASSIC'];
            grid.innerHTML = order.filter((k) => groups.has(k)).map((k) => {
                const cards = groups.get(k).map((c) => {
                    const count = Number(cbSelectedCases.get(c.id) || 0);
                    const selected = count > 0;
                    return `<div class="cb-case-pick-card ${selected ? 'ring-2 ring-[#c0f20c] selected' : ''}">
                        <div class="absolute top-2 right-2 bg-white text-black text-[10px] px-1.5 py-0.5 rounded-tl-md rounded-br-md font-black">${formatMoney(c.price)}</div>
                        ${selected ? '<div class="absolute top-2 left-2 w-6 h-6 rounded-full bg-[#c0f20c] grid place-items-center text-black"><i data-lucide="check" class="w-4 h-4"></i></div>' : ''}
                        <img src="${c.img || FALLBACK_IMG}" onerror="handleImgError(this)" class="h-20 w-full object-contain drop-shadow-[0_8px_14px_rgba(0,0,0,0.45)] mb-2 mt-2">
                        <div class="text-[11px] font-black text-gray-100 uppercase truncate mb-2">${c.name}</div>
                        ${selected ? `<div class="cb-case-pick-controls !opacity-100 !translate-y-0 bg-[#0f131d]/80 border border-white/10 rounded-lg px-2 py-1"><button onclick="updateCbCaseCount('${c.id}',-1)" class="w-7 h-7 rounded bg-white/10">-</button><div class="text-base font-black text-[#c0f20c]">${count}</div><button onclick="updateCbCaseCount('${c.id}',1)" class="w-7 h-7 rounded bg-[#c0f20c] text-black">+</button></div>` : `<div class="cb-case-pick-controls"><button onclick="updateCbCaseCount('${c.id}',-1)" class="w-7 h-7 rounded bg-white/10">-</button><div class="text-sm font-black text-[#c0f20c]">0</div><button onclick="updateCbCaseCount('${c.id}',1)" class="w-7 h-7 rounded bg-[#c0f20c] text-black">+</button></div>`}
                    </div>`;
                }).join('');
                return `<div class="mb-5"><div class="flex items-center gap-2 text-[11px] text-gray-400 font-black mb-2"><span class="text-yellow-300">///</span><span>${k}</span></div><div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3">${cards}</div></div>`;
            }).join('') || '<div class="text-center text-gray-500 py-8">≈Ω√°dn√© caseky pro filtr.</div>';
            updateSelectorBottomBar();
            lucide.createIcons();
        }

        function renderCaseSelectorGrid() { renderCaseSelectorModal(); }
        function renderCaseSelector() { renderCaseSelectorModal(); }
        function renderCBBuilderQueue() { renderCreateBattleQueue(); }
        function openCaseSelectorModal() { document.getElementById('cb-case-selector-modal')?.classList.remove('hidden'); renderCaseSelectorModal(); }
        function closeCaseSelectorModal() { document.getElementById('cb-case-selector-modal')?.classList.add('hidden'); }
        function applyCaseBattleBuilder() { closeCaseSelectorModal(); renderCreateBattleQueue(); updateSelectorBottomBar(); showToast('Queue p≈ôipravena.'); }

        function selectedCasePayload() {
            if (!cbSelectedCases || cbSelectedCases.size === 0) return null;
            const queue = [];
            let totalCost = 0;
            let totalRounds = 0;

            cbSelectedCases.forEach((count, id) => {
                const c = casesDB.find((x) => x.id === id); 
                if (!c) return;
                queue.push({ 
                    caseId: c.id, 
                    caseName: c.name, 
                    casePrice: Number(c.price || 0), 
                    caseImg: c.img || '', 
                    count: Number(count) 
                });
                totalRounds += Number(count);
                totalCost += (Number(c.price || 0) * Number(count));
            });

            if (queue.length === 0) return null;
            return { 
                caseId: queue[0].caseId, 
                caseName: queue[0].caseName, 
                casePrice: totalRounds ? (totalCost / totalRounds) : 0, 
                rounds: totalRounds, 
                caseQueue: queue 
            };
        }

        function getCaseByRoom(room) { return casesDB.find((x) => x.id === room?.caseId) || casesDB.find((x) => x.name === room?.caseName) || null; }

        async function loadCaseBattleRooms() {
            const wrap = document.getElementById('cb-open-rooms'); if (!wrap) return;
            try {
                const data = await apiRequest('/api/case-battle/rooms');
                const rooms = (data.rooms || []).filter((r) => {
                    if (cbListTab === 'mine' && String(r.creatorId || '') !== String(currentUser?._id || '')) return false;
                    if (cbModeFilter !== 'all' && String(r.gameMode || 'classic') !== cbModeFilter) return false;
                    return true;
                });

                wrap.innerHTML = rooms.map((r) => {
                    const rounds = Math.max(1, Number(r.rounds || r.totalRounds || 1));
                    const scenarioCases = Array.isArray(r.caseQueue) && r.caseQueue.length
                        ? r.caseQueue.flatMap((q) => Array.from({ length: Math.max(1, Number(q.count || 1)) }).map(() => q))
                        : [{ caseName: r.caseName || 'Case', casePrice: Number(r.casePrice || 0), caseImg: getCaseByRoom(r)?.img || FALLBACK_IMG }];

                    const scenarioHtml = scenarioCases.slice(0, 5).map((q) => {
                        const casePrice = Number(q.casePrice || r.casePrice || 0);
                        const rarityBorder = casePrice >= 120 ? '#facc15' : casePrice >= 35 ? '#ef4444' : casePrice >= 10 ? '#a855f7' : '#4b69ff';
                        return `<div class="bg-[#1a1e29] border-t-2 rounded p-1 w-12 flex flex-col items-center" style="border-top-color:${rarityBorder}"><img src="${q.caseImg || FALLBACK_IMG}" onerror="handleImgError(this)" class="h-8 object-contain"><div class="text-[8px] text-yellow-300">${formatMoney(casePrice)}</div></div>`;
                    }).join('');

                    const hiddenCount = Math.max(0, scenarioCases.length - 5);
                    const entryCost = Number(r.casePrice || 0) * rounds;

                    const capacity = Math.max(2, Number(r.capacity || 2));
                    const slots = Array.from({ length: capacity }).map((_, idx) => r.players?.[idx] || null);
                    const avatarsHtml = slots.map((pl, idx) => {
                        if (!pl) {
                            return '<div class="w-8 h-8 rounded-full border-2 border-[#1a1e29] bg-[#0d1017]"></div>';
                        }
                        const avatar = pl.bot ? CB_BOT_AVATAR : (pl.avatar || FALLBACK_IMG);
                        return `<div class="relative"><img src="${avatar}" onerror="handleImgError(this)" class="w-8 h-8 rounded-full border-2 border-[#12161f] object-cover">${idx === 0 ? '<i data-lucide="crown" class="w-3 h-3 text-yellow-400 absolute -top-1 -right-1"></i>' : ''}</div>`;
                    }).join('');

                    return `<div class="grid grid-cols-[80px_1fr_100px_150px_140px] gap-4 items-center bg-[#12161f] hover:bg-[#161a24] border border-white/5 hover:border-white/10 rounded-xl px-6 py-4 transition-all">
                        <div class="flex justify-center"><div class="w-12 h-12 transform rotate-45 border-2 border-[#c0f20c] rounded-lg shadow-[0_0_15px_rgba(192,242,12,0.15)] flex items-center justify-center overflow-hidden"><div class="-rotate-45 text-white font-black text-lg">${rounds}</div></div></div>
                        <div class="flex flex-wrap gap-2 items-center">${scenarioHtml}${hiddenCount > 0 ? `<div class="text-xs font-black text-gray-300">+${hiddenCount}</div>` : ''}</div>
                        <div class="text-green-400 font-black text-sm drop-shadow-[0_0_8px_rgba(74,222,128,0.4)]">${formatMoney(entryCost)}</div>
                        <div class="flex items-center -space-x-3">${avatarsHtml}<div class="text-gray-400 text-xs font-bold ml-4">${(r.players || []).length} / ${capacity}</div></div>
                        <div><button onclick="joinCaseBattleRoom('${r.id}')" class="border border-[#c0f20c] text-[#c0f20c] hover:bg-[#c0f20c] hover:text-black font-black uppercase text-xs px-4 py-2 rounded-lg flex items-center justify-center gap-2 transition-all w-full"><i data-lucide="eye" class="w-4 h-4"></i> View Battle</button></div>
                    </div>`;
                }).join('') || '<div class="text-gray-500 text-xs px-6 py-8">≈Ω√°dn√© otev≈ôen√© m√≠stnosti.</div>';

                lucide.createIcons();
            } catch (err) {
                wrap.innerHTML = `<div class="text-red-400 text-xs px-6 py-6">${err.message}</div>`;
            }
        }


        async function createCaseBattleRoom() {
            if (!requireAuthAction()) return;
            
            const payload = selectedCasePayload();
            if (!payload) {
                return showToast('Please select at least one case first!', true);
            }

            const mode = cbBuilderState.mode || '1v1';
            const rounds = Number(payload.rounds || 1);
            
            const btn = document.querySelector('#cb-builder-modal button[onclick="createCaseBattleRoom()"]');
            const originalText = btn ? btn.textContent : 'CREATE BATTLE';
            if (btn) { btn.textContent = 'CREATING...'; btn.disabled = true; }

            try {
                console.log('Sending Create Battle Request...', { mode, rounds, ...payload });
                
                const data = await apiRequest('/api/case-battle/create', 'POST', { 
                    mode, 
                    rounds, 
                    fillWithBots: false, 
                    teamFormat: cbBuilderState.teamFormat || '1v1', 
                    gameMode: cbBuilderState.gameMode || 'classic', 
                    privacy: cbBuilderState.privacy || 'public', 
                    ...payload 
                });

                console.log('Battle Created Successfully:', data);

                cbActiveRoomId = data.room?.id || null;
                closeCaseBattleBuilder();
                cbSetPanels(true);
                
                cbAddLog(`Battle Room Created: ${cbActiveRoomId}`);
                
                renderCaseBattleRoom(data.room, false);
                showToast('Battle created successfully!');
                
            } catch (err) { 
                console.error('Create Battle Error:', err);
                showToast(err.message || 'Failed to create battle', true); 
            } finally {
                if (btn) { btn.textContent = originalText; btn.disabled = false; }
            }
        }

        async function joinCaseBattleRoom(roomId) { if (!requireAuthAction()) return; try { const data = await apiRequest(`/api/case-battle/join/${roomId}`, 'POST'); cbActiveRoomId = roomId; cbSetPanels(true); cbAddLog('P≈ôipojeno do roomky.'); renderCaseBattleRoom(data.room, true); } catch (err) { showToast(err.message, true); } }
        async function fillCaseBattleBotSlot(slot) { if (!cbActiveRoomId) return; try { const data = await apiRequest(`/api/case-battle/fill-bot/${cbActiveRoomId}`, 'POST', { slot }); renderCaseBattleRoom(data.room, true); } catch (err) { showToast(err.message, true); } }
        async function leaveCaseBattleRoom() { if (!cbActiveRoomId) return; try { await apiRequest(`/api/case-battle/leave/${cbActiveRoomId}`, 'POST'); } catch(_e) {} cbActiveRoomId = null; cbAnimationSession += 1; cbAnimationLock = false; cbLastAnimatedSignature = ''; cbSetPanels(false); document.getElementById('cb-stage').innerHTML=''; document.getElementById('cb-log').innerHTML=''; loadCaseBattleRooms(); }
        async function startCaseBattleRoom() { if (!requireAuthAction()) return; if (!cbActiveRoomId) return showToast('Nejd≈ô√≠v vytvo≈ô/p≈ôipoj room.', true); try { const data = await apiRequest(`/api/case-battle/start/${cbActiveRoomId}`, 'POST', { forceBots: true }); cbAddLog(`Battle spu≈°tƒõn. Vstup: ${formatMoney(data.fee || 0)} / hr√°ƒç`); renderCaseBattleRoom(data.room, true); await loadSessionFromBackend(); } catch (err) { showToast(err.message, true); } }

        async function refreshCaseBattleRoom() {
            if (!cbActiveRoomId) return;
            try {
                const data = await apiRequest(`/api/case-battle/room/${cbActiveRoomId}`);
                if (cbAnimationLock) {
                    patchCaseBattleRoom(data.room);
                    return;
                }
                renderCaseBattleRoom(data.room);
            } catch (_err) { cbActiveRoomId = null; cbSetPanels(false); loadCaseBattleRooms(); }
        }

        function cbRoomSignature(room) { return `${room?.id || ''}:${room?.status || ''}:${(room?.players || []).map((p) => (p.drops || []).length).join(',')}:${room?.winnerId || ''}`; }

        function cbBuildSpinnerTrack(caseContents, winningSkin) {
            const base = Array.isArray(caseContents) && caseContents.length ? caseContents.map((it) => it.skin ? it.skin : it) : Object.values(skinsDB || {});
            const tape = Array.from({ length: 60 }).map(() => {
                const pick = base[Math.floor(Math.random() * base.length)] || { img: FALLBACK_IMG, name: 'Skin', price: 0, color: '#4b69ff' };
                return { name: pick.name || 'Skin', img: pick.img || FALLBACK_IMG, color: pick.color || '#4b69ff', price: Number(pick.price || 0) };
            });
            tape[50] = winningSkin || tape[50];
            return tape;
        }

        function cbParseTranslateX(transform) {
            if (!transform || transform === 'none') return 0;
            const m3 = transform.match(/matrix3d\(([^)]+)\)/);
            if (m3) {
                const vals = m3[1].split(',').map((x) => Number(x.trim()));
                return Number(vals[12] || 0);
            }
            const m2 = transform.match(/matrix\(([^)]+)\)/);
            if (m2) {
                const vals = m2[1].split(',').map((x) => Number(x.trim()));
                return Number(vals[4] || 0);
            }
            return 0;
        }

        function cbWearTag() {
            const tags = ['FN', 'MW', 'FT', 'WW', 'BS'];
            return tags[Math.floor(Math.random() * tags.length)];
        }

        function cbHistoryCard(drop, rIdx) {
            const color = drop?.color || '#4b69ff';
            return `<div class="bg-[#1a1e29] border border-white/5 rounded-md p-2 relative text-center group transition-all duration-300 border-t-2" style="border-top-color:${color}">
                <div class="absolute top-1 left-1 bg-black/80 px-1 text-[8px] text-gray-300 font-black rounded">${cbWearTag()}</div>
                <img src="${drop?.img || FALLBACK_IMG}" onerror="handleImgError(this)" class="h-12 object-contain mx-auto mt-2">
                <div class="text-[9px] mt-1 text-gray-300 truncate">${drop?.name || '-'}</div>
                <div class="text-yellow-400 font-bold text-[10px]">${formatMoney(drop?.price || 0)}</div>
            </div>`;
        }

        function patchCaseBattleRoom(room) {
            const rounds = Math.max(1, Number(room?.rounds || room?.totalRounds || 1));
            const totalValueEl = document.getElementById('cb-total-value');
            if (totalValueEl) totalValueEl.textContent = formatMoney(Number(room.casePrice || 0) * rounds * Math.max(1, Number(room.capacity || 1)));
            const players = room.players || [];
            const half = Math.ceil(players.length / 2);
            const team1 = players.slice(0, half).reduce((a, p) => a + Number(p.score || 0), 0);
            const team2 = players.slice(half).reduce((a, p) => a + Number(p.score || 0), 0);
            const t1 = document.getElementById('cb-team1-score');
            const t2 = document.getElementById('cb-team2-score');
            const l1 = document.getElementById('cb-team1-lead');
            const l2 = document.getElementById('cb-team2-lead');
            if (t1) t1.textContent = formatMoney(team1);
            if (t2) t2.textContent = formatMoney(team2);
            if (l1) l1.classList.toggle('hidden', team1 <= team2);
            if (l2) l2.classList.toggle('hidden', team2 <= team1);
            document.getElementById('cb-team-left-head')?.classList.toggle('from-blue-900/20', team1 > team2);
            document.getElementById('cb-team-left-head')?.classList.toggle('bg-gradient-to-r', team1 > team2);
            document.getElementById('cb-team-right-head')?.classList.toggle('from-orange-900/20', team2 > team1);
            document.getElementById('cb-team-right-head')?.classList.toggle('bg-gradient-to-l', team2 > team1);
        }

        function applyCaseBattleLeaderStylesByScores(scores) {
            const top = Math.max(...scores, 0);
            scores.forEach((score, idx) => {
                const crown = document.getElementById(`cb-leader-crown-${idx}`);
                const scoreEl = document.getElementById(`cb-score-${idx}`);
                const card = document.getElementById(`cb-player-${idx}`);
                const leader = score >= top && top > 0;
                if (crown) crown.classList.toggle('hidden', !leader);
                if (scoreEl) {
                    scoreEl.classList.toggle('text-green-400', leader);
                    scoreEl.classList.toggle('text-gray-400', !leader);
                }
                if (card) {
                    card.classList.toggle('ring-1', leader);
                    card.classList.toggle('ring-yellow-300/50', leader);
                }
            });
        }

        function triggerEndgameSequence(room, finalScores) {
            const winnerId = String(room?.winnerId || '');
            (room.players || []).forEach((pl, idx) => {
                const overlay = document.getElementById(`cb-endgame-${idx}`);
                if (!overlay) return;
                const won = winnerId ? String(pl.userId) === winnerId : Number(finalScores[idx] || 0) >= Math.max(...finalScores, 0);
                if (won) {
                    overlay.className = 'absolute inset-0 z-50 flex items-center justify-center bg-gradient-to-t from-green-900/60 to-transparent backdrop-blur-sm';
                    overlay.innerHTML = `<div class="text-center"><div class="text-[11px] uppercase text-green-200 font-black mb-1">Winner</div><div class="text-3xl font-black text-green-300 drop-shadow-[0_0_14px_rgba(34,197,94,0.55)]">${formatMoney(finalScores[idx] || 0)}</div></div>`;
                } else {
                    overlay.className = 'absolute inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-md';
                    overlay.innerHTML = `<div class="text-center"><i data-lucide="thumbs-down" class="w-20 h-20 text-red-500/30 mx-auto"></i><div class="text-red-400 font-black text-sm mt-1">You Lost</div></div>`;
                }
                overlay.classList.remove('hidden');
            });
            const rc = document.getElementById('cb-round-counter');
            if (rc) rc.textContent = 'Battle Finished';
            lucide.createIcons();
        }

        async function animateCaseBattleRounds(room) {
            if (cbAnimationLock) return;
            cbAnimationLock = true;
            const rounds = Math.max(1, Number(room?.totalRounds || room?.rounds || 1));
            const players = Array.isArray(room?.players) ? room.players : [];
            const liveScores = players.map((p) => Number(p?.score || 0));
            const wearPool = ['FN', 'MW', 'FT', 'WW', 'BS'];
            let tickInterval = null;

            try {
                for (let round = 0; round < rounds; round += 1) {
                    const roundCounter = document.getElementById('cb-round-counter');
                    if (roundCounter) roundCounter.textContent = `Round ${round + 1} of ${rounds}`;

                    const queueEntry = Array.isArray(room.caseQueue) ? room.caseQueue[round] : null;
                    const queuedCase = queueEntry?.caseId ? getCaseById(queueEntry.caseId) : null;
                    const currentCase = queuedCase || getCaseByRoom(room) || casesDB[0] || { contents: [] };
                    const caseSkinsPool = Array.isArray(currentCase.contents) && currentCase.contents.length
                        ? currentCase.contents.map((entry) => entry.skin).filter(Boolean)
                        : [{ img: FALLBACK_IMG, name: 'Fallback Skin', price: 0, color: '#4b69ff' }];

                    players.forEach((pl, idx) => {
                        const track = document.getElementById(`cb-spin-track-${idx}`);
                        if (!track) return;
                        const winDrop = pl?.drops?.[round] || pl?.drops?.[pl?.drops?.length - 1] || caseSkinsPool[Math.floor(Math.random() * caseSkinsPool.length)] || { img: FALLBACK_IMG, name: 'Skin', price: 0, color: '#4b69ff' };
                        let tapeHtml = '';

                        for (let i = 0; i < 60; i += 1) {
                            const item = i === 50
                                ? winDrop
                                : caseSkinsPool[Math.floor(Math.random() * caseSkinsPool.length)] || caseSkinsPool[0];
                            tapeHtml += `
                                <div class="flex-shrink-0 w-[140px] h-full flex flex-col items-center justify-center px-2 border-b-4 bg-gradient-to-t from-white/5 to-transparent transition-all" style="border-color: ${item.color || '#4b69ff'}">
                                    <img src="${item.img || FALLBACK_IMG}" onerror="handleImgError(this)" class="h-20 w-full object-contain drop-shadow-[0_10px_15px_rgba(0,0,0,0.5)]">
                                    <div class="text-[10px] text-gray-300 font-bold uppercase truncate w-full text-center mt-3">${item.name || 'Skin'}</div>
                                </div>
                            `;
                        }

                        track.innerHTML = tapeHtml;
                        track.style.transition = 'none';
                        track.style.transform = 'translate3d(0px, 0, 0)';
                        void track.offsetWidth;
                        const stopOffset = (50 * 140) - (track.parentElement.clientWidth / 2) + 70 + (Math.random() * 40 - 20);
                        track.style.transition = 'transform 6.5s cubic-bezier(0.12, 0, 0.1, 1)';
                        track.style.transform = `translate3d(-${stopOffset}px, 0, 0)`;
                    });

                    let lastStep = -1;
                    tickInterval = setInterval(() => {
                        const sampleTrack = document.getElementById('cb-spin-track-0');
                        if (!sampleTrack) return;
                        const currentX = Math.abs(cbParseTranslateX(getComputedStyle(sampleTrack).transform));
                        const currentStep = Math.floor(currentX / 140);
                        if (currentStep !== lastStep) {
                            lastStep = currentStep;
                            SoundEngine.playTick();
                        }
                    }, 60);

                    await new Promise((r) => setTimeout(r, 6800));

                    if (tickInterval) {
                        clearInterval(tickInterval);
                        tickInterval = null;
                    }

                    players.forEach((pl, idx) => {
                        const drop = pl?.drops?.[round] || pl?.drops?.[pl?.drops?.length - 1];
                        if (!drop) return;
                        liveScores[idx] = Number(liveScores[idx] || 0) + Number(drop.price || 0);
                        const scoreEl = document.getElementById(`cb-score-${idx}`);
                        if (scoreEl) scoreEl.textContent = formatMoney(liveScores[idx]);

                        const wear = wearPool[Math.floor(Math.random() * wearPool.length)];
                        const historyGrid = document.getElementById(`cb-history-${idx}`);
                        if (historyGrid) {
                            historyGrid.insertAdjacentHTML('afterbegin', `
                                <div class="bg-[#1a1e29] border border-white/5 border-t-2 rounded-md p-2 relative text-center group transition-all duration-300" style="border-top-color:${drop.color || '#4b69ff'}">
                                    <div class="absolute top-1 left-1 bg-black/80 px-1 text-[8px] text-gray-300 font-black rounded">${wear}</div>
                                    <img src="${drop.img || FALLBACK_IMG}" onerror="handleImgError(this)" class="h-12 w-full object-contain mb-1 drop-shadow-[0_8px_12px_rgba(0,0,0,0.45)]">
                                    <div class="text-[10px] font-black uppercase truncate">${drop.name || 'Skin'}</div>
                                    <div class="text-yellow-400 font-bold text-[10px]">${formatMoney(drop.price || 0)}</div>
                                </div>
                            `);
                        }
                    });

                    updateBattleLeaders(room, liveScores);
                    SoundEngine.playWin('milspec');
                    await new Promise((resolve) => setTimeout(resolve, 1500));
                }

                triggerEndgameSequence(room, liveScores);
            } catch (error) {
                console.error('Case Battle animation failed:', error);
            } finally {
                if (tickInterval) clearInterval(tickInterval);
                cbAnimationLock = false;
            }
        }

        function setCasesCategoryFilter(category) {
            casesCategoryFilter = category;
            ['all','featured','regular','cheap','premium','high-risk'].forEach((key) => {
                const el = document.getElementById(`tab-${key}`);
                if (!el) return;
                const active = key === category;
                el.classList.toggle('bg-white/10', active);
                el.classList.toggle('text-white', active);
                el.classList.toggle('text-gray-500', !active);
                el.classList.toggle('hover:text-gray-300', !active);
            });
            renderCases();
        }

        function setCasesAffordableOnly(nextValue) {
            casesAffordableOnly = !!nextValue;
            const btn = document.getElementById('cases-affordable-toggle');
            if (btn) {
                btn.classList.toggle('bg-white/10', casesAffordableOnly);
                btn.classList.toggle('text-white', casesAffordableOnly);
                btn.classList.toggle('border-white/30', casesAffordableOnly);
            }
            renderCases();
        }

        function toggleCasesSortOrder() {
            casesSortDirection = casesSortDirection === 'asc' ? 'desc' : 'asc';
            const btn = document.getElementById('cases-sort-toggle');
            if (btn) btn.textContent = casesSortDirection === 'asc' ? 'Price ‚Üë' : 'Price ‚Üì';
            renderCases();
        }

        function showToast(text, isError = false) {
            const t = document.getElementById('toast');
            t.textContent = text;
            t.style.backgroundColor = isError ? '#ef4444' : '#facc15';
            t.style.color = isError ? 'white' : 'black';
            t.style.borderColor = isError ? '#dc2626' : '#fde047';
            t.classList.remove('opacity-0', 'translate-y-10');
            setTimeout(() => t.classList.add('opacity-0', 'translate-y-10'), 3000);
        }

        function switchPage(id) {
            if(isSpinning) return;
            if (id === 'admin' && !currentUser?.isAdmin) {
                showToast('Admin panel je jen pro admin √∫ƒçet.', true);
                id = 'cases';
            }
            if (id === 'user-profile' && !selectedProfile) {
                id = 'profile';
            }

            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            const page = document.getElementById(`page-${id}`);
            if (page) page.classList.remove('hidden');
            
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            const activeNav = Array.from(document.querySelectorAll('.nav-link')).find(l => l.getAttribute('onclick').includes(`'${id}'`));
            if(activeNav) activeNav.classList.add('active');

            if(id === 'inventory') renderInventory();
            if(id === 'upgrade') renderUpgrader();
            if(id === 'admin') loadAdminUsers();
            if(id === 'profile') { loadFriends(); }
            if(id === 'case-battle') initCaseBattle();
            if(id !== 'case-battle' && cbPollTimer) { clearInterval(cbPollTimer); cbPollTimer = null; cbAnimationSession += 1; cbAnimationLock = false; }
            if(id === 'giveaways') initGiveaways();
            activeCaseId = null; 
        }

        function addFreeMoney() {
            if (currentUser) {
                showToast('Na p≈ôihl√°≈°en√©m √∫ƒçtu nelze p≈ôidat free pen√≠ze.', true);
                return;
            }
            balanceBase += 1000;
            updateUI();
            showToast('Demo: p≈ôid√°no 1000 EUR');
            initAudio();
        }

        // --- FULL-SCREEN V√ùHERN√ç POPUP A EFEKTY ---
        function createParticles(color) {
            const container = document.getElementById('particles-container');
            container.innerHTML = ''; // Vyƒçistit star√©
            for(let i=0; i<60; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.backgroundColor = color;
                const size = Math.random() * 8 + 4;
                p.style.width = size + 'px';
                p.style.height = size + 'px';
                p.style.left = '50%';
                p.style.top = '50%';
                
                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 400 + 100;
                p.style.setProperty('--tx', `${Math.cos(angle) * velocity}px`);
                p.style.setProperty('--ty', `${Math.sin(angle) * velocity}px`);
                
                container.appendChild(p);
            }
        }

        function showWinModal(skin) {
            const modal = document.getElementById('win-modal');
            const img = document.getElementById('win-image');
            
            document.getElementById('win-name').textContent = skin.name;
            document.getElementById('win-price').textContent = formatMoney(skin.price);
            document.getElementById('win-sell-price').textContent = formatMoney(skin.price);
            document.getElementById('win-bg-glow').style.backgroundColor = skin.color;
            
            img.src = skin.img;
            
            modal.classList.remove('hidden');
            // Mal√Ω delay pro CSS tranzici
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                img.classList.add('win-pop');
                
                // Efekty pokud je to red/gold
                if(skin.color === '#eb4b4b' || skin.color === '#ebca44') {
                    createParticles(skin.color);
                }
                
                SoundEngine.playWin(skin.rarityName);
            }, 50);

            // Nastaven√≠ tlaƒç√≠tek
            document.getElementById('btn-win-sell').onclick = () => {
                balanceBase += skin.price;
                updateUI();
                showToast(`Z√≠sk√°no ${formatMoney(skin.price)}`);
                closeWinModal();
            };
            
            document.getElementById('btn-win-keep').onclick = () => {
                addToInventory(skin);
                showToast(`Ulo≈æeno do invent√°≈ôe`);
                closeWinModal();
            };
        }

        function closeWinModal() {
            const modal = document.getElementById('win-modal');
            modal.classList.add('opacity-0');
            document.getElementById('win-image').classList.remove('win-pop');
            setTimeout(() => { modal.classList.add('hidden'); }, 300);
        }

        // --- BEDNY ---
        function renderCases() {
            const grid = document.getElementById('cases-grid');
            if (!grid) return;

            const normalizeCategory = (c) => {
                const source = String(c.category || '').toLowerCase();
                if (source.includes('event')) return 'featured';
                if (source.includes('creator')) return 'featured';
                if (source.includes('premium')) return 'premium';
                if (source.includes('risk')) return 'high-risk';
                if (source.includes('regular')) return 'regular';
                if (source.includes('cheap')) return 'cheap';
                const p = Number(c.price || 0);
                if (p <= 10) return 'cheap';
                if (p < 35) return 'regular';
                if (p < 120) return 'premium';
                return 'high-risk';
            };

            const searchValue = (document.getElementById('cases-search')?.value || '').trim().toLowerCase();
            let filtered = casesDB.filter((c) => {
                const price = Number(c.price || 0);
                if (searchValue && !String(c.name || '').toLowerCase().includes(searchValue)) return false;
                if (casesAffordableOnly && price > balanceBase) return false;
                const normalized = normalizeCategory(c);
                if (casesCategoryFilter === 'all') return true;
                if (casesCategoryFilter === 'featured') return normalized === 'featured' || /event|hot|best|limited/i.test(c.name || '');
                if (casesCategoryFilter === 'cheap') return normalized === 'cheap';
                if (casesCategoryFilter === 'regular') return normalized === 'regular';
                if (casesCategoryFilter === 'premium') return normalized === 'premium';
                if (casesCategoryFilter === 'high-risk') return normalized === 'high-risk';
                return true;
            });

            filtered.sort((a, b) => (casesSortDirection === 'asc' ? Number(a.price || 0) - Number(b.price || 0) : Number(b.price || 0) - Number(a.price || 0)));

            const groups = [
                { key: 'featured', label: 'FEATURED' },
                { key: 'regular', label: 'REGULAR' },
                { key: 'premium', label: 'PREMIUM' },
                { key: 'high-risk', label: 'HIGH RISK' }
            ];

            const rarityGlow = (color) => {
                const c = String(color || '').toLowerCase();
                if (c.includes('ebca44') || c.includes('yellow') || c.includes('gold')) return 'from-yellow-400/25';
                if (c.includes('eb4b4b') || c.includes('red')) return 'from-red-500/25';
                if (c.includes('d32ce6') || c.includes('purple')) return 'from-purple-500/25';
                if (c.includes('pink')) return 'from-pink-500/25';
                return 'from-blue-500/25';
            };

            const sectionHtml = groups.map((group) => {
                const items = filtered.filter((c) => normalizeCategory(c) === group.key);
                if (!items.length) return '';
                const cards = items.map((c) => `
                    <div onclick="openCaseView('${c.id}')" class="relative bg-[#161a24] hover:bg-[#1a1e29] border border-white/5 rounded-xl p-4 min-h-[280px] xl:min-h-[320px] flex flex-col items-center justify-center cursor-pointer transition-all duration-300 hover:-translate-y-1 hover:shadow-[0_10px_30px_rgba(0,0,0,0.5)] group">
                        <div class="absolute top-3 right-3 bg-white text-black font-black text-xs px-3 py-1.5 rounded-md shadow-md z-20">${formatMoney(c.price)}</div>
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] ${rarityGlow(c.color)} to-transparent opacity-0 group-hover:opacity-100 transition-opacity z-0 rounded-xl"></div>
                        <img src="${c.img || FALLBACK_IMG}" onerror="handleImgError(this)" class="h-48 xl:h-56 w-full object-contain mx-auto relative z-10 drop-shadow-[0_15px_25px_rgba(0,0,0,0.5)] group-hover:scale-125 transition-transform duration-500 ease-out">
                        <div class="mt-4 text-sm font-black uppercase text-gray-300 group-hover:text-white tracking-widest relative z-10 text-center">${c.name}</div>
                    </div>
                `).join('');

                return `
                    <div class="col-span-full flex items-center justify-center gap-4 my-8">
                        <div class="h-px bg-white/10 flex-1"></div>
                        <div class="text-sm font-black text-gray-500 uppercase tracking-widest">/// ${group.label} ///</div>
                        <div class="h-px bg-white/10 flex-1"></div>
                    </div>
                    ${cards}
                `;
            }).join('');

            grid.innerHTML = `<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 p-6">${sectionHtml || '<div class=\"col-span-full text-center py-16 text-gray-500 font-black uppercase\">No cases for selected filter.</div>'}</div>`;
            lucide.createIcons();
        }

        // Vlo≈æ pod funkci renderCases (kolem ≈ô√°dku 815)
        document.addEventListener('click', (e) => {
            // Najde nejbli≈æ≈°√≠ rodiƒçovsk√Ω element, kter√Ω m√° ID bedny
            const caseCard = e.target.closest('[onclick^="openCaseView"]');
            if (caseCard && !isSpinning) {
                // Z√≠sk√° ID bedny z onclick atributu
                const match = caseCard.getAttribute('onclick').match(/'([^']+)'/);
                if (match) {
                    openCaseView(match[1]);
                }
            }
        });

        function rollCaseSkin(caseObj) {
            const roll = Math.random() * 100;
            let sum = 0;
            let win = caseObj.contents[0].skin;
            for(const item of caseObj.contents) {
                sum += item.chance;
                if(roll <= sum) { win = item.skin; break; }
            }
            return win;
        }

        function renderMultiResultCard(skin) {
            return `<div class="bg-[#14171c] border-b-4 rounded-xl p-2 text-center" style="border-color:${skin.color}"><img src="${skin.img}" onerror="handleImgError(this)" class="h-16 w-full object-contain mb-1"><div class="text-[9px] font-black uppercase truncate">${skin.name}</div><div class="text-[10px] text-yellow-300 font-bold">${formatMoney(skin.price)}</div></div>`;
        }

        function getOpenCount() {
            const countSel = document.getElementById('open-count');
            return Math.max(1, Math.min(5, parseInt(countSel?.value || '1', 10)));
        }

        function fillTrackWithCaseSkins(track, caseObj, winningSkin = null) {
            const totalItems = 60;
            const winningIndex = 50;
            let html = '';
            for(let j=0;j<totalItems;j++) {
                const skin = (winningSkin && j === winningIndex)
                    ? winningSkin
                    : caseObj.contents[Math.floor(Math.random()*caseObj.contents.length)].skin;
                html += `<div class="spinner-item" style="border-color:${skin.color}"><img src="${skin.img}" data-alts="${(skin.imgAlts||[]).join('|')}" onerror="handleImgError(this)"><div class="text-[10px] font-black uppercase text-gray-300 mt-2 truncate w-full text-center">${skin.name}</div></div>`;
            }
            track.innerHTML = html;
        }
        let caseViewSelectedCount = 1;
        let caseViewFastOpen = false;
        let caseViewSoundOn = true;

        function ensureSpinnerRows(count, caseObj = null) {
            const normalizedCount = Math.max(1, Math.min(5, Number(count) || 1));
            caseViewSelectedCount = normalizedCount;
            const resolvedCase = caseObj || casesDB.find(x => x.id === activeCaseId) || null;
            const stack = document.getElementById('spinner-stack');
            const openButton = document.getElementById('btn-open-case');
            const countButtons = Array.from(document.querySelectorAll('#case-open-count-buttons [data-open-count]'));

            countButtons.forEach(btn => {
                const value = Number(btn.dataset.openCount || '1');
                if (value === normalizedCount) {
                    btn.className = 'w-10 h-10 flex items-center justify-center rounded-md font-black text-sm transition-all bg-[#c0f20c] text-black shadow-[0_0_15px_rgba(192,242,12,0.3)]';
                } else {
                    btn.className = 'w-10 h-10 flex items-center justify-center rounded-md font-black text-sm transition-all bg-[#1a1e29] text-gray-400 hover:bg-white/10';
                }
            });

            if (openButton && resolvedCase) {
                openButton.textContent = `OPEN FOR ${formatMoney((resolvedCase.price || 0) * normalizedCount)}`;
            }

            if (!stack) return [];
            const skinsPool = resolvedCase && Array.isArray(resolvedCase.contents) ? resolvedCase.contents.map(item => item.skin).filter(Boolean) : [];
            const rowsHtml = Array.from({ length: normalizedCount }, (_, rowIndex) => {
                const prefillItems = Array.from({ length: 60 }, () => {
                    const skin = skinsPool.length ? skinsPool[Math.floor(Math.random() * skinsPool.length)] : { name: 'Unknown', img: FALLBACK_IMG, color: '#4b69ff' };
                    return `<div class="flex-shrink-0 w-[130px] h-full flex flex-col items-center justify-center px-2 border-b-4 bg-gradient-to-t from-white/5 to-transparent" style="border-color:${skin.color || '#4b69ff'}"><img src="${skin.img || FALLBACK_IMG}" onerror="handleImgError(this)" class="h-20 w-full object-contain drop-shadow-md"><div class="text-[10px] text-gray-300 font-bold uppercase truncate w-full text-center mt-2">${skin.name || 'Unknown'}</div></div>`;
                }).join('');
                return `<div class="spinner-container h-32 bg-[#0d1017] border border-white/5 rounded-xl relative overflow-hidden shadow-inner" data-spin-row="${rowIndex}"><div class="absolute inset-y-0 left-1/2 -translate-x-1/2 w-1 bg-[#c0f20c] z-30 shadow-[0_0_15px_rgba(192,242,12,0.8)]"></div><div class="absolute left-0 top-0 h-full flex items-center will-change-transform z-20" id="spinner-track-${rowIndex}">${prefillItems}</div></div>`;
            }).join('');

            stack.innerHTML = rowsHtml;
            lucide.createIcons();
            return Array.from(stack.querySelectorAll('[id^="spinner-track-"]'));
        }

        async function spinCase(caseObj, count = 1) {
            if (isSpinning || !caseObj) return;
            if (!requireAuthAction()) return;
            initAudio();
            const normalizedCount = Math.max(1, Math.min(5, Number(count) || 1));
            const totalCost = (caseObj.price || 0) * normalizedCount;
            if (balanceBase < totalCost) {
                showToast(`Nem√°≈° dostatek penƒõz (${formatMoney(totalCost)})`, true);
                return;
            }

            isSpinning = true;
            balanceBase -= totalCost;
            updateUI();

            const controlsPanel = document.getElementById('case-view-controls');
            const actionButton = document.getElementById('btn-open-case');
            const countButtons = Array.from(document.querySelectorAll('#case-open-count-buttons [data-open-count]'));
            const fastButton = document.getElementById('case-fast-open-toggle');
            const soundButton = document.getElementById('case-sound-toggle');
            const tracks = ensureSpinnerRows(normalizedCount, caseObj);
            const winningSkins = [];
            const rowMeta = [];
            const itemWidth = 130;

            if (controlsPanel) controlsPanel.classList.add('opacity-60');
            if (actionButton) {
                actionButton.disabled = true;
                actionButton.textContent = normalizedCount > 1 ? `OPENING ${normalizedCount} CASES...` : 'OPENING CASE...';
            }
            countButtons.forEach(btn => { btn.disabled = true; });
            if (fastButton) fastButton.disabled = true;
            if (soundButton) soundButton.disabled = true;

            for (let rowIndex = 0; rowIndex < normalizedCount; rowIndex++) {
                const track = tracks[rowIndex];
                if (!track) continue;
                const winningSkin = rollCaseSkin(caseObj);
                winningSkins.push(winningSkin);
                const tape = Array.from({ length: 60 }, (_, itemIndex) => {
                    const skin = itemIndex === 50 ? winningSkin : caseObj.contents[Math.floor(Math.random() * caseObj.contents.length)].skin;
                    return `<div class="flex-shrink-0 w-[130px] h-full flex flex-col items-center justify-center px-2 border-b-4 bg-gradient-to-t from-white/5 to-transparent transition-all" style="border-color:${skin.color || '#4b69ff'}"><img src="${skin.img || FALLBACK_IMG}" onerror="handleImgError(this)" class="h-20 w-full object-contain drop-shadow-md"><div class="text-[10px] text-gray-300 font-bold uppercase truncate w-full text-center mt-2">${skin.name || 'Unknown'}</div></div>`;
                }).join('');

                track.style.transition = 'none';
                track.style.transform = 'translate3d(0px, 0, 0)';
                track.innerHTML = tape;
                void track.offsetWidth;

                const containerWidth = track.parentElement ? track.parentElement.clientWidth : 0;
                const randomOffset = Math.random() * 40 - 20;
                const stopOffset = (50 * itemWidth) - (containerWidth / 2) + 65 + randomOffset;
                track.style.transition = caseViewFastOpen ? 'transform 0.2s linear' : 'transform 6.5s cubic-bezier(0.12, 0, 0.1, 1)';
                track.style.transform = `translate3d(-${stopOffset}px, 0, 0)`;
                rowMeta.push({ track, stopOffset });
            }

            let rafId = null;
            let lastStep = -1;
            const shouldPlaySound = caseViewSoundOn;
            const readTranslateX = (element) => {
                const t = getComputedStyle(element).transform;
                if (!t || t === 'none') return 0;
                const matrix3d = t.match(/^matrix3d\((.+)\)$/);
                if (matrix3d) {
                    const parts = matrix3d[1].split(',').map(v => Number(v.trim()));
                    return Number.isFinite(parts[12]) ? parts[12] : 0;
                }
                const matrix = t.match(/^matrix\((.+)\)$/);
                if (matrix) {
                    const parts = matrix[1].split(',').map(v => Number(v.trim()));
                    return Number.isFinite(parts[4]) ? parts[4] : 0;
                }
                return 0;
            };

            const tickLoop = () => {
                if (!rowMeta.length || !shouldPlaySound || caseViewFastOpen) return;
                const leadTrack = rowMeta[0].track;
                const currentX = Math.abs(readTranslateX(leadTrack));
                const currentStep = Math.floor(currentX / itemWidth);
                if (currentStep > lastStep) {
                    lastStep = currentStep;
                    SoundEngine.playTick();
                }
                rafId = requestAnimationFrame(tickLoop);
            };

            if (!caseViewFastOpen) {
                rafId = requestAnimationFrame(tickLoop);
                await new Promise(r => setTimeout(r, 6800));
            } else {
                await new Promise(r => setTimeout(r, 260));
            }

            if (rafId) cancelAnimationFrame(rafId);

            try {
                if (normalizedCount === 1 && winningSkins[0]) {
                    showWinModal(winningSkins[0]);
                } else {
                    let totalWin = 0;
                    winningSkins.forEach(skin => {
                        addToInventory(skin);
                        totalWin += skin.price || 0;
                    });
                    if (caseViewSoundOn) SoundEngine.playWin('milspec');
                    showToast(`Opened ${normalizedCount} cases ‚Ä¢ Total win ${formatMoney(totalWin)}`);
                }
            } finally {
                isSpinning = false;
                if (controlsPanel) controlsPanel.classList.remove('opacity-60');
                if (actionButton) {
                    actionButton.disabled = false;
                    actionButton.textContent = `OPEN FOR ${formatMoney((caseObj.price || 0) * caseViewSelectedCount)}`;
                }
                countButtons.forEach(btn => { btn.disabled = false; });
                if (fastButton) fastButton.disabled = false;
                if (soundButton) soundButton.disabled = false;
            }
        }

        function openCaseView(id) {
            activeCaseId = id;
            const caseObj = casesDB.find(c => c.id === id);
            if (!caseObj) {
                showToast('Bedna nebyla nalezena', true);
                return;
            }

            const nameEl = document.getElementById('view-case-name');
            const priceEl = document.getElementById('view-case-price');
            const imageEl = document.getElementById('view-case-image');
            const contentsEl = document.getElementById('view-case-contents');
            const openBtn = document.getElementById('btn-open-case');
            const fastButton = document.getElementById('case-fast-open-toggle');
            const soundButton = document.getElementById('case-sound-toggle');

            if (nameEl) nameEl.textContent = caseObj.name || 'CASE';
            if (priceEl) priceEl.textContent = formatMoney(caseObj.price || 0);
            if (imageEl) {
                imageEl.src = caseObj.img || FALLBACK_IMG;
                imageEl.alt = caseObj.name || 'Case';
            }

            const sortedContents = [...(caseObj.contents || [])].sort((a, b) => (b.skin?.price || 0) - (a.skin?.price || 0));
            if (contentsEl) {
                contentsEl.innerHTML = sortedContents.map(item => {
                    const skin = item.skin || {};
                    const chanceValue = Number(item.chance || 0);
                    const chanceText = chanceValue < 1 ? `${chanceValue.toFixed(3)}%` : `${chanceValue.toFixed(2)}%`;
                    return `<div class="bg-[#161a24] border-t-2 rounded-lg p-3 relative flex flex-col items-center group transition-all hover:-translate-y-1" style="border-top-color:${skin.color || '#4b69ff'}"><div class="absolute top-2 left-2 text-[9px] font-bold text-gray-500">${chanceText}</div><img src="${skin.img || FALLBACK_IMG}" onerror="handleImgError(this)" class="h-16 object-contain drop-shadow-md mt-3"><div class="text-[10px] text-gray-300 font-black uppercase text-center mt-2 leading-tight">${skin.weapon || ''} ${skin.skin || ''}</div><div class="text-[11px] font-black mt-2" style="color:${skin.color || '#facc15'}">${formatMoney(skin.price || 0)}</div></div>`;
                }).join('');
            }

            caseViewSelectedCount = 1;
            ensureSpinnerRows(1, caseObj);

            if (openBtn) {
                openBtn.disabled = false;
                openBtn.textContent = `OPEN FOR ${formatMoney(caseObj.price || 0)}`;
                openBtn.onclick = () => spinCase(caseObj, caseViewSelectedCount);
            }

            if (fastButton) {
                fastButton.className = `bg-[#1a1e29] w-10 h-10 rounded-md flex items-center justify-center transition-colors ${caseViewFastOpen ? 'text-[#c0f20c]' : 'text-gray-400 hover:text-white'}`;
                fastButton.onclick = () => {
                    caseViewFastOpen = !caseViewFastOpen;
                    fastButton.className = `bg-[#1a1e29] w-10 h-10 rounded-md flex items-center justify-center transition-colors ${caseViewFastOpen ? 'text-[#c0f20c]' : 'text-gray-400 hover:text-white'}`;
                };
            }

            if (soundButton) {
                soundButton.className = `bg-[#1a1e29] w-10 h-10 rounded-md flex items-center justify-center transition-colors ${caseViewSoundOn ? 'text-white' : 'text-gray-500'}`;
                soundButton.innerHTML = caseViewSoundOn ? '<i data-lucide="volume-2" class="w-4 h-4"></i>' : '<i data-lucide="volume-x" class="w-4 h-4"></i>';
                soundButton.onclick = () => {
                    caseViewSoundOn = !caseViewSoundOn;
                    soundButton.className = `bg-[#1a1e29] w-10 h-10 rounded-md flex items-center justify-center transition-colors ${caseViewSoundOn ? 'text-white' : 'text-gray-500'}`;
                    soundButton.innerHTML = caseViewSoundOn ? '<i data-lucide="volume-2" class="w-4 h-4"></i>' : '<i data-lucide="volume-x" class="w-4 h-4"></i>';
                    lucide.createIcons();
                };
            }

            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById('page-case-view').classList.remove('hidden');
            lucide.createIcons();
        }

        function startSpinner(caseObj) { spinCase(caseObj, 1); }

        // --- INVENT√Å≈ò ---
        function addToInventory(skin) {
            userInventory.unshift({ ...skin, uid: Date.now() + Math.random().toString(36).substring(7) });
            updateUI();
        }

        function renderInventory() {
            const grid = document.getElementById('inventory-grid');
            const stats = document.getElementById('inv-stats');
            if(!grid) return;

            if(userInventory.length === 0) {
                grid.innerHTML = `<div class="col-span-full text-center text-gray-500 py-20 font-bold uppercase">Invent√°≈ô je pr√°zdn√Ω.</div>`;
                stats.textContent = `0 p≈ôedmƒõt≈Ø v hodnotƒõ 0.00 EUR`;
                return;
            }

            let displayItems = userInventory;
            
            // Aplikuj filtr
            const filterVal = document.getElementById('inv-filter')?.value || 'all';
            if(filterVal === 'blue') displayItems = displayItems.filter(i => i.color === '#4b69ff');
            else if(filterVal === 'purple') displayItems = displayItems.filter(i => i.color === '#8847ff');
            else if(filterVal === 'pink') displayItems = displayItems.filter(i => i.color === '#d32ee6');
            else if(filterVal === 'red') displayItems = displayItems.filter(i => i.color === '#eb4b4b');
            else if(filterVal === 'gold') displayItems = displayItems.filter(i => i.color === '#ebca44');
            else if(filterVal === 'knives') displayItems = displayItems.filter(i => KNIFE_TYPES.some(k => i.weapon === k));

            // Aplikuj t≈ô√≠dƒõn√≠
            const sortVal = document.getElementById('inv-sort')?.value || 'newest';
            if(sortVal === 'price-high') displayItems.sort((a, b) => b.price - a.price);
            else if(sortVal === 'price-low') displayItems.sort((a, b) => a.price - b.price);
            else if(sortVal === 'name') displayItems.sort((a, b) => a.name.localeCompare(b.name));

            let totalVal = 0;
            grid.innerHTML = displayItems.map((item, idx) => {
                totalVal += item.price;
                return `
                <div class="bg-[#14171c] p-4 rounded-2xl border-b-4 group relative overflow-hidden transition-all hover:scale-105 shadow-lg item-float" style="border-color: ${item.color}; animation-delay: ${idx * 50}ms;">
                    <div class="absolute inset-0 opacity-0 group-hover:opacity-10 transition-opacity" style="background-color: ${item.color}"></div>
                    <img src="${item.img}" data-alts="${(item.imgAlts||[]).join('|')}" onerror="handleImgError(this)" class="w-full h-24 object-contain drop-shadow-xl group-hover:scale-110 transition-transform">
                    <div class="mt-3 text-center">
                        <div class="text-[10px] font-black uppercase text-gray-400 truncate">${item.name}</div>
                        <div class="text-sm font-black text-white mt-1">${formatMoney(item.price)}</div>
                    </div>
                    <button onclick="queueItemForUpgrade('${item.uid}')" class="absolute top-2 left-2 opacity-0 group-hover:opacity-100 bg-purple-500/85 hover:bg-purple-500 text-white p-2 rounded-lg transition-all shadow-lg backdrop-blur-sm" title="Upgradnout skin">
                        <i data-lucide="arrow-up-right" class="w-4 h-4"></i>
                    </button>
                    <button onclick="sellSkin('${item.uid}')" class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 bg-red-500/80 hover:bg-red-500 text-white p-2 rounded-lg transition-all shadow-lg backdrop-blur-sm">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </div>`;
            }).join('');
            
            stats.textContent = `${displayItems.length} p≈ôedmƒõt≈Ø v hodnotƒõ ${formatMoney(totalVal)}`;
            lucide.createIcons();
        }

        function filterInventory() {
            renderInventory();
        }

        function sortInventory() {
            renderInventory();
        }

        function queueItemForUpgrade(uid) {
            const item = userInventory.find((i) => i.uid === uid);
            if (!item) return;
            const emptyIdx = upgInputs.findIndex((x) => !x);
            if (emptyIdx === -1) {
                showToast('V upgraderu u≈æ m√°≈° 3 skiny.', true);
                return;
            }
            upgInputs[emptyIdx] = item;
            switchPage('upgrade');
            renderUpgrader();
            showToast('Skin p≈ôid√°n do upgraderu.');
        }

        function sellSkin(uid) {
            const idx = userInventory.findIndex(i => i.uid === uid);
            if(idx > -1) {
                balanceBase += userInventory[idx].price;
                userInventory.splice(idx, 1);
                updateUI(); renderInventory();
                for(let i=0; i<3; i++) { if(upgInputs[i] && upgInputs[i].uid === uid) upgInputs[i] = null; }
            }
        }

        function sellAllSkins() {
            if(userInventory.length === 0) return;
            balanceBase += userInventory.reduce((acc, curr) => acc + curr.price, 0);
            userInventory = [];
            updateUI(); renderInventory();
            upgInputs = [null, null, null]; upgTarget = null;
        }

        // --- UPGRADER ---
        let upgInputs = [null, null, null];
        let upgTarget = null;

        function renderUpgrader() {
            const container = document.getElementById('upg-inputs-container');
            let totalVal = upgInputs.reduce((acc, curr) => acc + (curr ? curr.price : 0), 0);
            
            container.innerHTML = [0,1,2].map(i => upgInputs[i] ? `
                <div onclick="removeUpgInput(${i})" class="bg-gray-800/80 border border-gray-600 hover:border-red-500 rounded-2xl h-24 flex items-center p-3 cursor-pointer group relative overflow-hidden transition-all">
                    <img src="${upgInputs[i].img}" data-alts="${(upgInputs[i].imgAlts||[]).join('|')}" onerror="handleImgError(this)" class="h-16 w-20 object-contain drop-shadow-md">
                    <div class="ml-3 flex-1 overflow-hidden">
                        <div class="text-[10px] font-bold text-gray-400 uppercase truncate">${upgInputs[i].name}</div>
                        <div class="text-sm font-black text-white">${formatMoney(upgInputs[i].price)}</div>
                    </div>
                    <div class="absolute inset-0 bg-red-500/20 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity backdrop-blur-[2px]">
                        <i data-lucide="trash-2" class="w-6 h-6 text-red-500"></i>
                    </div>
                </div>
            ` : `
                <div onclick="openSelector('input', ${i})" class="bg-gray-900/50 border-2 border-dashed border-gray-600 hover:border-purple-500 rounded-2xl h-24 flex items-center justify-center cursor-pointer transition-all group">
                    <i data-lucide="plus" class="w-6 h-6 text-gray-600 group-hover:text-purple-500 transition-colors"></i>
                </div>
            `).join('');
            
            document.getElementById('upg-total-input-val').textContent = formatMoney(totalVal);

            if(upgTarget && upgTarget.price <= totalVal) upgTarget = null;

            const targetSlot = document.getElementById('upg-target-slot');
            let chance = 0;

            if(upgTarget) {
                targetSlot.classList.remove('border-dashed', 'border-purple-500/50');
                targetSlot.style.borderColor = upgTarget.color;
                targetSlot.innerHTML = `
                    <div class="absolute inset-0 opacity-20" style="background: linear-gradient(to top, ${upgTarget.color}, transparent);"></div>
                    <img src="${upgTarget.img}" data-alts="${(upgTarget.imgAlts||[]).join('|')}" onerror="handleImgError(this)" class="h-32 object-contain drop-shadow-[0_0_20px_rgba(255,255,255,0.2)] mb-2 relative z-10 group-hover:scale-110 transition-transform">
                    <div class="text-xs font-black text-white uppercase text-center relative z-10 w-full truncate px-2" style="color: ${upgTarget.color}">${upgTarget.name}</div>
                    <div class="text-lg font-black text-white relative z-10">${formatMoney(upgTarget.price)}</div>
                `;
                chance = Math.min((totalVal / upgTarget.price) * 100, 90);
            } else {
                targetSlot.removeAttribute('style');
                targetSlot.classList.add('border-dashed', 'border-purple-500/50');
                targetSlot.innerHTML = `<i data-lucide="search" class="w-10 h-10 text-purple-500/50 group-hover:text-yellow-400 mb-2"></i><span class="text-gray-500 font-bold uppercase text-xs text-center group-hover:text-white">Vyber c√≠l</span>`;
            }

            document.getElementById('upgrade-chance').textContent = chance.toFixed(1) + '%';
            document.getElementById('upgrade-circle').style.strokeDashoffset = 540 - (540 * (chance / 100));
            const ptr = document.getElementById('upgrade-pointer');
            if (ptr) ptr.style.transform = `translate(-50%, -100%) rotate(${Math.max(0, Math.min(360, chance * 3.6))}deg)`;
            lucide.createIcons();
        }

        function removeUpgInput(i) { upgInputs[i] = null; renderUpgrader(); }

        function openSelector(type, slotIndex = 0) {
            window.currentSelectorType = type;
            window.currentSelectorSlot = slotIndex;
            selectorOffset = 0;
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById('page-selector').classList.remove('hidden');
            renderSelectorPage();
        }

        function getSelectorSource() {
            const type = window.currentSelectorType || 'input';
            const slotIndex = Number(window.currentSelectorSlot || 0);
            const sortMode = document.getElementById('selector-sort')?.value || 'price-low';
            if (type === 'input') {
                let available = userInventory.filter(item => !upgInputs.some(ui => ui && ui.uid === item.uid));
                if(sortMode === 'price-high') available.sort((a,b)=>b.price-a.price);
                else if(sortMode === 'name') available.sort((a,b)=>a.name.localeCompare(b.name));
                else available.sort((a,b)=>a.price-b.price);
                return { type, slotIndex, list: available };
            }
            let totalVal = upgInputs.reduce((acc, curr) => acc + (curr ? curr.price : 0), 0);
            let targets = Object.values(skinsDB).filter(s => s.price > totalVal);
            if(sortMode === 'price-high') targets.sort((a,b)=>b.price-a.price);
            else if(sortMode === 'name') targets.sort((a,b)=>a.name.localeCompare(b.name));
            else targets.sort((a,b)=>a.price-b.price);
            return { type, slotIndex, totalVal, list: targets };
        }

        function renderSelectorPage() {
            const grid = document.getElementById('selector-grid');
            if (!grid) return;
            const src = getSelectorSource();
            const items = src.list || [];

            if (src.type === 'input') {
                document.getElementById('selector-title').textContent = "VYBER SKIN K OBƒöTOV√ÅN√ç";
            } else {
                document.getElementById('selector-title').textContent = "VYBER C√çLOV√ù SKIN";
            }

            const slice = items.slice(0, selectorOffset + SELECTOR_PAGE_SIZE);
            if (slice.length === 0) {
                grid.innerHTML = '<div class="col-span-full text-center text-gray-500 py-10 font-bold uppercase">≈Ω√°dn√© polo≈æky k v√Ωbƒõru.</div>';
                return;
            }

            grid.innerHTML = slice.map((item, idx) => {
                if (src.type === 'input') {
                    return `<div onclick="upgInputs[${src.slotIndex}] = userInventory.find(i=>i.uid==='${item.uid}'); switchPage('upgrade');" class="bg-[#1a1e26] p-4 rounded-xl cursor-pointer hover:bg-gray-800 transition-all border-b-4 item-float" style="border-color: ${item.color}; animation-delay: ${idx * 20}ms;"><img loading="lazy" decoding="async" src="${item.img}" data-alts="${(item.imgAlts||[]).join('|')}" onerror="handleImgError(this)" class="h-20 w-full object-contain mb-3 drop-shadow-md hover:scale-110 transition-transform"><div class="text-[10px] text-center truncate font-bold text-gray-400 uppercase">${item.name}</div><div class="text-sm text-center font-black text-white">${formatMoney(item.price)}</div></div>`;
                }
                return `<div onclick="upgTarget = skinsDB[${item.id}]; switchPage('upgrade');" class="bg-[#1a1e26] p-4 rounded-xl cursor-pointer hover:bg-gray-800 transition-all border-b-4 item-float" style="border-color: ${item.color}; animation-delay: ${idx * 20}ms;"><img loading="lazy" decoding="async" src="${item.img}" onerror="handleImgError(this)" class="h-20 w-full object-contain mb-3 drop-shadow-md hover:scale-110 transition-transform"><div class="text-[10px] text-center truncate font-bold text-gray-400 uppercase">${item.name}</div><div class="text-sm text-center font-black text-white">${formatMoney(item.price)}</div><div class="text-[10px] text-center font-bold text-purple-400 mt-1">≈†ance: ${Math.min((src.totalVal / item.price)*100, 90).toFixed(1)}%</div></div>`;
            }).join('');

            if (slice.length < items.length) {
                grid.insertAdjacentHTML('beforeend', `<div class="col-span-full flex justify-center"><button onclick="selectorOffset += ${SELECTOR_PAGE_SIZE}; renderSelectorPage();" class="bg-yellow-400/20 border border-yellow-400/40 text-yellow-300 rounded-lg px-4 py-2 text-xs font-black uppercase">Naƒç√≠st dal≈°√≠ (${items.length - slice.length})</button></div>`);
            }
        }

        function attemptUpgrade() {
            if(isSpinning) return;
            let totalVal = upgInputs.reduce((acc, curr) => acc + (curr ? curr.price : 0), 0);
            if(totalVal === 0) return showToast("Vlo≈æ alespo≈à jeden skin!", true);
            if(!upgTarget) return showToast("Vyber c√≠lov√Ω skin!", true);

            isSpinning = true;
            document.getElementById('btn-upgrade-exec').textContent = "Vylep≈°uji...";
            document.getElementById('upgrade-panel').classList.add('upgrade-shake');
            
            // Zvuk napƒõt√≠
            const soundNode = SoundEngine.playUpgradeProcess();

            const chance = Math.min((totalVal / upgTarget.price) * 100, 90);
            const roll = Math.random() * 100;
            const pointer = document.getElementById('upgrade-pointer');
            if (pointer) {
                const targetAngle = (roll / 100) * 360;
                const spins = 4 * 360;
                pointer.style.transform = `translate(-50%, -100%) rotate(${spins + targetAngle}deg)`;
            }

            setTimeout(() => {
                isSpinning = false;
                document.getElementById('upgrade-panel').classList.remove('upgrade-shake');
                document.getElementById('btn-upgrade-exec').textContent = "Vylep≈°it";
                if(soundNode) { soundNode.gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.1); }
                
                upgInputs.forEach(item => { if(item) { userInventory.splice(userInventory.findIndex(i => i.uid === item.uid), 1); } });

                if (roll <= chance) {
                    showWinModal(upgTarget);
                } else {
                    SoundEngine.playUpgradeFail();
                    showToast("Upgrade selhal. Skiny sho≈ôely.", true);
                }

                upgInputs = [null, null, null];
                upgTarget = null;
                renderUpgrader();
            }, 2000);
        }

        window.onload = async () => { 
            sanitizeDuplicateSocialButtons();
            lucide.createIcons();
            switchPage('cases');
            await loadSessionFromBackend();
            // pro v√Ωkon na slab≈°√≠ch za≈ô√≠zen√≠ch nespou≈°t√≠me agresivn√≠ preload v≈°ech skin≈Ø
            // Inicializuj live drops + chat (fail-safe)
            setTimeout(() => { try { initializeLiveDrops(); } catch(e) { console.error('live drops init failed', e); } }, 300);
            setTimeout(() => { try { initLiveChat(); } catch(e) { console.error('live chat init failed', e); } }, 700);
            // Currency selector handler
            const cur = document.getElementById('currency-select');
            if(cur) {
                cur.addEventListener('change', () => { updateUI(); renderCases(); renderInventory(); renderOwnPublicProfile(); });
            }
            const friendInput = document.getElementById('friend-search');
            if (friendInput) friendInput.addEventListener('input', () => searchUsers());
            const modal = document.getElementById('auth-modal');
            if(modal) {
                closeAuthModal();
                modal.addEventListener('click', (e) => {
                    if(e.target === modal) closeAuthModal();
                });
            }
            // Inicialn√≠ UI update
            const onlineCount = document.getElementById('online-count');
            if (onlineCount) onlineCount.textContent = (3800 + Math.floor(Math.random() * 1200)).toLocaleString('cs-CZ');
            updateUI();
            setInterval(loadTradeInbox, 8000);
        };

        // --- Live chat (u≈æivatel + AI odpovƒõdi, fallback bez API) ---
        async function maybeGeminiReply(userMessage) {
            if (!userMessage) return null;
            try {
                const data = await apiRequest('/api/chat/ai-reply', 'POST', { text: userMessage });
                return data?.reply || null;
            } catch {
                return null;
            }
        }

        let liveDropsAddTimer = null;
        let liveDropsOnlineTimer = null;
        let liveDropsSkinsPool = [];

        function addRandomDrop() {
            const dropsContainer = document.getElementById('live-drops');
            if (!dropsContainer || !liveDropsSkinsPool.length) return;

            const randomSkin = liveDropsSkinsPool[Math.floor(Math.random() * liveDropsSkinsPool.length)];
            const item = document.createElement('div');
            item.className = 'live-drop-item animate-drop-in flex-shrink-0 w-32 h-[85%] rounded-lg border border-white/5 relative overflow-hidden group cursor-pointer hover:-translate-y-1 hover:border-white/20';
            item.style.background = `radial-gradient(circle at top, ${(randomSkin.color || '#4b69ff')}33 0%, #12161f 80%)`;
            item.style.borderBottom = `2px solid ${randomSkin.color || '#4b69ff'}`;

            item.innerHTML = `
                <div class="absolute top-1 right-1 text-[8px] font-black text-white/50 z-10">${formatMoney(randomSkin.price || 0)}</div>
                <div class="h-full flex flex-col items-center justify-center p-2 relative z-20">
                    <img src="${randomSkin.img || FALLBACK_IMG}" onerror="handleImgError(this)" class="h-10 object-contain drop-shadow-[0_5px_8px_rgba(0,0,0,0.5)] group-hover:scale-110 transition-transform">
                    <div class="text-[9px] text-gray-300 font-bold uppercase truncate w-full text-center mt-1">${randomSkin.name || 'Skin'}</div>
                </div>
            `;

            const matchingCase = casesDB.find((c) => (c.contents || []).some((x) => String(x.skin?.id || '') === String(randomSkin.id || '')));
            if (matchingCase?.id) {
                item.addEventListener('click', () => openCaseView(matchingCase.id));
            }

            dropsContainer.prepend(item);
            while (dropsContainer.children.length > 25) {
                dropsContainer.lastChild.remove();
            }
        }

        function initializeLiveDrops() {
            const dropsContainer = document.getElementById('live-drops');
            if (!dropsContainer) return;

            if (liveDropsAddTimer) {
                clearInterval(liveDropsAddTimer);
                liveDropsAddTimer = null;
            }
            if (liveDropsOnlineTimer) {
                clearInterval(liveDropsOnlineTimer);
                liveDropsOnlineTimer = null;
            }

            dropsContainer.innerHTML = '';
            liveDropsSkinsPool = [];
            for (const c of casesDB) {
                for (const it of (c.contents || [])) {
                    if (it?.skin) liveDropsSkinsPool.push(it.skin);
                }
            }

            if (!liveDropsSkinsPool.length) {
                liveDropsSkinsPool = [{
                    id: 'fallback-live-skin',
                    name: 'Fallback Skin',
                    img: FALLBACK_IMG,
                    price: 0,
                    color: '#4b69ff'
                }];
            }

            for (let i = 0; i < 12; i += 1) {
                addRandomDrop();
            }

            const onlineCounter = document.getElementById('live-online-counter');
            let online = Number((document.getElementById('online-count')?.textContent || '1687').replace(/\D/g, '')) || 1687;
            if (onlineCounter) onlineCounter.textContent = `${online.toLocaleString('en-US')} Online`;

            liveDropsAddTimer = setInterval(() => {
                addRandomDrop();
            }, 2300);

            liveDropsOnlineTimer = setInterval(() => {
                const delta = Math.floor(Math.random() * 25) - 12;
                online = Math.max(1200, online + delta);
                if (onlineCounter) onlineCounter.textContent = `${online.toLocaleString('en-US')} Online`;
            }, 5000);
        }

        let liveChatPollTimer = null;

        function toggleLiveChat(force) {
            const panel = document.getElementById('live-chat');
            const toggle = document.getElementById('live-chat-toggle');
            if (!panel) return;
            const shouldOpen = typeof force === 'boolean' ? force : panel.classList.contains('hidden');
            panel.classList.toggle('hidden', !shouldOpen);
            panel.classList.toggle('flex', shouldOpen);
            if (toggle) toggle.classList.toggle('hidden', shouldOpen);
        }

        function renderChatMessage(container, msg, mine = false) {
            const row = document.createElement('div');
            row.className = mine ? 'text-[12px] text-right' : 'text-[12px]';
            row.innerHTML = mine
                ? `<span class="text-yellow-300 font-bold">Ty:</span> <span class="text-white">${msg.text}</span>`
                : `<span class="text-yellow-300 font-bold">${msg.nickname}:</span> <span class="text-gray-300">${msg.text}</span>`;
            container.appendChild(row);
            if(container.children.length > 120) container.removeChild(container.firstChild);
            container.scrollTop = container.scrollHeight;
        }

        async function initLiveChat() {
            const container = document.getElementById('live-chat-messages');
            const input = document.getElementById('live-chat-input');
            const sendBtn = document.getElementById('live-chat-send');
            const panel = document.getElementById('live-chat');
            if (!container || !input || !sendBtn || !panel) return;

            const loadMessages = async () => {
                if (!currentUser) {
                    container.innerHTML = '<div class="text-[11px] text-gray-500">P≈ôihlas se pro psan√≠ do chatu.</div>';
                    return;
                }
                try {
                    const data = await apiRequest('/api/chat/messages');
                    container.innerHTML = '';
                    (data.messages || []).forEach((m) => renderChatMessage(container, m, String(m.userId) === String(currentUser?.id)));
                } catch (e) {
                    console.warn('chat load failed', e.message);
                }
            };

            const sendUserMessage = async () => {
                if (!requireAuthAction()) return;
                const text = input.value.trim();
                if (!text) return;
                input.value = '';
                sendBtn.disabled = true;
                sendBtn.classList.add('opacity-70');
                try {
                    await apiRequest('/api/chat/messages', 'POST', { text });
                    await loadMessages();
                } catch (err) {
                    showToast(err.message, true);
                } finally {
                    sendBtn.disabled = false;
                    sendBtn.classList.remove('opacity-70');
                }
            };

            sendBtn.onclick = sendUserMessage;
            input.onkeydown = (e) => { if (e.key === 'Enter') sendUserMessage(); };

            await loadMessages();
            if (liveChatPollTimer) clearInterval(liveChatPollTimer);
            liveChatPollTimer = setInterval(loadMessages, 2000);
        }

        // --- FREE CASE SYSTEM ---
        // --- FREE CASE SYSTEM ---
        const FREE_CASE_COOLDOWN = 24 * 60 * 60 * 1000; // 24 hodin
        
        function getFreeCaseStatus() {
            const lastFreeCase = localStorage.getItem('lastFreeCase');
            if(!lastFreeCase) return { available: true, nextTime: 0 };
            
            const lastTime = parseInt(lastFreeCase);
            const now = Date.now();
            const nextTime = lastTime + FREE_CASE_COOLDOWN;
            
            return {
                available: now >= nextTime,
                nextTime: Math.max(0, Math.ceil((nextTime - now) / 1000))
            };
        }

        function openFreeCase() {
            if(!requireAuthAction()) return;
            const status = getFreeCaseStatus();
            if(!status.available) {
                const hours = Math.floor(status.nextTime / 3600);
                const mins = Math.floor((status.nextTime % 3600) / 60);
                showToast(`Dal≈°√≠ FREE bedna za ${hours}h ${mins}m`, true);
                return;
            }

            // FREE case s levn√Ωmi skiny (max 10 EUR)
            const freeSkins = Object.values(skinsDB).filter((sk) => Number(sk.price || 0) <= 10).sort((a,b)=>a.price-b.price);
            const freeCase = {
                id: "free-lite",
                name: "FREE LITE",
                price: 0,
                contents: [
                    { skin: freeSkins[Math.floor(freeSkins.length*0.1)] || freeSkins[0], chance: 52 },
                    { skin: freeSkins[Math.floor(freeSkins.length*0.35)] || freeSkins[0], chance: 27 },
                    { skin: freeSkins[Math.floor(freeSkins.length*0.55)] || freeSkins[0], chance: 13 },
                    { skin: freeSkins[Math.floor(freeSkins.length*0.75)] || freeSkins[0], chance: 7 },
                    { skin: freeSkins[freeSkins.length - 1] || freeSkins[0], chance: 1 }
                ]
            };
            localStorage.setItem('lastFreeCase', Date.now().toString());
            
            // Bez poplatku
            activeCaseId = freeCase.id;
            document.getElementById('view-case-name').textContent = freeCase.name + ' (FREE)';
            document.getElementById('view-case-price').textContent = '0 EUR';
            
            const countSel = document.getElementById('open-count');
            if(countSel) {
                countSel.value = '1';
                countSel.disabled = false;
            }
            ensureSpinnerRows(1, freeCase);
            const results = document.getElementById('spin-results');
            if(results) results.innerHTML = '';
            
            document.getElementById('view-case-contents').innerHTML = freeCase.contents.map(item => `
                <div class="relative bg-gray-900/50 p-3 rounded-xl border-b-2 flex flex-col items-center text-center" style="border-color: ${item.skin.color}">
                    <div class="absolute top-1 right-1 text-[9px] bg-black/70 text-yellow-300 px-1.5 py-0.5 rounded">${formatMoney(item.skin.price || 0)}</div>
                    <img src="${item.skin.img}" data-alts="${(item.skin.imgAlts||[]).join('|')}" onerror="handleImgError(this)" class="h-16 object-contain mb-2 drop-shadow-md">
                    <div class="text-[9px] font-bold text-gray-400 uppercase truncate w-full">${item.skin.name}</div>
                    <div class="text-[10px] font-black text-white">${formatChancePercent(item.chance)}</div>
                </div>
            `).join('');

            const btn = document.getElementById('btn-open-case');
            btn.onclick = () => spinCase(freeCase, getOpenCount());
            btn.textContent = "OTEV≈ò√çT ZDARMA";
            btn.disabled = false;
            btn.classList.remove('opacity-50');

            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById('page-case-view').classList.remove('hidden');
            
            showToast('FREE bedna dostupn√°!');
        }
    </script>
<div id="cb-case-selector-modal" class="hidden fixed inset-0 z-[999] bg-[#0b0d11]/95 backdrop-blur-md flex items-center justify-center p-4">
                    <div class="w-full max-w-5xl bg-[#12161f] border border-white/10 rounded-xl flex flex-col h-[85vh] overflow-hidden relative shadow-[0_0_50px_rgba(0,0,0,0.8)]">
                        <div class="px-5 pt-4 pb-3 border-b border-white/10">
                            <div class="flex items-center justify-between">
                                <div class="text-xl font-black text-white">Select cases</div>
                                <button onclick="closeCaseSelectorModal()" class="text-gray-400 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
                            </div>
                            <div class="mt-3 flex flex-wrap items-center gap-3">
                                <button class="px-3 py-1.5 rounded-md bg-gray-200 text-black text-xs font-black uppercase">Classic</button>
                                <button class="px-3 py-1.5 rounded-md bg-[#1a1e29] text-purple-300 text-xs font-black uppercase flex items-center gap-1"><i data-lucide="sparkles" class="w-3.5 h-3.5"></i> Joker</button>
                                <div class="ml-2 flex items-center gap-2 min-w-[230px]">
                                    <span class="text-[10px] text-gray-400">0 USD</span>
                                    <div class="relative flex-1 h-[2px] bg-white/15 rounded-full"><div class="absolute inset-y-0 left-[10%] right-[8%] bg-pink-400/80 rounded-full"></div></div>
                                    <span class="text-[10px] text-gray-400">3613.23 USD</span>
                                </div>
                                <button class="ml-auto bg-[#1a1e29] border border-white/10 rounded-lg px-3 py-2 text-xs font-black text-gray-200">Price -</button>
                                <input id="cb-selector-search" type="text" placeholder="Search case" oninput="renderCaseSelectorModal()" class="bg-[#1a1e29] border border-white/10 rounded-lg px-3 py-2 text-xs text-white min-w-[180px]">
                            </div>
                        </div>
                        <div id="cb-selector-grid" class="flex-1 min-h-0 overflow-y-auto px-5 py-4 custom-scroll"></div>
                        <div class="mt-auto border-t border-white/5 bg-[#0d1017] p-4">
                            <div class="grid grid-cols-3 items-center gap-3">
                                <div>
                                    <div class="text-[11px] text-gray-500">Your balance:</div>
                                    <div id="cb-balance" class="text-yellow-300 font-black text-lg">0.00 EUR</div>
                                </div>
                                <button onclick="applyCaseBattleBuilder()" id="cb-selector-ready" class="justify-self-center bg-[#c0f20c] text-black font-black uppercase rounded-lg px-8 py-3 shadow-[0_0_22px_rgba(192,242,12,0.45)]">Ready 0.00 EUR</button>
                                <div class="text-right">
                                    <div class="text-[11px] text-gray-500">Rounds</div>
                                    <div id="cb-ready-rounds" class="text-yellow-300 font-black text-lg">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
</body>
</html>
